


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Seguridad Declarativa. - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#seguridad-declarativa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Seguridad Declarativa.
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#entendiendo-los-mayores-aspectos-de-la-seguridad-en-las-aplicaciones-web" class="md-nav__link">
    Entendiendo los mayores aspectos de la seguridad en las aplicaciones web.
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="seguridad-declarativa">Seguridad Declarativa.</h1>
<hr />
<h2 id="entendiendo-los-mayores-aspectos-de-la-seguridad-en-las-aplicaciones-web">Entendiendo los mayores aspectos de la seguridad en las aplicaciones web.</h2>
<p><strong>Dato:</strong> El número de puertos disponibles son todos los que podamos representar con 16 bits. Es decir, del 0 hasta el 65536.</p>
<p>Existen dos aspectos importantes en la seguridad de las aplicaciones web.</p>
<ul>
<li>Prevenir que usuarios no autorizados accedan a datos sencibles. (autentificación, X.509)</li>
<li>Evitar que un atacante se haga con datos mientras esté en tránsito.(ssl secure sockets layer)</li>
</ul>
<p>Ambos aspectos, son independientes en funcionamiento, las formas de solucionar las restricciones de acceso, son independientes de como se proteja esta información en el transporte. Es decir, que si diseñamos un sistema de autentificación, no debemos rediseñarlo por aspectos (ssl).</p>
<p><strong>Seguridad declarativa</strong>: Este tipo de seguridad, indica que ningún jsp o servlet, necesitará programación extra para este propósito, en realidad, será el servidor quien se encargará de este propósito. </p>
<p>La configuración de la seguridad irá en el <code>web.xml</code>. (Web application deployment descriptor). Desde acá definimos que estará restringido y qué no. a diferencia de la <strong>seguridad programática</strong>, en la que los servlets y jsp, poseerán lógica que indique personalizadamente que estará disponible y qué no.</p>
<p>Una de las formas más comunes de seguridad declarativa es la FBA - (Form-Based Authentication), usualmente utilizado con campos como usuario y contraseña, los cuales serán la forma de identificar a un usuario. Para que una autentificación sea considerada robusta, debe cumplir con los siguientes 8 pasos recomendados:</p>
<p><strong>Configurar: nombres de usuario, contraseñas y roles.</strong></p>
<p>Cuando un usuario intenta acceder a un recurso protegido en una aplicación que usa autenticación basada en formularios, el sistema envía automáticamente al usuario a un formulario HTML para solicitar un nombre de usuario y contraseña, verifica que la contraseña coincida con el usuario, determina qué roles abstractos (usuario normal, administrador, ejecutivo, etc.) al que pertenece ese usuario y ve si alguno de esos roles, tiene permiso para acceder al recurso. Si es así, el servidor redirige al usuario a la página solicitada originalmente. De lo contrario, el servidor redirige al usuario a una página de error.</p>
<p>La buena noticia con respecto a este proceso es que el servidor (contenedor), hace mucho trabajo por nosotros. La mala noticia es que la tarea de asociar usuarios con contraseñas y roles lógicos es específica del servidor. Por lo tanto, aunque no tendría que cambiar el archivo <code>web.xml</code> ni ninguno de los códigos de servlet y JSP; <strong>para mover una aplicación web segura de un sistema a otro, aún tendría que hacer cambios personalizados en cada sistema para configurar los usuarios y contraseñas</strong></p>
<p><strong>Establecer contraseñas con Tomcat</strong></p>
<p>Tomcat permite a los desarrolladores avanzados, configurar esquemas personalizados de administración de nombre de usuario y contraseña (por ejemplo, acceder a una base de datos, buscar en el archivo UNIX / etc / passwd, verificar la configuración de la cuenta de usuario de Windows o hacer una llamada Kerberos). Para más detalles, consulte http://jakarta.apache.org/tomcat/tomcat-5.5-doc/realm-howto.html. Sin embargo, esta configuración requiere mucho trabajo, por lo que Tomcat también proporciona un mecanismo predeterminado para usar en las pruebas. Con este mecanismo, Tomcat almacena nombres de usuario, contraseñas y roles en tomcat_dir / conf / tomcat-users.xml. Este archivo debe contener un encabezado XML seguido de un elemento tomcat-users que contenga cualquier número de roles y elementos de usuario. Cada elemento de rol debe tener un atributo de nombre de rol. Cada elemento de usuario debe tener tres atributos: nombre de usuario, contraseña (la contraseña de texto sin formato) y roles (una lista separada por comas de nombres de roles lógicos).</p>
<p>Ejemplo: <code>/Applications/contenedor/apache-tomcat-9.0.31_bkp20202303/conf/tomcat-users.xml</code></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;
&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot;
              xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
              xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;
              version=&quot;1.0&quot;&gt;
&lt;!--
  NOTE:  By default, no user is included in the &quot;manager-gui&quot; role required
  to operate the &quot;/manager/html&quot; web application.  If you wish to use this app,
  you must define such a user - the username and password are arbitrary. It is
  strongly recommended that you do NOT use one of the users in the commented out
  section below since they are intended for use with the examples web
  application.
--&gt;
&lt;!--
  NOTE:  The sample user and role entries below are intended for use with the
  examples web application. They are wrapped in a comment and thus are ignored
  when reading this file. If you wish to configure these users for use with the
  examples web application, do not forget to remove the &lt;!.. ..&gt; that surrounds
  them. You will also need to set the passwords to something appropriate.
--&gt;
&lt;!--
  &lt;role rolename=&quot;tomcat&quot;/&gt;
  &lt;role rolename=&quot;role1&quot;/&gt;
  &lt;user username=&quot;tomcat&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;tomcat&quot;/&gt;
  &lt;user username=&quot;both&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;tomcat,role1&quot;/&gt;
  &lt;user username=&quot;role1&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;role1&quot;/&gt;
--&gt;
  &lt;!-- se agrega este para poder entrar en la administración --&gt;
  &lt;role rolename=&quot;manager-gui&quot;/&gt;
  &lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;manager-gui&quot;/&gt;

&lt;/tomcat-users&gt;

</code></pre>

<p>Tenga en cuenta, que la estrategia predeterminada de Tomcat para almacenar contraseñas sin cifrar es deficiente para las aplicaciones implementadas reales. Primero, un intruso que obtiene acceso al sistema de archivos del servidor puede obtener todas las contraseñas. En segundo lugar, incluso los administradores de sistemas autorizados para acceder a los recursos del servidor no deberían poder obtener las contraseñas de los usuarios. De hecho, debido a que muchos usuarios reutilizan las contraseñas en múltiples sistemas, las contraseñas nunca deben almacenarse en texto claro. En cambio, deben cifrarse con un algoritmo que no se puede revertir fácilmente. Luego, cuando un usuario proporciona una contraseña, se cifra y la versión cifrada se compara con la contraseña cifrada almacenada. Sin embargo, el enfoque predeterminado de Tomcat facilita la configuración y prueba de aplicaciones web seguras. Solo tenga en cuenta que para aplicaciones reales querrá reemplazar el esquema de contraseña simple basado en archivos con algo más robusto (por ejemplo, una base de datos o una llamada al sistema a Kerberos o al sistema de cuenta de usuario de Windows).</p>
<p><strong>Decirle al servidor que está utilizando la autenticación basada en formularios; Designación de ubicaciones de inicio de sesión y páginas de error de inicio de sesión</strong>:</p>
<p>Usaremos el elemento <code>login-config</code> en el descriptor de implementación (web.xml) para controlar el método de autenticación. Recuerde que este archivo va en el directorio WEB-INF de su aplicación web. Aunque algunos servidores admiten archivos web.xml no estándar (por ejemplo, Tomcat tiene uno en <code>tomcat_dir/conf</code> que proporciona valores predeterminados para múltiples aplicaciones web), esos archivos son completamente específicos del servidor. Solo abordamos la versión estándar que se incluye en el directorio WEB-INF de la aplicación web.</p>
<p>Para usar la autenticación basada en formularios, proporcione un valor de FORM para el subelemento del método auth y use el subelemento <code>form-login-config</code> para proporcionar las ubicaciones del inicio de sesión (<code>form-login-page</code>) y <code>login-failure</code> (<code>form-error-page</code>). más adelante, explicamos exactamente qué deben contener estos dos archivos. Por ahora, sin embargo, tenga en cuenta que nada exige que utilicen contenido dinámico. Por lo tanto, estas páginas pueden consistir en JSP o HTML ordinario.</p>
<p>Por ejemplo, el siguiente código,  muestra parte de un archivo <code>web.xml</code> que estipula que el contenedor usa autenticación basada en formularios. Los usuarios no autenticados que intenten acceder a recursos protegidos serán redirigidos a <code>http: //host/webAppPrefix/login.jsp</code>. Si inician sesión correctamente, volverán a cualquier recurso al que intentaron acceder por primera vez. Si falla su intento de inicio de sesión, serán redirigidos a <code>http: //host/webAppPrefix/login-error.html</code>.</p>
<pre><code class="xml">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
         version=&quot;3.1&quot;&gt;
    &lt;!-- ... --&gt;
    &lt;login-config&gt;
        &lt;auth-method&gt;FORM&lt;/auth-method&gt;
        &lt;form-login-config&gt;
            &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
            &lt;form-error-page&gt;/login-error.jsp&lt;/form-error-page&gt;
        &lt;form-login-config&gt;
    &lt;/login-config&gt;
    &lt;!-- ... --&gt;

&lt;/web-app&gt;
</code></pre>

<p><strong>Crear la página de inicio de sesión</strong></p>
<p>El elemento <code>login-config</code> le dice al servidor que use autenticación basada en formularios y que redirija a los usuarios no autenticados a una página designada. Ok; Pero, ¿qué deberías poner en esa página? La respuesta es sorprendentemente simple: todo lo que requiere la página de inicio de sesión es un formulario con una ACCIÓN de <code>j_security_check</code>, un campo de texto llamado <code>j_username</code> y un campo de contraseña llamado <code>j_password</code>. Y, debido a que el uso de GET nos muestra todo el contenido de los puntos de los campos de contraseña (protegiendo la contraseña de miradas indiscretas que miran por encima del hombro del usuario), todos los formularios que tienen campos de contraseña deben usar un MÉTODO de POST. Nunca utilizas GET con campos de contraseña porque la contraseña se mostrará en texto claro en la barra de direcciones del navegador. Tenga en cuenta que <code>j_security_check</code> es un nombre "mágico"; no lo introduces con un "/", incluso si tu página de inicio de sesión está en un subdirectorio del directorio principal de la aplicación web.</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;j_security_check&quot; method=&quot;post&quot;&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Nombre de usuario: &lt;input type=&quot;text&quot; name=&quot;j_username&quot; id=&quot;&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Contraseña: &lt;input type=&quot;password&quot; name=&quot;j_password&quot; id=&quot;&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Esa fue la página para iniciar sesión. ¿Qué pasa con una página para cerrar sesión? La sesión debería agotar el tiempo, pero ¿qué sucede si los usuarios desean cerrar sesión inmediatamente sin cerrar el navegador? La especificación del servlet exige que invalidar la HttpSession debería cerrar la sesión de los usuarios y hacer que se vuelvan a autenticar la próxima vez que intenten acceder a un recurso protegido. Por lo tanto, puede crear una página de cierre de sesión haciendo un servlet o una página JSP que busque la sesión y la invalide o cierre. Esto contrasta con la autenticación BÁSICA, donde el cierre de sesión no es compatible sin que el usuario cierre y reinicie el navegador.</p>
<p><strong>Restricción del acceso directo a la página de inicio de sesión.</strong></p>
<p>Como explicamos, cuando un usuario no autenticado intenta acceder a un recurso protegido, el servidor redirige automáticamente a la página de inicio de sesión. Desafortunadamente, la especificación del servlet no obliga a los servidores compatibles a usar la redirección "detrás de escena" (es decir, utilizando el método RequestDispatcher.forward) a la página JSP especificada en el elemento form-login-page. Los servidores son libres de usar el método HttpServletResponse.sendRedirect, y algunos servidores modernos lo hacen. Los contenedores que utilizan el método sendRedirect exponen la URL completa de la página de inicio de sesión al cliente. El usuario desprevenido puede invocar más tarde esta URL, intentando iniciar sesión en la aplicación por primera vez (el usuario aún no se autenticaría), iniciar sesión con un nombre de usuario diferente mientras ya está conectado, o simplemente presionando el botón Atrás del navegador.</p>
<p>La especificación del servlet tampoco determina qué deben hacer los servidores compatibles si el usuario intenta acceder directamente a la página de inicio de sesión, como en los escenarios descritos. Por lo tanto, el resultado es altamente específico del servidor. El servidor puede reenviar al usuario a una página que no existe, lo que da como resultado un error HTTP 404 o producir algún otro resultado que el usuario no espera. Obviamente, ninguno de estos resultados es bueno.</p>
<p>Podemos evitar parcialmente este comportamiento impredecible, si colocamos algo de lógica en la página de inicio de sesión. La lógica debería proteger a dos tipos de usuarios para que no accedan directamente a la página de inicio de sesión: un usuario no autenticado (aún no ha iniciado sesión) y un usuario autenticado (intenta acceder a la página de inicio de sesión que ya ha iniciado sesión).</p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%
    response.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate&quot;);
    response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);
    response.serDateHeader(&quot;Expires&quot;, -1);

    // verificamos si ya estamos autentificados
    if(request.getRemoteUser() = != null){
        response.sendRedirect(&quot;logout-confirmation.jsp);
    }
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;j_security_check&quot; method=&quot;post&quot;&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Nombre de usuario: &lt;input type=&quot;text&quot; name=&quot;j_username&quot; id=&quot;&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Contraseña: &lt;input type=&quot;password&quot; name=&quot;j_password&quot; id=&quot;&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>La primera línea, que establece el encabezado de respuesta HTTP versión 1.1 Cache-Control en "no-store, no-cache, must-revalidate", asegura que el usuario nunca verá la versión en caché del navegador de la página de inicio de sesión. Del mismo modo, para satisfacer la versión 1.0 de HTTP, también configuramos los encabezados Pragma y Expires. Las siguientes líneas usan el método <code>getRemoteUser</code>, que devuelve el nombre de usuario del usuario actualmente conectado. Si el usuario no ha iniciado sesión, devuelve nulo. Por lo tanto, si <code>getRemoteUser</code> devuelve, de hecho, un valor no nulo, podemos estar seguros de que este usuario ya ha iniciado sesión e invoca la página de inicio de sesión directamente. En este caso, simplemente redirigimos al usuario a algún <code>logout-confirm.jsp</code>, que le da al usuario la opción de cerrar sesión formalmente.</p>
<p>Realmente no hay una manera limpia y fácil de proteger al usuario no autenticado de acceder directamente a la página de inicio de sesión. Una manera sucia sería redirigir ciegamente cada solicitud de la página de inicio de sesión a un recurso protegido (por ejemplo, /protectedA.jsp), haciendo que el servidor active el proceso de autenticación y "volver a servir" la página de inicio de sesión al cliente como parte de ese proceso. Este enfoque resolvería el problema de un usuario no autenticado que invoca directamente la página de inicio de sesión. Sin embargo, también introduciría algunos efectos secundarios. ¿Qué sucedería si un usuario no autenticado intenta invocar otro recurso protegido, <code>/protectedB.jsp</code>? El servidor servirá la página de inicio de sesión, y si el inicio de sesión es exitoso, el usuario será reenviado a /protectedA.jsp. Sin embargo, el usuario solicitó ir a <code>/protectedB.jsp</code>! El usuario conectado pero frustrado ahora se vería obligado a navegar nuevamente por su sitio web para llegar a <code>/protectedB.jsp</code>.</p>
<p>Por lo tanto, si su aplicación web se implementará en un servidor que utiliza <code>sendRedirect</code> para reenviar al usuario a la página de inicio de sesión, debe decidir qué efecto secundario es más perjudicial para su aplicación y ajustarlo en consecuencia.</p>
<p>Más importante, el problema con todos los enfoques discutidos es que obligan a escribir código relacionado con la seguridad, que es antitético al modelo de seguridad declarativo.</p>
<p><strong>Creación de la página para informar intentos de inicio de sesión fallidos</strong></p>
<p>La página de inicio de sesión debe contener un formulario con una ACCIÓN de propósito especial (j_security_check), un campo de texto con un nombre especial (j_username) y un campo de contraseña con otro nombre reservado (j_password). Cuando el usuario intenta acceder a un recurso protegido, el servidor presenta automáticamente la página de inicio de sesión. El usuario completa el formulario de inicio de sesión y lo envía. Si las credenciales presentadas (por ejemplo, nombre de usuario y contraseña) son las de un usuario legal pero el usuario no pertenece a la categoría de usuarios que pueden acceder al recurso solicitado, el servidor rechazará la solicitud con un código de error HTTP 403 Prohibido. Recuerde que con el descriptor de despliegue, puede especificar una página personalizada que se mostrará cuando se produzca un error HTTP.</p>
<p>Sin embargo, si el nombre de usuario y la contraseña no son los de un usuario legal, el servidor enviará automáticamente al usuario a la página login-failure especificada en el elemento form-error-page.</p>
<p>Entonces, ¿qué se requiere para estar en la página de inicio de sesión fallido? ¡Nada! Esta página es arbitraria; puede contener un enlace a una sección sin restricciones de la aplicación web o un simple mensaje de "error de inicio de sesión".</p>
<p><strong>Especificar las URL que deberían estar protegidas con contraseña</strong></p>
<p>El elemento <code>login-config</code> le dice al servidor qué método de autenticación usar. Bien, pero ¿cómo se designan las URL específicas a las que se debe restringir el acceso? La designación de URL restringidas y la descripción de la protección que deberían tener, es el propósito del elemento <code>security-constraint</code>.</p>
<p>El elemento <code>security-constraint</code>, contiene cuatro subelementos posibles: <code>display-name</code> (un elemento opcional que proporciona un nombre para que los IDE lo usen), <code>web-resource-collection</code> (un elemento obligatorio que especifica las URL que deben protegerse), <code>auth-restricción</code> (un elemento opcional que designa los roles abstractos que deberían tener acceso a las URL) y <code>user-data-constraint</code> (un elemento opcional que especifica si se requiere SSL). Tenga en cuenta que se permiten múltiples web-resource-collection dentro de <code>security-constraint</code>.</p>
<p>Ejemplo del uso de <code>security-constraint</code>.</p>
<p>El siguiente código, le indica al servidor que requiera contraseñas para todas las URL del formulario <code>http://host/webAppPrefix/sensible/loQueSea</code>. </p>
<p>Los usuarios que proporcionan contraseñas y pertenecen a los roles lógicos de <code>administrator</code> o <code>executive</code> tendrán acceso; a todos los demás se les negará. </p>
<p>El resto de esta subsección, proporciona detalles sobre los elementos de <code>web-resource-collection</code>, <code>auth-constraint</code> y <code>display-name elements</code>.</p>
<pre><code class="xml">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
    version=&quot;3.1&quot;&gt;

    &lt;security-constraint&gt;

        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Sensible&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/sensible/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;

        &lt;auth-constraint&gt;
            &lt;role-name&gt;administrator&lt;/role-name&gt;
            &lt;role-name&gt;executive&lt;/role-name&gt;
        &lt;/auth-constraint&gt;

    &lt;/security-constraint&gt;

&lt;/web-app&gt;
</code></pre>

<p><strong>web-resource-collection</strong></p>
<p>Este subelemento <code>security-constraint</code>, identifica los recursos que deben protegerse. </p>
<p>Cada elemento <code>security-constraint</code> debe contener una o más <code>web-resource-collection</code>; todos los demás subelementos <code>securitycontraint</code> son opcionales. </p>
<p>El elemento <code>web-resource-collection</code>, consiste en un elemento <code>web-resource-name</code> que proporciona un nombre de identificación arbitrario, un <code>url-pattern</code>, que identifica las URL que deben protegerse, un elemento opcional <code>http-method</code>, que designa los vervos HTTP a los que se aplica la protección (GET, POST, etc .; el valor predeterminado es todos los métodos), y un elemento de descripción opcional que proporciona documentación. </p>
<p>Por ejemplo, la siguiente entrada <code>web-resource-collection</code>, (dentro de un elemento <code>security-constraint</code>), especifica la protección con contraseña que debe aplicarse a todos los documenteos del directorio propietario (y subdirecctorios) y la página <code>delete-account.jsp</code> en el direcctorio de arministración.</p>
<p>Debido a que se aplican restricciones de seguridad para solicitar la URL, no el directorio físico, esta restricción de seguridad se aplicaría igualmente a cualquier servlet asignado a las URL que contengan el directorio propietario en ellas. Por ejemplo, un servlet mapeado con un patrón <code>/propietario/CompanySecretOfTheDayServlet</code>, también estaría protegido por la siguiente restricción de seguridad:</p>
<pre><code class="xml">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
    version=&quot;3.1&quot;&gt;

    &lt;security-constraint&gt;

        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Propietary&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/propietary/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;

        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Account Deletion&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/admin/delete-account.jsp&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;

    &lt;/security-constraint&gt;

&lt;/web-app&gt;
</code></pre>

<p>Es importante, proteger el acceso al servlet y el jsp que lo contiene.</p>
<p>Al proteger los envíos de formularios, es importante que proteja la página que tiene el formulario, así como el servlet al que se envía el formulario. Un error común es proteger solo el formulario y dejar el servlet sin protección. Esta supervisión permite a los usuarios omitir el formulario, ya sea de forma deliberada o accidental (por ejemplo, siguiendo un marcador), y acceder al servlet sin ser autenticado.</p>
<p>Al proteger los envíos de formularios, asegúrese de proteger el servlet al que se envía el formulario además de la página del formulario.</p>
<p>También es importante tener en cuenta que el <code>url-pattern</code> se aplica solo a los clientes que acceden directamente a los recursos.</p>
<p>En particular, no se aplica a las páginas a las que se accede a través de la arquitectura MVC con un <code>RequestDispatcher</code> o por los medios similares de <code>jsp: forward o jsp: include</code>.</p>
<p>Su asimetría es buena si se usa correctamente. Por ejemplo, con la arquitectura MVC, un servlet busca datos, los coloca en beans y reenvía la solicitud a una página JSP que extrae los datos de los beans y los muestra. Gustaría entonces, que nunca se acceda directamente a la página JSP, sino que solo se acceda a través del servlet que configura los beans que utilizará la página. Los elementos <code>url-pattern</code> y <code>auth-restriction</code>, pueden proporcionar esta garantía al declarar que ningún usuario tiene acceso directo a la página JSP.</p>
<p>Sin embargo, tenga en cuenta que el enfoque más simple para este problema es colocar las páginas JSP dentro del directorio WEB-INF. Este comportamiento asimétrico puede sorprender a los desarrolladores y permitirles proporcionar accidentalmente acceso sin restricciones a los recursos que deben protegerse.</p>
<p><strong>Estas protecciones se aplican solo al acceso directo del cliente. El modelo de seguridad no se aplica a las páginas a las que se accede mediante <code>RequestDispatcher</code>, <code>jsp: forward o jsp: include</code>.</strong></p>
<p><strong>auth-constraint</strong></p>
<p>Mientras que el elemento <code>web-resource-collection</code>, designa las URL que deben protegerse, el elemento <code>auth-constraint</code>, <strong>designa a los usuarios que deberían tener acceso a estos recursos</strong>. Debe contener uno o más elementos <code>role-name</code>, que identifiquen la clase de usuarios que tienen acceso y, opcionalmente, un elemento <code>description</code> que describa el rol. Por ejemplo, la siguiente parte del elemento <code>security-constraint</code>, en <code>web.xml</code> establece que solo los usuarios designados como Administrators o Big Kahunas (o ambos) deberían tener acceso al recurso designado.</p>
<pre><code class="xml">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
    version=&quot;3.1&quot;&gt;

    &lt;security-constraint&gt;

        &lt;!-- qué estamos restringiendo --&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Propietary&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/propietary/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;

        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Account Deletion&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/admin/delete-account.jsp&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;

        &lt;!-- quienes tinen acceso a lo restringido --&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;administrator&lt;/role-name&gt;
            &lt;role-name&gt;kahuna&lt;/role-name&gt;
        &lt;/auth-constraint&gt;

    &lt;/security-constraint&gt;

&lt;/web-app&gt;
</code></pre>

<p>Si desea que todos los usuarios autenticados tengan acceso a un recurso, use <code>*</code> como <code>role-name</code>. Para restringir el acceso de cualquier persona a un grupo de recursos, use un elemento <code>auth-constraint</code> vacío (por ejemplo, <auth-constraint/>). El elemento <code>auth-constraint</code> vacío, significa que ningún rol tiene acceso. Aunque a primera vista parece inútil negar el acceso a todos los usuarios, recuerde que estas restricciones de seguridad solo se aplican al acceso directo del cliente. Entonces, por ejemplo, suponga que tiene un fragmento JSP que está destinado a insertarse en otro archivo con <code>jsp: include</code>. O suponga que tiene una página JSP que es el destino de reenvío de un servlet que está utilizando un <code>RequestDispatcher</code> como parte de la arquitectura MVC. En ambos casos, los usuarios deben tener prohibido acceder directamente a la página JSP. Un elemento de restricción de seguridad con un elemento <code>auth-constraint</code> vacío impondría esta restricción. <strong>Sin embargo, como mencionamos, colocar estos recursos dentro del directorio WEB-INF es la solución más simple.</strong></p>
<p><strong>display-name</strong></p>
<p>Este, rara vez, utilizado subelemento opcional de <code>security-constraint</code>. Le da un nombre a la entrada de restricción de seguridad. Este nombre puede ser utilizado por un IDE u otra herramienta gráfica.</p>
<p><strong>Listar todos los posibles roles o (roles abstractos).</strong></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
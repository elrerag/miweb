


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Pool de conexiones. - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pool-de-conexiones" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Pool de conexiones.
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="pool-de-conexiones">Pool de conexiones.</h1>
<p>Usando esta técnica: 
+ Ganamos cantidad de conexiones activas, es decir podemos definir la cantidad de conexiones que máximas que controlaría nuestro servidor <code>Apache Tomcat</code>.</p>
<ul>
<li>Ganamos seguridad al configurar la conexión desde el mismo servidor.</li>
</ul>
<p>Este concepto se basa en hacer que no exista solamente una conexión con nuestro apache, es una configuración que se debe realizar en paralelo con el servidor. Tomemos un proyecto mvc.</p>
<p>Se debe tener presente que para los proyectos que posean un archivo que maneja la conexión, el cambio en Java es solamente en mencionado archivo. veamos antes de comenzar cual es este cambio.</p>
<hr />
<h1 id="comparacion-en-la-implementacion">comparación en la implementación</h1>
<hr />
<p>Versión de la conexión anterior sin pool.</p>
<pre><code class="java">public Connection obtenerConexion() throws SQLException {
    Connection conexion = null;

    try {
        Class.forName(&quot;org.sqlite.JDBC&quot;);
        conexion = DriverManager.getConnection(
            &quot;jdbc:sqlite:/Users/luisherrera/Desktop/TALENTO-PROS/bases/base001.db&quot;, 
            &quot;admin&quot;, 
            &quot;1234&quot;
        );

    } catch (ClassNotFoundException e) {
        logger.severe(&quot;No se pudo cargar el driver.&quot;);
        logger.severe(e.getMessage());
    }

    return conexion;
}
</code></pre>

<p>Versión de la conexión usando pool</p>
<pre><code class="java">public Connection obtenerConexion() throws SQLException {
    Connection conexion = null;

    try {
        InitialContext contextoInicial = new InitialContext(); 
        DataSource ds = (DataSource) contextoInicial.lookup(&quot;java:comp/env/jdbc/mydb&quot;);
        conexion = ds.getConnection(); 

    } catch (NamingException e) {
        milog.severe(&quot;No se pudo obtener conexión del pool&quot;);
        milog.severe(e.getMessage());
    }
    return conexion;
}
</code></pre>

<hr />
<h1 id="inicio-del-ejemplo-sqlite">Inicio del ejemplo SQLITE</h1>
<hr />
<p>El primer paso es configurar el archivo <code>context.xml</code>, que se encuentra en el Server que tenemos en eclipse. </p>
<p>Es acá donde irá la configuración de la conexión, es decir, el nombre de usuario, el driver y los demás parámetros que acostumbramos a tener por ejemplo en la clase que nos entrega la conexión.</p>
<p>El contenido es el siguiente:</p>
<p>Referencia de los parámetros: <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html</a></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;&lt;!-- The contents of this file will be loaded for each web application --&gt;&lt;Context&gt;

    &lt;!-- Default set of monitored resources. If one of these changes, the    --&gt;
    &lt;!-- web application will be reloaded.                                   --&gt;
    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;
    &lt;WatchedResource&gt;WEB-INF/tomcat-web.xml&lt;/WatchedResource&gt;
    &lt;WatchedResource&gt;${catalina.base}/conf/web.xml&lt;/WatchedResource&gt;

&lt;!-- esto es lo que se añade --&gt;
    &lt;Resource name=&quot;jdbc/mydb&quot; auth=&quot;Container&quot;
        type=&quot;javax.sql.DataSource&quot; maxActive=&quot;100&quot; maxIdle=&quot;30&quot;
        maxWait=&quot;10000&quot; username=&quot;admin&quot; password=&quot;1234&quot;
        driverClassName=&quot;org.sqlite.JDBC&quot;
        url=&quot;jdbc:sqlite:/Users/luisherrera/Desktop/TALENTO-PROS/bases/base001.db&quot; /&gt;

&lt;!-- esto es lo que se añade #--&gt;

    &lt;!-- Uncomment this to disable session persistence across Tomcat restarts --&gt;
    &lt;!--
    &lt;Manager pathname=&quot;&quot; /&gt;
    --&gt;
&lt;/Context&gt;

</code></pre>

<p><code>/poolcon/pom.xml</code></p>
<p>Debemos importar el driver de SQLITE</p>
<pre><code class="xml">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;cl.lherrera&lt;/groupId&gt;
    &lt;artifactId&gt;poolcon&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
            &lt;version&gt;3.30.1&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

&lt;/project&gt;
</code></pre>

<p><code>/poolcon/WebContent/WEB-INF/web.xml</code></p>
<p>hay que indicar en el descriptor la configuración del pool</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;4.0&quot;&gt;
  &lt;display-name&gt;poolcon&lt;/display-name&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;

  &lt;resource-ref&gt;
    &lt;description&gt;Mi pool de conexiones&lt;/description&gt;
    &lt;res-ref-name&gt;jdbc/mydb&lt;/res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
    &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;
&lt;/web-app&gt;
</code></pre>

<p><code>/poolcon/src/main/java/cl/lherrera/dao/ManejaConexion.java</code></p>
<p><code>java:comp</code> va por defecto</p>
<p><code>/jdbc/mydb</code> es el nombre del Resource que indicamos en <code>context.xml</code>.</p>
<pre><code class="java">package cl.lherrera.dao;

import java.sql.Connection;
import java.sql.SQLException;
import java.util.logging.Logger;

import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.sql.DataSource;



public class ManejaConexion {

    private static final Logger milog = Logger.getLogger(ManejaConexion.class.getName());

    private static ManejaConexion manejaConexion = new ManejaConexion();

    private ManejaConexion() {
        if (manejaConexion != null){
            //Prevent Reflection
            throw new IllegalStateException(&quot;No se puede crear una nueva instancia de ManejaConexion&quot;);
        }
    }

    public static ManejaConexion obtenerManejo() {
        return manejaConexion;
    }

    public Connection obtenerConexion() throws SQLException {
        Connection conexion = null;

        try {
            InitialContext contextoInicial = new InitialContext(); 
            DataSource ds = (DataSource) contextoInicial.lookup(&quot;java:comp/env/jdbc/mydb&quot;);
            conexion = ds.getConnection(); 

        } catch (NamingException e) {
            milog.severe(&quot;No se pudo obtener conexión del pool&quot;);
            milog.severe(e.getMessage());
        }
        return conexion;
    }

}

</code></pre>

<p>Hasta acá ya está configurado el proyecto, lo siguiente es para poder probar su funcionamiento.</p>
<p><code>/poolcon/src/main/java/cl/lherrera/dao/PersonaDAO.java</code></p>
<pre><code class="java">package cl.lherrera.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Logger;

import cl.lherrera.modelo.Persona;


public class PersonaDAO {
    private static final ManejaConexion manejaConexion = ManejaConexion.obtenerManejo();
    private static Logger milog = Logger.getLogger(PersonaDAO.class.getName());

    public List&lt;Persona&gt; obtenerTodos(){
        List&lt;Persona&gt; personas = new ArrayList&lt;&gt;();

        try(
            Connection conexion = manejaConexion.obtenerConexion();
            PreparedStatement ps = conexion.prepareStatement(&quot;SELECT id, nombre FROM persona&quot;);
            ResultSet rs = ps.executeQuery();
        ){
            while(rs.next()) {
                personas.add(new Persona(rs.getInt(&quot;id&quot;), rs.getString(&quot;nombre&quot;)));
            }
        }catch (SQLException e) {
            milog.severe(e.getMessage());
        }

        return personas;
    }
}
</code></pre>

<p><code>/poolcon/src/main/java/cl/lherrera/modelo/Persona.java</code></p>
<pre><code class="java">package cl.lherrera.modelo;

public class Persona {
    private Integer id;
    private String nombre;

    public Persona() {}

    public Persona(Integer id, String nombre) {
        this.id = id;
        this.nombre = nombre;
    }

    public Persona(String nombre) {
        this.nombre = nombre;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    @Override
    public String toString() {
        return &quot;Persona [id=&quot; + id + &quot;, nombre=&quot; + nombre + &quot;]&quot;;
    }
}

</code></pre>

<p><code>/poolcon/src/main/java/cl/lherrera/servlets/IniciaMantenedor.java</code></p>
<p>Un servlet, con la finalidad de de probar el sistema, los resultados se imprimen por consola, si es que la base de datos posee información.</p>
<pre><code class="java">package cl.lherrera.servlets;

import java.util.logging.Logger;

import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import cl.lherrera.dao.PersonaDAO;


@WebServlet(name = &quot;Mantenedor de Personas&quot;, urlPatterns = &quot;/mantenedor&quot;)
public class IniciaMantenedor extends HttpServlet{
    private static final Logger logger = Logger.getLogger(IniciaMantenedor.class.getName());
    private static PersonaDAO daoPersona = new PersonaDAO();

    private static final long serialVersionUID = -4282664097471786333L;

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        daoPersona.obtenerTodos().forEach(persona -&gt; System.out.println(persona.getNombre()));

        logger.info(&quot;procesoTerminado&quot;);

    }

}
</code></pre>

<p>Para probar: <code>http://localhost:8080/poolcon/mantenedor</code></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
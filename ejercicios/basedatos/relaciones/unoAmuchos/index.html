


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>unoAmuchos - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#relacion-de-uno-a-muchos" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              unoAmuchos
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelo-de-datos-sqlite" class="md-nav__link">
    Modelo de datos (SQLITE)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    DDL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-del-proyecto" class="md-nav__link">
    Estructura del proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilitarios" class="md-nav__link">
    Utilitarios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pomxml" class="md-nav__link">
    pom.xml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clase-de-administracion-de-la-conexion-singlenton" class="md-nav__link">
    Clase de administración de la conexión (Singlenton).
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicio-de-los-comentarios" class="md-nav__link">
    Servicio de los comentarios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dto" class="md-nav__link">
    DTO
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daos" class="md-nav__link">
    DAOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelo" class="md-nav__link">
    Modelo
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <hr />
<h1 id="relacion-de-uno-a-muchos">Relación de uno a muchos</h1>
<hr />
<p>La relación más común que tendremos en un modelo de datos, aunque necesitamos conocerlas todas, esta relación es la que más veces implementaremos.</p>
<p>Necesitamos conocer los comentarios que realiza un usuario. además de poder ingresar algún comentario.</p>
<h2 id="modelo-de-datos-sqlite">Modelo de datos (<code>SQLITE</code>)</h2>
<p><img src="https://github.com/elrerag/pintamiweb/blob/master/jfst/ejercicios/relaciones/003.png?raw=true" alt="relaciones003.png"></p>

<h2 id="ddl">DDL</h2>
<pre><code class="sql">-- activamos la restricción de las llaves foraneas
pragma foreign_keys = ON;

-- se crea la tabla de usuarios
CREATE table usuario (
    id integer primary key autoincrement,
    nombre text
);
-- se crea la tabla comentario
CREATE table comentario (
    id integer primary key autoincrement,
    fecha datetime,
    texto text,
    usuario_id integer not null,
    FOREIGN KEY(usuario_id) REFERENCES usuario(id) ON DELETE CASCADE
);

-- se ingresan los datos para comenzar con las pruebas desde el sistema
insert into usuario (nombre) values ('luis');

insert into comentario (fecha, texto, usuario_id) values (
    strftime('%Y-%m-%d %H-%M','now'),
    &quot;Este es un comentario de luis..&quot;,
    1
);

insert into comentario (fecha, texto, usuario_id) values (
    strftime('%Y-%m-%d %H-%M','now'),
    &quot;Este es un segundo comentario de luis..&quot;,
    1
);

-- probamos que exista el usuario y dos comentarios
select * from usuario;
select * from comentario;

-- -- en caso de ejecutar los tests, para que vuelva a funcionar
-- -- necesitamos borrar el comentario ingresado en el test
-- delete from comentario where texto == &quot;otro comentario&quot;;
</code></pre>

<h2 id="estructura-del-proyecto">Estructura del proyecto</h2>
<pre><code>./
├── database.db
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── unoamuchos
│   │   │               ├── dao
│   │   │               │   ├── ComentarioDAO.java
│   │   │               │   ├── ManejaConexion.java
│   │   │               │   └── UsuarioDAO.java
│   │   │               ├── dto
│   │   │               │   └── ComentarioDTO.java
│   │   │               ├── modelo
│   │   │               │   ├── Comentario.java
│   │   │               │   └── Usuario.java
│   │   │               ├── servicio
│   │   │               │   └── ServicioComentario.java
│   │   │               └── utils
│   │   │                   └── Parsers.java
│   │   └── resources
│   └── test
│       ├── java
│       │   └── cl
│       │       └── lherrera
│       │           └── unoamuchos
│       │               └── servicio
│       │                   └── ServicioComentarioTest.java
│       └── resources
└── target
    ├── classes
    │   ├── META-INF
    │   │   ├── MANIFEST.MF
    │   │   └── maven
    │   │       └── cl.lherrera
    │   │           └── unoamuchos
    │   │               ├── pom.properties
    │   │               └── pom.xml
    │   └── cl
    │       └── lherrera
    │           └── unoamuchos
    │               ├── dao
    │               │   ├── ComentarioDAO.class
    │               │   ├── ManejaConexion.class
    │               │   └── UsuarioDAO.class
    │               ├── dto
    │               │   └── ComentarioDTO.class
    │               ├── modelo
    │               │   ├── Comentario.class
    │               │   └── Usuario.class
    │               ├── servicio
    │               │   └── ServicioComentario.class
    │               └── utils
    │                   └── Parsers.class
    └── test-classes
        └── cl
            └── lherrera
                └── unoamuchos
                    └── servicio
                        └── ServicioComentarioTest.class

38 directories, 23 files

</code></pre>

<h2 id="utilitarios">Utilitarios</h2>
<p>Cuando se intenta ingresar una fecha <code>Date</code> a la base de datos, mejor cambiamos el formato antes de enviarla a <code>java.sql.Date</code>. Es por esto que se crea esta clase utilitaria con un sólo método.</p>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/utils/Parsers.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.utils;

import java.util.Date;

public class Parsers {

    private Parsers() {}

    /**
     * Transforma un Date a un sql.date 
     */
    public static java.sql.Date toFechaDb(Date fecha){
        return new java.sql.Date(fecha.getTime());
    }
}
</code></pre>

<h2 id="pomxml"><code>pom.xml</code></h2>
<p><code>/unoamuchos/pom.xml</code></p>
<pre><code class="xml">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;cl.lherrera&lt;/groupId&gt;
    &lt;artifactId&gt;unoamuchos&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
            &lt;version&gt;3.30.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mockito&lt;/groupId&gt;
            &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;
            &lt;version&gt;2.28.2&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;
            &lt;version&gt;5.6.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-engine --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
            &lt;version&gt;5.6.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.junit.platform/junit-platform-launcher --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.platform&lt;/groupId&gt;
            &lt;artifactId&gt;junit-platform-launcher&lt;/artifactId&gt;
            &lt;version&gt;1.6.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>

<h2 id="clase-de-administracion-de-la-conexion-singlenton">Clase de administración de la conexión (<code>Singlenton</code>).</h2>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/dao/ManejaConexion.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.util.logging.Logger;


public class ManejaConexion {
    private static final String DB_URL = &quot;jdbc:sqlite:/Users/luisherrera/Desktop/TALENTO-PROS/servlets/relaciones/unoamuchos/database.db&quot;;
    private static final Logger milog = Logger.getLogger(ManejaConexion.class.getName());

    private static ManejaConexion manejaConexion = new ManejaConexion();

    private ManejaConexion() {
        if (manejaConexion != null){
            //Prevent Reflection
            throw new IllegalStateException(&quot;No se puede crear una nueva instancia de ManejaConexion&quot;);
        }
    }

    public static ManejaConexion obtenerManejo() {
        return manejaConexion;
    }


    public Connection obtenerConexion() throws SQLException {
        Connection conexion = null;

        try {
            Class.forName(&quot;org.sqlite.JDBC&quot;);
            conexion = DriverManager.getConnection(DB_URL, &quot;admin&quot;, &quot;1234&quot;);

        } catch (ClassNotFoundException e) {
            milog.severe(&quot;No se pudo cargar el driver.&quot;);
            milog.severe(e.getMessage());
        }

        return conexion;
    }
}

</code></pre>

<h2 id="test">Test</h2>
<p>Prueba dos servicios, el listar los comentarios de un usuario y almacenar un comentario en la base de datos.</p>
<p><code>/unoamuchos/src/test/java/cl/lherrera/unoamuchos/servicio/ServicioComentarioTest.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.servicio;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.time.Instant;
import java.util.Date;
import java.util.List;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import java.util.logging.Logger;

import cl.lherrera.unoamuchos.dto.ComentarioDTO;
import cl.lherrera.unoamuchos.modelo.Usuario;

@DisplayName(&quot;Prueba de los servicios de la persona&quot;)
public class ServicioComentarioTest {
    private static Logger logger = Logger.getLogger(ServicioComentarioTest.class.getName());
    ServicioComentario servicio = new ServicioComentario();

    @BeforeEach
    void porCada() {
        logger.info(&quot;Nuevo test___________________________________________________________________&quot;);
    }

    @Test
    @DisplayName(&quot;traer los comentariois de un usuario&quot;)
    void comentariosUsuarios() {
        // obtener los comentarios de un usuario
        Usuario luis = new Usuario(1, &quot;luis&quot;, null); // estos datos deben estar en la base de datos
        List&lt;ComentarioDTO&gt; comentarios = servicio.obtenerComentariosPorUsuario(luis);
        // listarlos
        comentarios.forEach(comentariodto -&gt; logger.info(comentariodto.toString()));
        // realizar el assert
        assertEquals(2, comentarios.size());
    }

    @Test
    @DisplayName(&quot;prueba de ingreso de comentario&quot;)
    void ingresoDeComentario() {
        // se crea un comentario DTO por que viene del front
        ComentarioDTO dtoComentario = new ComentarioDTO(Date.from(Instant.now()), &quot;luis&quot;, &quot;otro comentario&quot;);
        // se llama al servicio que ingresa
        int idComentario = servicio.ingresarComentario(dtoComentario);
        // listar
        Usuario luis = new Usuario(1, &quot;luis&quot;, null); 
        List&lt;ComentarioDTO&gt; comentarios = servicio.obtenerComentariosPorUsuario(luis);
        comentarios.forEach(comentariodto -&gt; logger.info(comentariodto.toString()));

        assertTrue(idComentario &gt; 0);

    }
}
</code></pre>

<h2 id="servicio-de-los-comentarios">Servicio de los comentarios</h2>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/servicio/ServicioComentario.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.servicio;

import java.util.ArrayList;
import java.util.List;

import cl.lherrera.unoamuchos.dao.ComentarioDAO;
import cl.lherrera.unoamuchos.dao.UsuarioDAO;
import cl.lherrera.unoamuchos.dto.ComentarioDTO;
import cl.lherrera.unoamuchos.modelo.Comentario;
import cl.lherrera.unoamuchos.modelo.Usuario;


public class ServicioComentario {
    private ComentarioDAO daoComentario = new ComentarioDAO();
    private UsuarioDAO daoUsuario = new UsuarioDAO();

    public List&lt;ComentarioDTO&gt; obtenerComentariosPorUsuario(Usuario usuario){
        List&lt;ComentarioDTO&gt; dtoComentarios = new ArrayList&lt;&gt;();
        List&lt;Comentario&gt; comentarios = daoComentario.obtenerComentariosPorUsuario(usuario);

        comentarios.forEach(comentario -&gt; {
            ComentarioDTO dtoComentario = new ComentarioDTO(
            comentario.getFecha(),
            comentario.getTexto(),
            comentario.getUsuario().getNombre()
            );
            dtoComentarios.add(dtoComentario);
        });

        return dtoComentarios;
    }

    public int ingresarComentario(ComentarioDTO dtoComentario) {
        Usuario usuario = daoUsuario.obtenerPorNombre(dtoComentario.getNombreUsuario());
        Comentario comentario = new Comentario();

        comentario.setFecha(dtoComentario.getFecha());
        comentario.setTexto(dtoComentario.getComentario());
        comentario.setUsuario(usuario);


        return daoComentario.ingresar(comentario);
    }
}

</code></pre>

<h2 id="dto">DTO</h2>
<p>Esta clase almacena los datos, según lo necesite la capa de presentación.</p>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/dto/ComentarioDTO.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.dto;

import java.io.Serializable;
import java.util.Date;

public class ComentarioDTO implements Serializable{

    private static final long serialVersionUID = -5148123916338477059L;

    private Date fecha;
    private String nombreUsuario;
    private String comentario;

    public ComentarioDTO() {}

    public ComentarioDTO(Date fecha, String nombreUsuario, String comentario) {
        this.fecha = fecha;
        this.nombreUsuario = nombreUsuario;
        this.comentario = comentario;
    }

    public Date getFecha() {
        return fecha;
    }
    public void setFecha(Date fecha) {
        this.fecha = fecha;
    }
    public String getNombreUsuario() {
        return nombreUsuario;
    }
    public void setNombreUsuario(String nombreUsuario) {
        this.nombreUsuario = nombreUsuario;
    }
    public String getComentario() {
        return comentario;
    }
    public void setComentario(String comentario) {
        this.comentario = comentario;
    }
    @Override
    public String toString() {
        return &quot;ComentarioDTO [fecha=&quot; + fecha + &quot;, nombreUsuario=&quot; + nombreUsuario + &quot;, comentario=&quot; + comentario
                + &quot;]&quot;;
    }

}

</code></pre>

<h2 id="daos">DAOS</h2>
<p>Para el ejemplo, solamente un servicio es requerido por esta clase.</p>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/dao/UsuarioDAO.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Logger;

import cl.lherrera.unoamuchos.modelo.Usuario;

public class UsuarioDAO {
    private static Logger logger = Logger.getLogger(UsuarioDAO.class.getName());
    private static ManejaConexion mc = ManejaConexion.obtenerManejo();

    public Usuario obtenerPorNombre(String nombre) {
        Usuario usuario = new Usuario();
        String sqlTxt = &quot;select id, nombre from usuario where nombre = '&quot; + nombre + &quot;'&quot;;

        try (Connection conexion = mc.obtenerConexion();
                PreparedStatement ps = conexion.prepareStatement(sqlTxt);
                ResultSet rs = ps.executeQuery();) {
            while (rs.next()) {
                usuario.setId(rs.getInt(&quot;id&quot;));
                usuario.setNombre(rs.getString(&quot;nombre&quot;));
            }
        } catch (SQLException e) {
            logger.severe(sqlTxt);
            logger.info(e.getMessage());
        }

        return usuario;
    }
}

</code></pre>

<p>Los comentarios en cambio, al evaluar en los test dos servicios de comentarios, esta implementación es más extensa.</p>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/dao/ComentarioDAO.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import java.util.logging.Logger;

import cl.lherrera.unoamuchos.modelo.Comentario;
import cl.lherrera.unoamuchos.modelo.Usuario;
import cl.lherrera.unoamuchos.utils.Parsers;

public class ComentarioDAO {
    private static Logger logger = Logger.getLogger(ComentarioDAO.class.getName());
    private static ManejaConexion mc = ManejaConexion.obtenerManejo();

    private int retornaIdAutoincrementado(PreparedStatement ps) {
        int idIngresado = 0;

        try (ResultSet rs = ps.getGeneratedKeys();) {
            if (rs.next()) {
                idIngresado = rs.getInt(1);
            }
        } catch (SQLException e) {
            logger.severe(e.getMessage());
        }
        return idIngresado;
    }

    public int ingresar(Comentario comentario) {
        int idIngresado = 0;

        String sqlQuery = &quot;&quot;
                + &quot;INSERT INTO comentario (fecha, texto, usuario_id) &quot;
                + &quot;VALUES (?, ?, ?)&quot;;

       try(
           Connection conexion = mc.obtenerConexion();
           PreparedStatement ps = conexion.prepareStatement(sqlQuery, Statement.RETURN_GENERATED_KEYS);

       ){
           // para la base de datos se va sqlelemente formateado.
           ps.setDate(1, Parsers.toFechaDb(comentario.getFecha()));
           ps.setString(2, comentario.getTexto());
           ps.setInt(3, comentario.getUsuario().getId());

           int filasAfectadas = ps.executeUpdate();
           // para llamar a esta función el ps debe estar ejecutado
           // o retorna cero.
           idIngresado = retornaIdAutoincrementado(ps);


           if(filasAfectadas != 1 || idIngresado == 0)
               throw new SQLException(&quot;Error al insertar registro&quot;);

       }catch (SQLException e) {
           logger.severe(e.getMessage());
       }

       return idIngresado;
   }

    public List&lt;Comentario&gt; obtenerComentariosPorUsuario(Usuario usuario){
        List&lt;Comentario&gt; comentarios = new ArrayList&lt;&gt;();

        String sqlTxt = &quot;&quot; 
                + &quot;select id, fecha, texto, usuario_id &quot;
                + &quot;from comentario &quot;
                + &quot;where usuario_id = &quot; + usuario.getId();

        try(
                Connection conexion = mc.obtenerConexion();
                PreparedStatement ps = conexion.prepareStatement(sqlTxt);
                ResultSet rs = ps.executeQuery();
        ){
            while(rs.next()) {
                SimpleDateFormat formato = new SimpleDateFormat(&quot;yyyy-MM-dd hh-mm&quot;);
                Date fecha = formato.parse(rs.getString(&quot;fecha&quot;));

                Comentario comentario = new Comentario(
                        rs.getInt(&quot;id&quot;),
                        fecha,
                        rs.getString(&quot;texto&quot;),
                        usuario);

                comentarios.add(comentario);                
            }

        }catch(SQLException | ParseException e) {
            logger.info(e.getMessage());
        }

        return comentarios;
    }

}

</code></pre>

<h2 id="modelo">Modelo</h2>
<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/modelo/Usuario.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.modelo;

import java.io.Serializable;
import java.util.List;

public class Usuario implements Serializable {
    private static final long serialVersionUID = 7144849864372688110L;

    private int id;
    private String nombre;
    private List&lt;Comentario&gt; comentarios;

    public Usuario(int id, String nombre, List&lt;Comentario&gt; comentarios) {
        super();
        this.id = id;
        this.nombre = nombre;
        this.comentarios = comentarios;
    }

    public Usuario() {}

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public List&lt;Comentario&gt; getComentarios() {
        return comentarios;
    }

    public void setComentarios(List&lt;Comentario&gt; comentarios) {
        this.comentarios = comentarios;
    }
}

</code></pre>

<p><code>/unoamuchos/src/main/java/cl/lherrera/unoamuchos/modelo/Comentario.java</code></p>
<pre><code class="java">package cl.lherrera.unoamuchos.modelo;

import java.io.Serializable;
import java.util.Date;

public class Comentario implements Serializable {
    private static final long serialVersionUID = 152095113347974183L;

    private int id;
    private Date fecha;
    private String texto;
    private Usuario usuario;

    public Comentario() {}

    public Comentario(int id, Date fecha, String texto, Usuario usuario) {
        super();
        this.id = id;
        this.fecha = fecha;
        this.texto = texto;
        this.usuario = usuario;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public Date getFecha() {
        return fecha;
    }

    public void setFecha(Date fecha) {
        this.fecha = fecha;
    }

    public String getTexto() {
        return texto;
    }

    public void setTexto(String texto) {
        this.texto = texto;
    }

    public Usuario getUsuario() {
        return usuario;
    }

    public void setUsuario(Usuario usuario) {
        this.usuario = usuario;
    }
}
</code></pre>

<hr />
<h1 id="todo">TODO 🥋</h1>
<hr />
<p>En una empresa, se necesita crear un organigrama, para esto en las primeras reuniones con el cliente, se concluye que se necesitan al menos dos servicios para solucionar este problema, el primero que indique de un empleado, ¿quién es el jefe?, y ¿cuales son los empleados que posee un jefe?. </p>
<p>Realizar esta solución utilizando una tabla <code>recursiva</code>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
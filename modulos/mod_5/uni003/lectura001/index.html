


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Lectura001 - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unidad-31-modelo" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Lectura001
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../ejercicios/repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jdbc" class="md-nav__link">
    JDBC
  </a>
  
    <nav class="md-nav" aria-label="JDBC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    Introducción
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#que-es-jdbctemplate" class="md-nav__link">
    ¿Qué es JdbcTemplate?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usando-y-entendiendo-jdbc" class="md-nav__link">
    Usando y entendiendo JDBC.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#que-driver-debo-elegir" class="md-nav__link">
    ¿Qué Driver debo elegir?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entendiendo-spring-jdbc-jdbctemplate" class="md-nav__link">
    Entendiendo Spring JDBC (JdbcTemplate).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-la-capa-de-acceso-a-datos" class="md-nav__link">
    Creando la capa de acceso a datos.
  </a>
  
    <nav class="md-nav" aria-label="Creando la capa de acceso a datos.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    DDL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estructura" class="md-nav__link">
    Estructura:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archivos-modificados" class="md-nav__link">
    Archivos modificados.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion" class="md-nav__link">
    Implementación
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-capa-de-servicio" class="md-nav__link">
    La capa de servicio
  </a>
  
    <nav class="md-nav" aria-label="La capa de servicio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion_1" class="md-nav__link">
    Introducción
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#los-estereotipos-de-spring" class="md-nav__link">
    Los estereotipos de Spring.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crud-con-jdbctemplate" class="md-nav__link">
    CRUD con JdbcTemplate.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proyecto-completo-lectura" class="md-nav__link">
    Proyecto completo Lectura
  </a>
  
    <nav class="md-nav" aria-label="Proyecto completo Lectura">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ddl-borrador" class="md-nav__link">
    DDL - BORRADOR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archivos-modificados_1" class="md-nav__link">
    Archivos modificados
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <blockquote>
<h1 id="unidad-31-modelo"><strong>Unidad 3.1 - Modelo</strong></h1>
<blockquote>
<ul>
<li>Esta guía es de soporte a la lectura, se debe ir recorriendo junto a la lectura 1</li>
</ul>
</blockquote>
</blockquote>
<hr />
<p><br /></p>
<p>(1)</p>
<hr />
<h2 id="jdbc">JDBC</h2>
<hr />
<h3 id="introduccion">Introducción</h3>
<ul>
<li>conocer JDBC</li>
<li>diferencias que tiene con <code>JdbcTemplate</code>.</li>
<li>cómo utilizarlo y sus ventajas y desventajas.</li>
<li>ejemplo de implementación de <code>JdbcTemplate</code> con una aplicación básica que consulta una tabla de base de datos.</li>
</ul>
<p>(2)</p>
<h3 id="que-es-jdbctemplate">¿Qué es <code>JdbcTemplate</code>?</h3>
<ul>
<li><code>Java DataBase Connectivity</code></li>
<li>crearon funciones predefinidas.</li>
<li>podemos llamar más fácilmente las conexiones</li>
<li>API soporta la mayoría de las bases de datos más conocidas que utilizan SQL como lenguaje, como PostgreSQL, MySQL Server, Oracle 11g, etc.</li>
</ul>
<p>(3)</p>
<h3 id="usando-y-entendiendo-jdbc">Usando y entendiendo JDBC.</h3>
<p>Ya hemos conocido el funcionamiento de JDBC, para conectar SQLite y Oracle. por lo tanto nos podemos saltar esta parte.</p>
<p>Se habla de los tipos de datos a elegir, nosotros ya hemos trabajado con <code>Oracle 11 Database Thin Type 4 JDBC</code> que es de tipo 4. Tipo 4 - 100% <code>Pure</code> Java: Se comunica diréctamente con el SGBD sin intermediarios. Es el <code>driver</code> de mejor performance disponible y por lo general es provisto por el mismo creador del SGBD (Sistema de gestión de base de datos).</p>
<h3 id="que-driver-debo-elegir">¿Qué Driver debo elegir?</h3>
<ul>
<li><strong>Si estás accediendo sólo a un tipo de SGBD, tu opción es el de tipo 4.</strong></li>
<li>Si tu aplicación consulta múltiples SGBD al mismo tiempo, debes usar el 3. </li>
<li>Si el motor de bases de datos que se utiliza no provee de un <code>driver</code> de tipo 3 ni 4, deberías usar el <code>driver</code> de tipo 2. </li>
<li>El <code>driver</code> de tipo 1 no es considerado un <code>driver</code> que pueda utilizarse en sistemas en ambientes productivos, sólo debería utilizarse para ambientes de desarrollo (es muy raro ver este tipo de <code>driver</code>, ya que es muy antiguo).</li>
</ul>
<p><strong>Explicación por qué con Oracle podemos saltarnos en <code>Class.forName()...</code></strong></p>
<p>En versiones anteriores a la 4.0 de JDBC (JDK 5 o posterior) se debe agregar el nombre del Driver a utilizar con <code>Class.forName("foo.Driver")</code> antes de declarar <code>Connection</code> , ya que <code>DriverManager</code> no realiza el escaneo automáticamente el proyecto para buscar el Driver necesario para generar la conexión, para que este escaneo funcione se debe establecer el nombre de la clase Driver a utilizar dentro de un archivo <code>.properties</code> (en <code>src/main/resources</code>) que contenga la entrada <code>jdbc.Drivers=foo.Driver</code>. Esto ayuda a no fallar con el principio DRY, ya que no se debe utilizar <code>Class.forName("foo.Driver")</code> en cada conexión.</p>
<p>Lo demás son imágenes y algunos métodos con consultas incrustadas, se mezcla lógica de acceso a datos y lógica de negocio. Es por eso que las siguientes páginas son solamente expositivas.</p>
<p>(7)</p>
<h3 id="entendiendo-spring-jdbc-jdbctemplate">Entendiendo Spring JDBC (<code>JdbcTemplate</code>).</h3>
<ul>
<li>JDBC es una API muy pesada en si misma hablando en el contexto de lo que el servidor ejecuta cada vez que se realiza una conexión. (Aunque con un Síngleton exista solamente una instancia).</li>
</ul>
<p>Un encontrar todos normal en JDBC</p>
<pre><code class="java">public List&lt;Usuario&gt; findAll() {
    try (Connection con = DriverManager.getConnection(&quot;jdbc:oracle:thin:@localhost:xe&quot;, &quot;root&quot;, &quot;root&quot;)) {
        List&lt;Usuario&gt; usuarios = new ArrayList&lt;&gt;();
        Usuario usuario = null;
        Statement stmt = con.createStatement(&quot;select login, clave from Usuario&quot;);
        ResultSet rs = stmt.execute();
        while (rs.next()) {
            usuario = new Usuario(rs.getString(1), rs.getString(2));
            usuarios.add(usuario);
        }
        return usuarios;
    } catch (Exception e) {
        System.out.println(e);
    }
}
</code></pre>

<p>Ejemplo con JDBC-TEMPLATE.</p>
<pre><code class="java">public List&lt;Usuario&gt; findAll(){ 
    return jdbcTemplate.query(&quot;select login, clave from Usuario&quot;, new UsuarioMapper()); 
}
</code></pre>

<p>(9)</p>
<hr />
<h2 id="creando-la-capa-de-acceso-a-datos">Creando la capa de acceso a datos.</h2>
<hr />
<p>La siguiente, es una aplicación, es un ejemplo del uso de JDBC-TEMPLATE y el trabajo de la capa de acceso a datos con Spring.</p>
<p>Incluir: <code>JDBC-API</code></p>
<h3 id="ddl">DDL</h3>
<pre><code>Motor: `Oracle 11g`
Credenciales:
    Usuario Administrador: `system`, `oracle`
    Usuario Aplicación: `mod5u2l1`, `1234`
</code></pre>

<pre><code class="sql">CREATE TABLE USUARIO (
    ID_USUARIO NUMBER(18),
    NOMBRE VARCHAR2(200),
    CLAVE VARCHAR2(200),
    RUT NUMBER(10),
    DV CHAR
);

-- autoincremental
CREATE SEQUENCE SQ_USUARIO MINVALUE 1 START WITH 1 INCREMENT BY 1 CACHE 10;
</code></pre>

<pre><code class="sql">INSERT INTO
    &quot;ROOT&quot;.&quot;USUARIO&quot; (&quot;ID_USUARIO&quot;, &quot;NOMBRE&quot;, &quot;CLAVE&quot;, &quot;RUT&quot;, &quot;DV&quot;)
VALUES
    (SQ_USUARIO.nextval, 'user1', 'clave1', 10, '9');

INSERT INTO
    &quot;ROOT&quot;.&quot;USUARIO&quot; (&quot;ID_USUARIO&quot;, &quot;NOMBRE&quot;, &quot;CLAVE&quot;, &quot;RUT&quot;, &quot;DV&quot;)
VALUES
    (SQ_USUARIO.nextval, 'user2', 'clave2', 10, 'k');
</code></pre>

<h3 id="estructura">Estructura:</h3>
<pre><code>./
├── HELP.md
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── m5u3001
│   │   │               ├── AppConfig.java
│   │   │               ├── M5u3001Application.java
│   │   │               ├── ServletInitializer.java
│   │   │               ├── daos
│   │   │               │   ├── UsuarioDAO.java
│   │   │               │   └── UsuarioDAOImpl.java
│   │   │               ├── mappers
│   │   │               │   └── UsuarioMapper.java
│   │   │               └── models
│   │   │                   └── Usuario.java
│   │   ├── resources
│   │   │   ├── application.properties
│   │   │   ├── database.properties
│   │   │   ├── static
│   │   │   └── templates
│   │   └── webapp
│   └── test
│       └── java
│           └── cl
│               └── lherrera
│                   └── m5u3001
│                       ├── M5u3001ApplicationTests.java
│                       └── daos
│                           └── UsuarioDaoImplTest.java
└── target
    ├── classes
    │   ├── application.properties
    │   ├── cl
    │   │   └── lherrera
    │   │       └── m5u3001
    │   │           ├── AppConfig.class
    │   │           ├── M5u3001Application.class
    │   │           ├── ServletInitializer.class
    │   │           ├── daos
    │   │           │   ├── UsuarioDAO.class
    │   │           │   └── UsuarioDAOImpl.class
    │   │           ├── mappers
    │   │           │   └── UsuarioMapper.class
    │   │           └── models
    │   │               └── Usuario.class
    │   └── database.properties
    ├── generated-sources
    │   └── annotations
    ├── generated-test-sources
    │   └── test-annotations
    ├── m2e-wtp
    │   └── web-resources
    │       └── META-INF
    │           ├── MANIFEST.MF
    │           └── maven
    │               └── cl.lherrera.m4u2l2
    │                   └── m4u3l1
    │                       ├── pom.properties
    │                       └── pom.xml
    ├── m4u3l1-0.0.1-SNAPSHOT
    │   ├── META-INF
    │   └── WEB-INF
    │       ├── classes
    │       │   ├── application.properties
    │       │   ├── cl
    │       │   │   └── lherrera
    │       │   │       └── m4u2l2
    │       │   │           ├── AppConfig.class
    │       │   │           ├── M4u3l1Application.class
    │       │   │           ├── ServletInitializer.class
    │       │   │           ├── daos
    │       │   │           │   ├── UsuarioDAO.class
    │       │   │           │   └── UsuarioDAOImpl.class
    │       │   │           ├── mappers
    │       │   │           │   └── UsuarioMapper.class
    │       │   │           └── models
    │       │   │               └── Usuario.class
    │       │   └── database.properties
    │       └── lib
    │           ├── HikariCP-3.4.2.jar
    │           ├── classmate-1.5.1.jar
    │           ├── hibernate-validator-6.0.18.Final.jar
    │           ├── jackson-annotations-2.10.3.jar
    │           ├── jackson-core-2.10.3.jar
    │           ├── jackson-databind-2.10.3.jar
    │           ├── jackson-datatype-jdk8-2.10.3.jar
    │           ├── jackson-datatype-jsr310-2.10.3.jar
    │           ├── jackson-module-parameter-names-2.10.3.jar
    │           ├── jakarta.annotation-api-1.3.5.jar
    │           ├── jakarta.validation-api-2.0.2.jar
    │           ├── jboss-logging-3.4.1.Final.jar
    │           ├── jul-to-slf4j-1.7.30.jar
    │           ├── log4j-api-2.12.1.jar
    │           ├── log4j-to-slf4j-2.12.1.jar
    │           ├── logback-classic-1.2.3.jar
    │           ├── logback-core-1.2.3.jar
    │           ├── ojdbc8-12.2.0.1.jar
    │           ├── slf4j-api-1.7.30.jar
    │           ├── snakeyaml-1.25.jar
    │           ├── spring-aop-5.2.5.RELEASE.jar
    │           ├── spring-beans-5.2.5.RELEASE.jar
    │           ├── spring-boot-2.2.6.RELEASE.jar
    │           ├── spring-boot-autoconfigure-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-jdbc-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-json-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-logging-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-validation-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-web-2.2.6.RELEASE.jar
    │           ├── spring-context-5.2.5.RELEASE.jar
    │           ├── spring-core-5.2.5.RELEASE.jar
    │           ├── spring-expression-5.2.5.RELEASE.jar
    │           ├── spring-jcl-5.2.5.RELEASE.jar
    │           ├── spring-jdbc-5.2.5.RELEASE.jar
    │           ├── spring-tx-5.2.5.RELEASE.jar
    │           ├── spring-web-5.2.5.RELEASE.jar
    │           ├── spring-webmvc-5.2.5.RELEASE.jar
    │           └── ucp-12.2.0.1.jar
    ├── m4u3l1-0.0.1-SNAPSHOT.war
    ├── m4u3l1-0.0.1-SNAPSHOT.war.original
    ├── maven-archiver
    │   └── pom.properties
    ├── maven-status
    │   └── maven-compiler-plugin
    │       ├── compile
    │       │   └── default-compile
    │       │       ├── createdFiles.lst
    │       │       └── inputFiles.lst
    │       └── testCompile
    │           └── default-testCompile
    │               ├── createdFiles.lst
    │               └── inputFiles.lst
    ├── surefire-reports
    │   ├── TEST-cl.lherrera.m4u2l2.M4u3l1ApplicationTests.xml
    │   ├── TEST-cl.lherrera.m4u2l2.daos.UsuarioDaoImplTest.xml
    │   ├── cl.lherrera.m4u2l2.M4u3l1ApplicationTests.txt
    │   └── cl.lherrera.m4u2l2.daos.UsuarioDaoImplTest.txt
    └── test-classes
        └── cl
            └── lherrera
                └── m5u3001
                    ├── M5u3001ApplicationTests.class
                    └── daos
                        └── UsuarioDaoImplTest.class

61 directories, 88 files

</code></pre>

<h3 id="archivos-modificados">Archivos modificados.</h3>
<ul>
<li><code>/m5u3l001/pom.xml</code><ul>
<li>Contiene el Driver para la utilización de Oracle 11g con Maven. Ya que el repositorio no es Maven Central, este Driver del tipo 4 no se permite estar en Maven Central.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/AppConfig.java</code><ul>
<li>Contiene la configuración personalizada para el ambiente en el que se esté desarrollando esta aplicación.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAO.java</code><ul>
<li>Interfaz del acceso a los datos del usuario.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAOImpl.java</code><ul>
<li>Una implementación de la interfaz de acceso a los datos.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/mappers/UsuarioMapper.java</code><ul>
<li>Clase necesaria para que JDVC-TEMPLATE haga el mapa de los datos del modelo usuario, nos ahorra el tener que hacer el <code>while(rs.next())...</code>, además es casi seguro que <code>Spring</code> maneja mejor que nosotros la conexión.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/models/Usuario.java</code><ul>
<li>Modelo contenedor de los datos de usuario.</li>
</ul>
</li>
<li><code>/m5u3l001/src/main/resources/database.properties</code><ul>
<li>Propiedades especialmente diseñadas para la base de datos. Se supone que esto debe estar en el <code>gitignore</code>, ya que producción debe poseer uno propio con otras credenciales más seguras.</li>
</ul>
</li>
<li><code>/m5u3l001/src/test/java/cl/lherrera/m5u3001/daos/UsuarioDaoImplTest.java</code><ul>
<li>Prueba el listar usuarios</li>
</ul>
</li>
</ul>
<h3 id="implementacion">Implementación</h3>
<ul>
<li><code>/m5u3l001/pom.xml</code></li>
</ul>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.m4u2l2&lt;/groupId&gt;
    &lt;artifactId&gt;m4u3l1&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;m4u3l1&lt;/name&gt;
    &lt;description&gt;Lectura 2 mod 4 uni 2&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.oracle.jdbc&lt;/groupId&gt;
            &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;
            &lt;version&gt;12.2.0.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE # --&gt;

    &lt;/dependencies&gt;

    &lt;!-- ODBC-ORACLE --&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;xwiki-externals&lt;/id&gt;
            &lt;name&gt;https://maven.xwiki.org/externals/&lt;/name&gt;
            &lt;url&gt;https://maven.xwiki.org/externals/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;!-- ODBC-ORACLE # --&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/AppConfig.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

@Configuration
@ComponentScan(&quot;com.latam.usuarios&quot;)
@PropertySource(&quot;classpath:database.properties&quot;)
public class AppConfig {
    @Autowired
    Environment environment;

    @Bean
    DataSource dataSource() {
        DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();
        driverManagerDataSource.setUrl(environment.getProperty(&quot;url&quot;));
        driverManagerDataSource.setUsername(environment.getProperty(&quot;dbuser&quot;));
        driverManagerDataSource.setPassword(environment.getProperty(&quot;dbpassword&quot;));
        driverManagerDataSource.setDriverClassName(environment.getProperty(&quot;driver&quot;));
        return driverManagerDataSource;
    }
}
</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAO.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import java.util.List;

import cl.lherrera.m5u3001.models.Usuario;

public interface UsuarioDAO {
    List&lt;Usuario&gt; getAllUsuarios();
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAOImpl.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import java.util.List;
import javax.sql.DataSource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import cl.lherrera.m5u3001.mappers.UsuarioMapper;
import cl.lherrera.m5u3001.models.Usuario;


@Repository
public class UsuarioDAOImpl implements UsuarioDAO {
    JdbcTemplate jdbcTemplate;

    @Autowired
    public UsuarioDAOImpl(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public List&lt;Usuario&gt; getAllUsuarios() {
        return jdbcTemplate.query(&quot;select * from usuario&quot;, new UsuarioMapper());
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/mappers/UsuarioMapper.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.mappers;

import java.sql.ResultSet;
import java.sql.SQLException;
import org.springframework.jdbc.core.RowMapper;

import cl.lherrera.m5u3001.models.Usuario;

public class UsuarioMapper implements RowMapper&lt;Usuario&gt; {

    public Usuario mapRow(ResultSet resultSet, int i) throws SQLException {
        Usuario usuario = new Usuario();
        usuario.setIdUsuario(resultSet.getInt(&quot;id_usuario&quot;));
        usuario.setNombre(resultSet.getString(&quot;nombre&quot;));
        usuario.setClave(resultSet.getString(&quot;clave&quot;));
        usuario.setRut(resultSet.getInt(&quot;rut&quot;));
        usuario.setDv(resultSet.getString(&quot;dv&quot;));
        return usuario;
    }

}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/models/Usuario.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.models;

public class Usuario {
    private Integer idUsuario;
    private String nombre;
    private String clave;
    private Integer rut;
    private String dv;


    public Usuario() {}

    public Usuario(Integer idUsuario, String nombre, String clave, Integer rut, String dv) {
        this.idUsuario = idUsuario;
        this.nombre = nombre;
        this.clave = clave;
        this.rut = rut;
        this.dv = dv;
    }

    public Integer getIdUsuario() {
        return idUsuario;
    }

    public void setIdUsuario(Integer idUsuario) {
        this.idUsuario = idUsuario;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public String getClave() {
        return clave;
    }

    public void setClave(String clave) {
        this.clave = clave;
    }

    public Integer getRut() {
        return rut;
    }

    public void setRut(Integer rut) {
        this.rut = rut;
    }

    public String getDv() {
        return dv;
    }

    public void setDv(String dv) {
        this.dv = dv;
    }

    @Override
    public String toString() {
        return &quot;Usuario [idUsuario=&quot; + idUsuario + &quot;, nombre=&quot; + nombre + &quot;, clave=&quot; + clave + &quot;, rut=&quot; + rut + &quot;, dv=&quot;
                + dv + &quot;]&quot;;
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/resources/database.properties</code></li>
</ul>
<pre><code class="conf">driver=oracle.jdbc.driver.OracleDriver
url=jdbc:oracle:thin:@localhost:1521:xe
dbuser=mod5u2l1
dbpassword=1234
</code></pre>

<ul>
<li><code>/m5u3l001/src/test/java/cl/lherrera/m5u3001/daos/UsuarioDaoImplTest.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.util.List;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.m5u3001.daos.UsuarioDAOImpl;
import cl.lherrera.m5u3001.models.Usuario;

@SpringBootTest
@DisplayName(&quot;Pruebas unitarias del DAO&quot;)
public class UsuarioDaoImplTest {

    @Autowired
    private UsuarioDAOImpl daoUsuario;


    @Test
    @DisplayName(&quot;Traer todos los usuarios&quot;)
    public void prueba001() {
        // guadamos en una lista los usuarios
        List&lt;Usuario&gt; usuarios = daoUsuario.getAllUsuarios();
        // deben existir 2 usuarios en la base de datos
        assertEquals(2, usuarios.size());
    }
}
</code></pre>

<p>(20)</p>
<hr />
<h2 id="la-capa-de-servicio">La capa de servicio</h2>
<hr />
<h3 id="introduccion_1">Introducción</h3>
<ul>
<li>vamos a crear la capa de servicio de la aplicación de usuarios que comenzamos en el capítulo 1 de la unidad. </li>
<li>es aquella que manejará todos los cálculos "lógica" del negocio que se necesiten hacer en la aplicación.</li>
<li>mantener el código ordenado, , siempre sabremos dónde buscar.</li>
</ul>
<h3 id="los-estereotipos-de-spring">Los estereotipos de Spring.</h3>
<ul>
<li>Los estereotipos, en resumen, son interfaces que al ser implementadas (o al usar su anotación) van a ser tratadas como un Bean.</li>
<li>Las anotaciones <code>@Service</code>, <code>@Controller</code> y <code>@Repository</code> Son estereotipos de <code>org.springframework.stereotype</code> y estas tres anotaciones son <code>@Component</code>, donde (comprobar, aceptable por ahora: los componentes son "componentes de negocio" y sus anotaciones estereotipados, son el tipo de componente, cada rol con su anotación). La finalidad de la capa de servicio es Quitar la lógica de negocio del controlador.</li>
</ul>
<p>(27)</p>
<hr />
<h2 id="crud-con-jdbctemplate">CRUD con <code>JdbcTemplate</code>.</h2>
<hr />
<p>Se expondrán además en el siguiente ejemplo, el uso de un <code>CRUD</code> usando <code>JDBC-TEMPLATE``
(Se puede seguir con la lectura, aunque el del ejemplo</code>lherrera`, posee cambios)</p>
<hr />
<h2 id="proyecto-completo-lectura">Proyecto completo Lectura</h2>
<hr />
<p>Hay que tener en cuenta que el servicio incluido en el siguiente ejemplo, es a modo de ejemplo, no es una práctica muy utilizada </p>
<h3 id="ddl-borrador">DDL - BORRADOR</h3>
<pre><code class="sql">create table USUARIO (
    ID_USUARIO NUMBER(18),
    NOMBRE VARCHAR2(200),
    CLAVE VARCHAR2(200),
    RUT NUMBER(10),
    DV CHAR
);

CREATE SEQUENCE SQ_USUARIO MINVALUE 1 START WITH 1 INCREMENT BY 1 CACHE 10;

SELECT * FROM USUARIO;

-- delete from usuario where nombre = 'test2'

INSERT INTO USUARIO (&quot;ID_USUARIO&quot;, &quot;NOMBRE&quot;, &quot;CLAVE&quot;, &quot;RUT&quot;, &quot;DV&quot;)
VALUES
    (SQ_USUARIO.nextval, 'user1', 'clave1', 10, '9');


INSERT INTO USUARIO (&quot;ID_USUARIO&quot;, &quot;NOMBRE&quot;, &quot;CLAVE&quot;, &quot;RUT&quot;, &quot;DV&quot;)
VALUES
    (SQ_USUARIO.nextval, 'user2', 'clave2', 10, 'k');

select * from USUARIO where nombre='user1' and clave='clave1' and rownum = 1
</code></pre>

<p>Estructura</p>
<pre><code>./
├── HELP.md
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── m5u3001
│   │   │               ├── AppConfig.java
│   │   │               ├── M5u3001Application.java
│   │   │               ├── ServletInitializer.java
│   │   │               ├── daos
│   │   │               │   ├── UsuarioDAO.java
│   │   │               │   └── UsuarioDAOImpl.java
│   │   │               ├── mappers
│   │   │               │   └── UsuarioMapper.java
│   │   │               ├── models
│   │   │               │   └── Usuario.java
│   │   │               ├── services
│   │   │               │   ├── UsuarioService.java
│   │   │               │   └── UsuarioServiceImpl.java
│   │   │               └── vo
│   │   │                   └── UsuarioVO.java
│   │   ├── resources
│   │   │   ├── application.properties
│   │   │   ├── database.properties
│   │   │   ├── static
│   │   │   └── templates
│   │   └── webapp
│   └── test
│       └── java
│           └── cl
│               └── lherrera
│                   └── m5u3001
│                       ├── M5u3001ApplicationTests.java
│                       ├── daos
│                       │   └── UsuarioDaoImplTest.java
│                       └── services
│                           └── UsuarioServiceTest.java
└── target
    ├── classes
    │   ├── application.properties
    │   ├── cl
    │   │   └── lherrera
    │   │       └── m5u3001
    │   │           ├── AppConfig.class
    │   │           ├── M5u3001Application.class
    │   │           ├── ServletInitializer.class
    │   │           ├── daos
    │   │           │   ├── UsuarioDAO.class
    │   │           │   └── UsuarioDAOImpl.class
    │   │           ├── mappers
    │   │           │   └── UsuarioMapper.class
    │   │           ├── models
    │   │           │   └── Usuario.class
    │   │           ├── services
    │   │           │   ├── UsuarioService.class
    │   │           │   └── UsuarioServiceImpl.class
    │   │           └── vo
    │   │               └── UsuarioVO.class
    │   └── database.properties
    ├── generated-sources
    │   └── annotations
    ├── generated-test-sources
    │   └── test-annotations
    ├── m2e-wtp
    │   └── web-resources
    │       └── META-INF
    │           ├── MANIFEST.MF
    │           └── maven
    │               └── cl.lherrera.m4u2l2
    │                   └── m4u3l1
    │                       ├── pom.properties
    │                       └── pom.xml
    ├── m4u3l1-0.0.1-SNAPSHOT
    │   ├── META-INF
    │   └── WEB-INF
    │       ├── classes
    │       │   ├── application.properties
    │       │   ├── cl
    │       │   │   └── lherrera
    │       │   │       └── m4u2l2
    │       │   │           ├── AppConfig.class
    │       │   │           ├── M4u3l1Application.class
    │       │   │           ├── ServletInitializer.class
    │       │   │           ├── daos
    │       │   │           │   ├── UsuarioDAO.class
    │       │   │           │   └── UsuarioDAOImpl.class
    │       │   │           ├── mappers
    │       │   │           │   └── UsuarioMapper.class
    │       │   │           └── models
    │       │   │               └── Usuario.class
    │       │   └── database.properties
    │       └── lib
    │           ├── HikariCP-3.4.2.jar
    │           ├── classmate-1.5.1.jar
    │           ├── hibernate-validator-6.0.18.Final.jar
    │           ├── jackson-annotations-2.10.3.jar
    │           ├── jackson-core-2.10.3.jar
    │           ├── jackson-databind-2.10.3.jar
    │           ├── jackson-datatype-jdk8-2.10.3.jar
    │           ├── jackson-datatype-jsr310-2.10.3.jar
    │           ├── jackson-module-parameter-names-2.10.3.jar
    │           ├── jakarta.annotation-api-1.3.5.jar
    │           ├── jakarta.validation-api-2.0.2.jar
    │           ├── jboss-logging-3.4.1.Final.jar
    │           ├── jul-to-slf4j-1.7.30.jar
    │           ├── log4j-api-2.12.1.jar
    │           ├── log4j-to-slf4j-2.12.1.jar
    │           ├── logback-classic-1.2.3.jar
    │           ├── logback-core-1.2.3.jar
    │           ├── ojdbc8-12.2.0.1.jar
    │           ├── slf4j-api-1.7.30.jar
    │           ├── snakeyaml-1.25.jar
    │           ├── spring-aop-5.2.5.RELEASE.jar
    │           ├── spring-beans-5.2.5.RELEASE.jar
    │           ├── spring-boot-2.2.6.RELEASE.jar
    │           ├── spring-boot-autoconfigure-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-jdbc-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-json-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-logging-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-validation-2.2.6.RELEASE.jar
    │           ├── spring-boot-starter-web-2.2.6.RELEASE.jar
    │           ├── spring-context-5.2.5.RELEASE.jar
    │           ├── spring-core-5.2.5.RELEASE.jar
    │           ├── spring-expression-5.2.5.RELEASE.jar
    │           ├── spring-jcl-5.2.5.RELEASE.jar
    │           ├── spring-jdbc-5.2.5.RELEASE.jar
    │           ├── spring-tx-5.2.5.RELEASE.jar
    │           ├── spring-web-5.2.5.RELEASE.jar
    │           ├── spring-webmvc-5.2.5.RELEASE.jar
    │           └── ucp-12.2.0.1.jar
    ├── m4u3l1-0.0.1-SNAPSHOT.war
    ├── m4u3l1-0.0.1-SNAPSHOT.war.original
    ├── maven-archiver
    │   └── pom.properties
    ├── maven-status
    │   └── maven-compiler-plugin
    │       ├── compile
    │       │   └── default-compile
    │       │       ├── createdFiles.lst
    │       │       └── inputFiles.lst
    │       └── testCompile
    │           └── default-testCompile
    │               ├── createdFiles.lst
    │               └── inputFiles.lst
    ├── surefire-reports
    │   ├── TEST-cl.lherrera.m4u2l2.M4u3l1ApplicationTests.xml
    │   ├── TEST-cl.lherrera.m4u2l2.daos.UsuarioDaoImplTest.xml
    │   ├── cl.lherrera.m4u2l2.M4u3l1ApplicationTests.txt
    │   └── cl.lherrera.m4u2l2.daos.UsuarioDaoImplTest.txt
    └── test-classes
        └── cl
            └── lherrera
                └── m5u3001
                    ├── M5u3001ApplicationTests.class
                    ├── daos
                    │   └── UsuarioDaoImplTest.class
                    └── services
                        └── UsuarioServiceTest.class

67 directories, 96 files

</code></pre>

<h2 id="archivos-modificados_1">Archivos modificados</h2>
<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/AppConfig.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

@Configuration
@ComponentScan(&quot;com.latam.usuarios&quot;)
@PropertySource(&quot;classpath:database.properties&quot;)
public class AppConfig {
    @Autowired
    Environment environment;

    @Bean
    DataSource dataSource() {
        DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();
        driverManagerDataSource.setUrl(environment.getProperty(&quot;url&quot;));
        driverManagerDataSource.setUsername(environment.getProperty(&quot;dbuser&quot;));
        driverManagerDataSource.setPassword(environment.getProperty(&quot;dbpassword&quot;));
        driverManagerDataSource.setDriverClassName(environment.getProperty(&quot;driver&quot;));
        return driverManagerDataSource;
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAO.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import java.util.List;

import cl.lherrera.m5u3001.models.Usuario;

public interface UsuarioDAO {

    List&lt;Usuario&gt; getAllUsuarios();
    Usuario findByNombreAndClave(String nombre, String clave);

    /* 
    * Nuevos métodos del CRUD 
    */
    public int add(Usuario usuario); 
    public int update(Usuario usuario); 
    public int delete(Usuario usuario);
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/daos/UsuarioDAOImpl.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import java.util.List;
import javax.sql.DataSource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import cl.lherrera.m5u3001.mappers.UsuarioMapper;
import cl.lherrera.m5u3001.models.Usuario;

@Repository
public class UsuarioDAOImpl implements UsuarioDAO {
    JdbcTemplate jdbcTemplate;

    @Autowired
    public UsuarioDAOImpl(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public List&lt;Usuario&gt; getAllUsuarios() {
        return jdbcTemplate.query(&quot;select * from usuario&quot;, new UsuarioMapper());
    }

    public Usuario findByNombreAndClave(String nombre, String clave) {

        // Se utilizan &quot;?&quot; para denotar las posiciónes de los parámetros (límite 1)
        // se limita por que pueden existir varios con el mismo nombre.
        String sqlText = &quot;select * from USUARIO where nombre=? and clave=? and rownum = 1&quot;;

        // Esta es la lista que llenará los signos de interrogación de la consulta.
        // Otra utlidad para ahorrar el rs.setString()...
        Object[] parametros = new Object[] { nombre, clave };

        // Se le pasa una implementación de RowMapper&lt;T&gt; (En este caso una de Usuario)
        UsuarioMapper mapaDeUsuario = new UsuarioMapper();

        // el retorno es según el tipo de mapa.
        return jdbcTemplate.queryForObject(sqlText, parametros, mapaDeUsuario);
    }

    // CRUD
    @Override
    public int add(Usuario usuario) {
        return jdbcTemplate.update(
                &quot;insert into usuario values (sq_usuario.nextval, ?, ?, ?, ?)&quot;, 
                usuario.getNombre(),
                usuario.getClave(), 
                usuario.getRut(), 
                usuario.getDv()
        );
    }

    @Override
    public int update(Usuario usuario) {
        return jdbcTemplate.update(
                &quot;update usuario set nombre = ?, clave = ?,  rut = ?, dv = ? where id_usuario = ?&quot;,
                usuario.getNombre(), 
                usuario.getClave(), 
                usuario.getRut(), 
                usuario.getDv(), 
                usuario.getIdUsuario()
        );
    }

    @Override
    public int delete(Usuario usuario) {
        return jdbcTemplate.update(
                &quot;delete from usuario where id_usuario = ?&quot;, 
                usuario.getIdUsuario()
        );
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/mappers/UsuarioMapper.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.mappers;

import java.sql.ResultSet;
import java.sql.SQLException;
import org.springframework.jdbc.core.RowMapper;

import cl.lherrera.m5u3001.models.Usuario;

public class UsuarioMapper implements RowMapper&lt;Usuario&gt; {

    public Usuario mapRow(ResultSet resultSet, int i) throws SQLException {
        Usuario usuario = new Usuario();
        usuario.setIdUsuario(resultSet.getInt(&quot;id_usuario&quot;));
        usuario.setNombre(resultSet.getString(&quot;nombre&quot;));
        usuario.setClave(resultSet.getString(&quot;clave&quot;));
        usuario.setRut(resultSet.getInt(&quot;rut&quot;));
        usuario.setDv(resultSet.getString(&quot;dv&quot;));
        return usuario;
    }

}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/models/Usuario.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.models;

public class Usuario {
    private Integer idUsuario;
    private String nombre;
    private String clave;
    private Integer rut;
    private String dv;


    public Usuario() {}

    public Usuario(Integer idUsuario, String nombre, String clave, Integer rut, String dv) {
        this.idUsuario = idUsuario;
        this.nombre = nombre;
        this.clave = clave;
        this.rut = rut;
        this.dv = dv;
    }

    public Integer getIdUsuario() {
        return idUsuario;
    }

    public void setIdUsuario(Integer idUsuario) {
        this.idUsuario = idUsuario;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public String getClave() {
        return clave;
    }

    public void setClave(String clave) {
        this.clave = clave;
    }

    public Integer getRut() {
        return rut;
    }

    public void setRut(Integer rut) {
        this.rut = rut;
    }

    public String getDv() {
        return dv;
    }

    public void setDv(String dv) {
        this.dv = dv;
    }

    @Override
    public String toString() {
        return &quot;Usuario [idUsuario=&quot; + idUsuario + &quot;, nombre=&quot; + nombre + &quot;, clave=&quot; + clave + &quot;, rut=&quot; + rut + &quot;, dv=&quot;
                + dv + &quot;]&quot;;
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/services/UsuarioService.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.services;


import cl.lherrera.m5u3001.models.Usuario;
import cl.lherrera.m5u3001.vo.UsuarioVO;

public interface UsuarioService {

    // por defectos son public abstract, es por esa razón que no hay problemas
    // con el alcance de paquetes, ya que en esta ocación no son por defecto seteados con
    // el modificador de paquetes.

    UsuarioVO obtenerTodosLosUsuarios();
    UsuarioVO obtenerUsuarioPorNombreYClave(String nombre, String clave);
    UsuarioVO login(String nombre, String clave);

    // para justificar el crud (Los servicios no son rígidos, se adaptan a la necesidad específica)
    // en este caso los métodos son con el mismo nombre que la implementación del DAO
    // pero es solamente a modo de ejemplo del ejercicio, ya que existe un UsuarioVO, enfocado a lo
    // que se muestra en pantalla es por eso que en el fondo el servicio llena esos
    // objetos, pero la implementación de los métodos de negocio van más allá que simplemente
    // retornar objetos tipo VO o DTOs.

    UsuarioVO add(Usuario usuario);
    UsuarioVO update(Usuario usuario);
    UsuarioVO delete(Usuario usuario);
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/services/UsuarioServiceImpl.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.services;

import java.util.ArrayList;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import cl.lherrera.m5u3001.daos.UsuarioDAO;
import cl.lherrera.m5u3001.models.Usuario;
import cl.lherrera.m5u3001.vo.UsuarioVO;

@Service
public class UsuarioServiceImpl implements UsuarioService {
    private static Logger logger = LoggerFactory.getLogger(UsuarioServiceImpl.class.getName());

    @Autowired
    private UsuarioDAO daoUsuario;

    @Override
    public UsuarioVO obtenerTodosLosUsuarios() {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;102&quot;);

        try {
            voUsuario.setUsuarios(new ArrayList&lt;&gt;(daoUsuario.getAllUsuarios()));
            voUsuario.setMensaje(String.format(&quot;Se ha/n encontrado %d registro/s&quot;, voUsuario.getUsuarios().size()));

            voUsuario.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en getAllUsuarios&quot;, e);
        }
        return voUsuario;
    }

    @Override
    public UsuarioVO obtenerUsuarioPorNombreYClave(String nombre, String clave) {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;101&quot;);
        try {
            Usuario usuario = daoUsuario.findByNombreAndClave(nombre, clave);
            voUsuario.getUsuarios().add(usuario);
            voUsuario.setMensaje(String.format(&quot;Se ha/n encontrado %d registro/s&quot;, null != usuario ? 1 : 0));
            voUsuario.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en findByNombreAndClave&quot;, e);
        }
        return voUsuario;
    }

    @Override
    public UsuarioVO login(String nombre, String clave) {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Credenciales incorrectas&quot;, &quot;102&quot;);

        boolean credencialesVacias = nombre.length() == 0 || clave.length() == 0;

        if (!credencialesVacias) {
            voUsuario = this.obtenerUsuarioPorNombreYClave(nombre, clave);

            if (voUsuario.getCodigo().equals(&quot;0&quot;)) {
                voUsuario.setMensaje(String.format(&quot;Bienvenido %s&quot;, voUsuario.getUsuarios().get(0).getNombre()));
            }
        }

        return voUsuario;
    }

    // Justificando el CRUD

    // UsuarioServiceImpl
    @Override
    public UsuarioVO add(Usuario usuario) {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;104&quot;);
        try {
            int registrosActualizados = daoUsuario.add(usuario);
            voUsuario.setMensaje(registrosActualizados == 1 ? &quot;Se ha creado el usuario correctamente&quot;
                    : &quot;No se ha podido crear el usuario&quot;);
            voUsuario.setCodigo(registrosActualizados == 1 ? &quot;0&quot; : &quot;104&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en add&quot;, e);
        }
        return voUsuario;
    }

    @Override
    public UsuarioVO update(Usuario usuario) {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;105&quot;);
        try {
            int registrosActualizados = daoUsuario.update(usuario);

            voUsuario
                    .setMensaje(String.format(&quot;Se ha/n actualizado correctamente %d usuario/s&quot;, registrosActualizados));
            voUsuario.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en update&quot;, e);
        }
        return voUsuario;
    }

    @Override
    public UsuarioVO delete(Usuario usuario) {
        UsuarioVO voUsuario = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;106&quot;);
        try {
            int registrosActualizados = daoUsuario.delete(usuario);
            voUsuario
                    .setMensaje(String.format(&quot;Se ha/n eliminado correctamente a %d usuario/s&quot;, registrosActualizados));
            voUsuario.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en delete&quot;, e);
        }
        return voUsuario;
    }

}

</code></pre>

<ul>
<li><code>/m5u3l001/src/main/java/cl/lherrera/m5u3001/vo/UsuarioVO.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.vo;

import java.util.List;

import cl.lherrera.m5u3001.models.Usuario;

public class UsuarioVO {
    private List&lt;Usuario&gt; usuarios; 
    private String mensaje; 
    private String codigo;

    public UsuarioVO() {}

    public UsuarioVO(List&lt;Usuario&gt; usuarios, String mensaje, String codigo) {
        super();
        this.usuarios = usuarios;
        this.mensaje = mensaje;
        this.codigo = codigo;
    }

    public List&lt;Usuario&gt; getUsuarios() {
        return usuarios;
    }

    public void setUsuarios(List&lt;Usuario&gt; usuarios) {
        this.usuarios = usuarios;
    }

    public String getMensaje() {
        return mensaje;
    }

    public void setMensaje(String mensaje) {
        this.mensaje = mensaje;
    }

    public String getCodigo() {
        return codigo;
    }

    public void setCodigo(String codigo) {
        this.codigo = codigo;
    }

    @Override
    public String toString() {
        return &quot;UsuarioVO [mensaje=&quot; + mensaje + &quot;, codigo=&quot; + codigo + &quot;]&quot;;
    }
}
</code></pre>

<ul>
<li><code>/m5u3l001/src/main/resources/database.properties</code></li>
</ul>
<pre><code class="conf">driver=oracle.jdbc.driver.OracleDriver
url=jdbc:oracle:thin:@localhost:1521:xe
dbuser=mod5u2l1
dbpassword=1234

</code></pre>

<ul>
<li><code>/m5u3l001/src/test/java/cl/lherrera/m5u3001/daos/UsuarioDaoImplTest.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.daos;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.util.List;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.m5u3001.daos.UsuarioDAOImpl;
import cl.lherrera.m5u3001.models.Usuario;


@SpringBootTest
@DisplayName(&quot;Pruebas unitarias del DAO&quot;)
public class UsuarioDaoImplTest {

    @Autowired
    private UsuarioDAOImpl daoUsuario;


    @Test
    @DisplayName(&quot;Traer todos los usuarios&quot;)
    public void prueba001() {
        // guadamos en una lista los usuarios
        List&lt;Usuario&gt; usuarios = daoUsuario.getAllUsuarios();
        // deben existir 2 usuarios en la base de datos
        assertTrue(usuarios.size() &gt;= 2);
    }

    @Test
    @DisplayName(&quot;traer al usuario user1 - clave1&quot;)
    public void prueba002() {
        // buscar el usuario con la clave y contraseña
        // este usuario debe estar en la base de datos
        Usuario usuario = daoUsuario.findByNombreAndClave(&quot;user1&quot;, &quot;clave1&quot;);
        // comparamos con el nombre
        assertEquals(&quot;user1&quot;, usuario.getNombre());
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/src/test/java/cl/lherrera/m5u3001/services/UsuarioServiceTest.java</code></li>
</ul>
<pre><code class="java">package cl.lherrera.m5u3001.services;
// ojo con los nombres de paquetes, mejor que sean iguales para no perder el contexto

import static org.junit.jupiter.api.Assertions.assertTrue;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.m5u3001.models.Usuario;
import cl.lherrera.m5u3001.vo.UsuarioVO;

@SpringBootTest
@DisplayName(&quot;Prueba de servicios&quot;)
public class UsuarioServiceTest {
    private Logger logger = LoggerFactory.getLogger(UsuarioServiceTest.class.getName());

    @Autowired
    UsuarioService servicioUsuario;

    @Test
    @DisplayName(&quot;Prueba de servicio de login&quot;) 
    public void prueba001() {
        // capturar mensaje
        String mensaje = servicioUsuario.login(&quot;user1&quot;, &quot;clave1&quot;).getMensaje();
        // comparar con respuesta
        assertTrue(mensaje.contains(&quot;Bienvenido&quot;));
    }

    // Probamos CRUD

    // se agrega, se actualiza y se elimina el mismo dato, dejando la base de datos
    // de pruebas estable. (esta no debe ser una base de datos oficial

    @Test
    @DisplayName(&quot;Probar servicio add&quot;)
    public void prueba002() {
        // creamos un usuario
        Usuario usuario = new Usuario();
        usuario.setNombre(&quot;test1&quot;);
        usuario.setClave(&quot;clave1&quot;);
        // ingresamos el usuario con el servicio
        UsuarioVO respuesta = servicioUsuario.add(usuario);

        assertTrue(respuesta.getMensaje().contains(&quot;Se ha creado el usuario correctamente&quot;));

    }

    @Test
    @DisplayName(&quot;Prueba servicio update&quot;)
    public void prueba003() {
        // llamamos al usuario
        UsuarioVO usuarioVo = servicioUsuario.obtenerUsuarioPorNombreYClave(&quot;test1&quot;, &quot;clave1&quot;);
        Usuario usuario = usuarioVo.getUsuarios().get(0);
        // cambiamos un valor
        usuario.setNombre(&quot;test2&quot;);
        usuarioVo = servicioUsuario.update(usuario);

        // comprobamos con mensaje retornado del servicio
        assertTrue(usuarioVo.getMensaje().contains(&quot;actualizado correctamente&quot;));
    }

    @Test
    @DisplayName(&quot;Prueba de eliminado&quot;)
    public void prueba004() {
        // se busca el usuario
        UsuarioVO usuarioVo = servicioUsuario.obtenerUsuarioPorNombreYClave(&quot;test2&quot;, &quot;clave1&quot;);
        Usuario usuario = usuarioVo.getUsuarios().get(0);

        usuarioVo = servicioUsuario.delete(usuario);
        assertTrue(usuarioVo.getMensaje().contains(&quot;eliminado correctamente&quot;));
    }
}

</code></pre>

<ul>
<li><code>/m5u3l001/pom.xml</code></li>
</ul>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.m4u2l2&lt;/groupId&gt;
    &lt;artifactId&gt;m4u3l1&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;m4u3l1&lt;/name&gt;
    &lt;description&gt;Lectura 2 mod 4 uni 2&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.oracle.jdbc&lt;/groupId&gt;
            &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;
            &lt;version&gt;12.2.0.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE # --&gt;

    &lt;/dependencies&gt;

    &lt;!-- ODBC-ORACLE --&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;xwiki-externals&lt;/id&gt;
            &lt;name&gt;https://maven.xwiki.org/externals/&lt;/name&gt;
            &lt;url&gt;https://maven.xwiki.org/externals/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;!-- ODBC-ORACLE # --&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
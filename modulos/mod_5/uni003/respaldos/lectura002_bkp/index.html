


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Modelo (Parte II) - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modelo-parte-ii" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Modelo (Parte II)
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../ejercicios/repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="modelo-parte-ii">Modelo (Parte II)</h1>
<hr />
<h1 id="aplicacion-jpa">Aplicación - JPA</h1>
<hr />
<p>La siguiente aplicación mostrará la forma en que se trabaja con <code>JPA</code>, además de la utilización de <code>lombok</code>, esta es una librería que ahora tareas repetitivas como la programación de los los <code>setters &amp; getters</code>, o los constructores. Se instala agregando la dependencia en el <code>pom</code>, luego vamos a <code>maven dependencies</code> allí buscamos el paquete y en propiedades sabremos donde está. vamos allá y ejecutamos el <code>jar</code> que encontremos dentro de la carpeta, el <code>jar</code> que más se parezca al nombre de la extensión. lo ejecutamos y seleccionamos nuestro IDE, si no está en la lista la especificamos, en el caso de <code>mac</code>, es el <code>ini</code> dentro de la carpeta que está en <code>Aplications</code>. Hacer esto con el IDE cerrado o a veces no funciona.</p>
<h2 id="contexto">Contexto</h2>
<p>La aplicación es muy similar a la anterior, pero esta vez se utilizará <code>JPA</code>, que es la forma de trabajar con persistencia más utilizada en <code>Spring</code>. Es la norma en muchas compañías ya que viene desde <code>Hibernate</code>.</p>
<h2 id="hito-1-obtener-todos-los-usuarios">Hito 1 - Obtener Todos Los Usuarios</h2>
<ul>
<li>Crear la aplicación <code>spring boot</code> con las siguientes dependencias: <code>JPA</code>, <code>Spring web starter</code>, <code>DevTools</code>, <code>Lombok</code>.</li>
</ul>
<h3 id="estructura">Estructura:</h3>
<pre><code>./
├── HELP.md
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── m4u3l2001
│   │   │               ├── AppConfig.java
│   │   │               ├── M4u3l2001Application.java
│   │   │               ├── ServletInitializer.java
│   │   │               ├── entity
│   │   │               │   └── Usuario.java
│   │   │               ├── repositories
│   │   │               │   └── UsuarioRepository.java
│   │   │               ├── services
│   │   │               │   ├── UsuarioService.java
│   │   │               │   └── UsuarioServiceImpl.java
│   │   │               └── vos
│   │   │                   └── UsuarioVO.java
│   │   ├── resources
│   │   │   ├── application.properties
│   │   │   ├── database.properties
│   │   │   ├── static
│   │   │   └── templates
│   │   └── webapp
│   └── test
│       └── java
│           └── cl
│               └── lherrera
│                   └── m4u3l2001
│                       ├── M4u3l2001ApplicationTests.java
│                       └── services
│                           └── UsuarioServiceImplTest.java
└── target
    ├── classes
    │   ├── application.properties
    │   └── database.properties
    ├── generated-sources
    │   └── annotations
    ├── generated-test-sources
    │   └── test-annotations
    ├── m2e-wtp
    │   └── web-resources
    │       └── META-INF
    │           ├── MANIFEST.MF
    │           └── maven
    │               └── cl.lherrera.m4u2l2
    │                   └── m4u3l2001
    │                       ├── pom.properties
    │                       └── pom.xml
    └── test-classes

34 directories, 23 files

</code></pre>

<h3 id="archivos-modificados">Archivos modificados</h3>
<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/AppConfig.java</code></p>
<p>Configuración personalizada de la base de datos para el contexto.</p>
<pre><code class="java">package cl.lherrera.m4u3l2001;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

@Configuration
@ComponentScan(&quot;com.latam.usuarios&quot;)
@PropertySource(&quot;classpath:database.properties&quot;)
public class AppConfig {
    @Autowired
    Environment environment;

    @Bean
    DataSource dataSource() {
        DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();
        driverManagerDataSource.setUrl(environment.getProperty(&quot;url&quot;));
        driverManagerDataSource.setUsername(environment.getProperty(&quot;dbuser&quot;));
        driverManagerDataSource.setPassword(environment.getProperty(&quot;dbpassword&quot;));
        driverManagerDataSource.setDriverClassName(environment.getProperty(&quot;driver&quot;));
        return driverManagerDataSource;
    }
}
</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/entity/Usuario.java</code></p>
<p>Lo que era un modelo, ahora es una entidad, con esta anotación se proclama esta clase como un componente, y será tratado como un <code>bean</code> para que pueda ser inyectado. <code>@SequenceGenerator</code>, depende del motor es el tipo de generador, el que se expone es para <code>oracle</code>, un <code>SqLite</code> debería ser de incremento automático.</p>
<pre><code class="java">package cl.lherrera.m4u3l2001.entity;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.SequenceGenerator;
import javax.persistence.Table;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@SequenceGenerator(name=&quot;SQUSUARIO&quot;, initialValue=1, allocationSize=1,sequenceName = &quot;SQUSUARIO&quot;)
@Data // setters &amp; getters
@NoArgsConstructor // constructor sin argumentos.
@AllArgsConstructor // constructor con todos los argumentos.
@Table(name=&quot;usuario&quot;) // nombre de la tabla en en caso que la clase no se llame como la tabla
public class Usuario {

    @Id
    @GeneratedValue(strategy=GenerationType.SEQUENCE, generator=&quot;SQUSUARIO&quot;)
    private Integer idUsuario;
    // solo a modo de ejemplo, en el caso que la columna en la base 
    // de datos sea diferente. En este caso son el mismo nombre
    // pero no siempre esto debe ser así.
    @Column(name=&quot;nombre&quot;) 
    private String nombre;
    private String clave;
    private Integer rut;
    private String dv;

}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/repositories/UsuarioRepository.java</code></p>
<p>Como la capa de acceso tenemos estos repositorios, reemplazando la tarea que tenían los DAOS. No necesita implementación al ser inyectado se creará una implementación con los métodos más comunes como <code>add, delete,...etc</code>. Además de poder agregar más si se requiere.</p>
<pre><code class="java">package cl.lherrera.m4u3l2001.repositories;


import org.springframework.data.repository.CrudRepository;

import cl.lherrera.m4u3l2001.entity.Usuario;

// con sólo esto ya tenemos el CRUD
public interface UsuarioRepository extends CrudRepository&lt;Usuario, Integer&gt; {}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/services/UsuarioService.java</code></p>
<pre><code class="java">package cl.lherrera.m4u3l2001.services;


import cl.lherrera.m4u3l2001.vos.UsuarioVO;

public interface UsuarioService {

    UsuarioVO ObtenerTodosLosUsuarios();
}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/services/UsuarioServiceImpl.java</code></p>
<pre><code class="java">package cl.lherrera.m4u3l2001.services;

import java.util.ArrayList;
import java.util.List;


import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import cl.lherrera.m4u3l2001.entity.Usuario;
import cl.lherrera.m4u3l2001.repositories.UsuarioRepository;
import cl.lherrera.m4u3l2001.vos.UsuarioVO;

@Service
public class UsuarioServiceImpl implements UsuarioService{
    private static Logger logger = LoggerFactory.getLogger(UsuarioServiceImpl.class.getName());

    @Autowired
    private UsuarioRepository daoUsuario;

    private UsuarioVO usuarioVO;

    @Override
    @Transactional(readOnly = true)
    public UsuarioVO ObtenerTodosLosUsuarios() {
        usuarioVO = new UsuarioVO(new ArrayList&lt;Usuario&gt;(), &quot;Ha ocurrido un error&quot;, &quot;102&quot;);
        try {
            usuarioVO.setUsuarios((List&lt;Usuario&gt;) daoUsuario.findAll());
            usuarioVO.setMensaje(String.format(&quot;Se ha/n encontrado %d registro/s&quot;, usuarioVO.getUsuarios().size()));
            usuarioVO.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en getAllUsuarios&quot;, e);
        }
        return usuarioVO;
    }

}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m4u3l2001/vos/UsuarioVO.java</code>
Objeto que representará lo que la vista necesita. <code>DTO</code></p>
<pre><code class="java">package cl.lherrera.m4u3l2001.vos;

import java.util.List;

import cl.lherrera.m4u3l2001.entity.Usuario;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

// instalar lombok con el ide cerrado
// https://stackoverflow.com/questions/52780535/lombok-with-spring-tool-suite-4
// si no funciona implementar los códigos no perder el tiempo
// si no funciona, aunque en mac es con el ini en windows es con exe especificar 
// donde esté instalado

@Data
@AllArgsConstructor
@NoArgsConstructor
public class UsuarioVO {
    private List&lt;Usuario&gt; usuarios;
    private String mensaje;
    private String codigo;

}

</code></pre>

<p><code>/m4u3l2001/src/main/resources/database.properties</code></p>
<p>Archivo personalizado de propiedades</p>
<pre><code class="conf">driver=oracle.jdbc.driver.OracleDriver
url=jdbc:oracle:thin:@localhost:1521:xe
dbuser=mod5u2l1
dbpassword=1234

</code></pre>

<p><code>/m4u3l2001/src/test/java/cl/lherrera/m4u3l2001/services/UsuarioServiceImplTest.java</code></p>
<pre><code class="java">package cl.lherrera.m4u3l2001.services;

import static org.junit.jupiter.api.Assertions.assertTrue;


import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.m4u3l2001.vos.UsuarioVO;

@SpringBootTest
@DisplayName(&quot;Prueba de servicios&quot;)
public class UsuarioServiceImplTest {

    @Autowired
    UsuarioServiceImpl servicio;

    @Test
    @DisplayName(&quot;Traer todos los usuarios&quot;)
    public void prueba001() {
        // guadamos en una lista los usuarios
        UsuarioVO usuarioVO = servicio.ObtenerTodosLosUsuarios();
        // deben existir 2 usuarios en la base de datos
        assertTrue(usuarioVO.getUsuarios().size() &gt;= 2);
    }

}

</code></pre>

<p><code>/m4u3l2001/pom.xml</code></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.m4u2l2&lt;/groupId&gt;
    &lt;artifactId&gt;m4u3l2001&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;m4u3l2001&lt;/name&gt;
    &lt;description&gt;Lectura 2 mod 5 uni 2&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.oracle.jdbc&lt;/groupId&gt;
            &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;
            &lt;version&gt;12.2.0.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- ODBC-ORACLE # --&gt;

    &lt;/dependencies&gt;

    &lt;!-- ODBC-ORACLE --&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;xwiki-externals&lt;/id&gt;
            &lt;name&gt;https://maven.xwiki.org/externals/&lt;/name&gt;
            &lt;url&gt;https://maven.xwiki.org/externals/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;!-- ODBC-ORACLE # --&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<p>Al ejecutar los test, teniendo al menos dos elementos en la base de datos, estos no deberían presentar fallas.</p>
<hr />
<h2 id="hito-2-servicio-y-crud">Hito 2 - Servicio y CRUD</h2>
<hr />
<p>Nuestro CRUD se divide en leer, escribir, actualizar y eliminar.</p>
<ul>
<li>Leer:<ul>
<li>Obtener todos los usuarios.</li>
<li>Obtener usuario con su nombre y clave</li>
</ul>
</li>
<li>Escribir<ul>
<li>Ingresar Usuario</li>
</ul>
</li>
<li>Actualizar<ul>
<li>Actualizar Usuario</li>
</ul>
</li>
<li>Eliminar<ul>
<li>Eliminar Usuario</li>
</ul>
</li>
</ul>
<h3 id="archivos-modificados_1">Archivos modificados</h3>
<p><code>/m4u3l2001/src/main/java/cl/lherrera/m5u3l2001/entity/Usuario.java</code></p>
<p><code>FIX</code> - Se cambia el valor de la secuencia para que sea la misma que la que está en la base de datos.</p>
<pre><code class="java">package cl.lherrera.m5u3l2001.entity;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.SequenceGenerator;
import javax.persistence.Table;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@SequenceGenerator(
        name=&quot;SQ_USUARIO&quot;, 
        initialValue=1, 
        allocationSize=1,
        sequenceName = &quot;SQ_USUARIO&quot;) // esta es la secuencia que se crea en la base de datos (mismo nombre)

@Data // setters &amp; getters
@NoArgsConstructor // constructor sin argumentos.
@AllArgsConstructor // constructor con todos los argumentos.
@Table(name=&quot;usuario&quot;) // nombre de la tabla en en caso que la clase no se llame como la tabla
public class Usuario {

    @Id
    @GeneratedValue(strategy=GenerationType.SEQUENCE, generator=&quot;SQ_USUARIO&quot;)
    private Integer idUsuario;
    // solo a modo de ejemplo, en el caso que la columna en la base 
    // de datos sea diferente. En este caso son el mismo nombre
    // pero no siempre esto debe ser así.
    @Column(name=&quot;nombre&quot;) 
    private String nombre;
    private String clave;
    private Integer rut;
    private String dv;

}
</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m5u3l2001/repositories/UsuarioRepository.java</code></p>
<pre><code class="java">package cl.lherrera.m5u3l2001.repositories;


import java.util.Optional;

import org.springframework.data.repository.CrudRepository;

import cl.lherrera.m5u3l2001.entity.Usuario;

// con sólo esto ya tenemos el CRUD
public interface UsuarioRepository extends CrudRepository&lt;Usuario, Integer&gt; {

    public Optional&lt;Usuario&gt; findOneByNombreAndClave(String nombre, String clave);
}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m5u3l2001/services/UsuarioService.java</code></p>
<p>Se agregan los métodos para el CRUD</p>
<pre><code class="java">package cl.lherrera.m5u3l2001.services;


import cl.lherrera.m5u3l2001.vos.UsuarioVO;

public interface UsuarioService {

    UsuarioVO ObtenerUsuarioPorNombreYClave(String nombre, String clave);

    UsuarioVO ObtenerTodosLosUsuarios();

    UsuarioVO ingresarUsuario(UsuarioVO usuarioVO);

    UsuarioVO actualizarUsuario(UsuarioVO usuarioVO);

    UsuarioVO eliminarUsuario(UsuarioVO usuarioVO);
}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m5u3l2001/services/UsuarioServiceImpl.java</code></p>
<p>Se implementan los métodos necesarios para el CRUD</p>
<pre><code class="java">package cl.lherrera.m5u3l2001.services;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import cl.lherrera.m5u3l2001.entity.Usuario;
import cl.lherrera.m5u3l2001.repositories.UsuarioRepository;
import cl.lherrera.m5u3l2001.vos.UsuarioVO;

@Service
public class UsuarioServiceImpl implements UsuarioService {
    private static Logger logger = LoggerFactory.getLogger(UsuarioServiceImpl.class.getName());

    @Autowired
    private UsuarioRepository daoUsuario;


    public UsuarioVO ObtenerUsuarioPorNombreYClave(String nombre, String clave) {
        UsuarioVO usuarioVO = new UsuarioVO(&quot;Ha ocurrido un error&quot;, &quot;102&quot;);
        try {
            Usuario usuario = daoUsuario.findOneByNombreAndClave(nombre, clave).orElse(null);

            usuarioVO.setUsuario(usuario);

            usuarioVO.setMensaje(String.format(&quot;Se ha/n encontrado %d registro/s&quot;, usuarioVO.getUsuarios().size()));
            usuarioVO.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en getAllUsuarios&quot;, e);
        }

        return usuarioVO;
    }

    @Override
    @Transactional(readOnly = true)
    public UsuarioVO ObtenerTodosLosUsuarios() {
        UsuarioVO usuarioVO = new UsuarioVO(&quot;Ha ocurrido un error&quot;, &quot;102&quot;);
        try {
            usuarioVO.setUsuarios((List&lt;Usuario&gt;) daoUsuario.findAll());
            usuarioVO.setMensaje(String.format(&quot;Se ha/n encontrado %d registro/s&quot;, usuarioVO.getUsuarios().size()));
            usuarioVO.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en getAllUsuarios&quot;, e);
        }
        return usuarioVO;
    }

    @Override
    @Transactional
    public UsuarioVO ingresarUsuario(UsuarioVO usuarioVO) {
        UsuarioVO voUsuarioResp = new UsuarioVO(&quot;Ha ocurrido un error&quot;, &quot;104&quot;);
        try {
            Usuario usuario = daoUsuario.save(usuarioVO.getFirst());

            voUsuarioResp.setMensaje(
                    usuario != null ? &quot;Se ha creado el usuario correctamente&quot; : &quot;No se ha podido crear el usuario&quot;);
            voUsuarioResp.setCodigo(usuario != null ? &quot;0&quot; : &quot;104&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en add&quot;, e);
        }
        return voUsuarioResp;
    }

    @Override
    @Transactional
    public UsuarioVO actualizarUsuario(UsuarioVO usuarioVO) {
        UsuarioVO respuesta = new UsuarioVO(&quot;Ha ocurrido un error&quot;, &quot;105&quot;);
        try {
            Usuario usuario = daoUsuario.save(usuarioVO.getFirst());
            if (usuario != null) {
                respuesta.setMensaje(String.format(&quot;Se ha/n actualizado correctamente %s usuario/s&quot;, usuario.getNombre()));
                respuesta.setCodigo(&quot;0&quot;);
            }
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en update&quot;, e);
        }
        return respuesta;
    }

    @Override
    @Transactional
    public UsuarioVO eliminarUsuario(UsuarioVO usuarioVO) {
        usuarioVO.setMensaje(&quot;Ha ocurrido un error&quot;);
        usuarioVO.setCodigo(&quot;106&quot;);

        try {
            daoUsuario.delete(usuarioVO.getFirst());
            usuarioVO.setMensaje(String.format(&quot;Se ha/n eliminado correctamente a %s usuario/s&quot;, usuarioVO.getFirst().getNombre()));

            usuarioVO.setCodigo(&quot;0&quot;);
        } catch (Exception e) {
            logger.trace(&quot;Usuario Service: Error en delete&quot;, e);
        }
        return usuarioVO;
    }

}

</code></pre>

<p><code>/m4u3l2001/src/main/java/cl/lherrera/m5u3l2001/vos/UsuarioVO.java</code></p>
<p><code>FIX</code> - Modificación de archivo de usuario visual, para mejor funcionamiento.</p>
<pre><code class="java">package cl.lherrera.m5u3l2001.vos;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import cl.lherrera.m5u3l2001.entity.Usuario;
import lombok.Data;
import lombok.NoArgsConstructor;

// instalar lombok con el ide cerrado
// https://stackoverflow.com/questions/52780535/lombok-with-spring-tool-suite-4
// si no funciona implementar los códigos no perder el tiempo
// si no funciona, aunque en mac es con el ini en windows es con exe especificar 
// donde esté instalado

// https://www.wandercosta.com/lombok-constructors/

@Data
@NoArgsConstructor
public class UsuarioVO {
    private List&lt;Usuario&gt; usuarios = new ArrayList&lt;&gt;();
    private String mensaje;
    private String codigo;

    private static Logger logger = LoggerFactory.getLogger(UsuarioVO.class.getName());

    public UsuarioVO(String mensaje, String codigo) {
        this.mensaje = mensaje;
        this.codigo = codigo;
    }

    /**
     * Ingresa un usuario para aquellos métodos
     * que solo necesitan ingresar un usuario
     * y no una lista.
     */
    public Usuario setUsuario(Usuario usuario) {
        if(usuarios.size() &gt; 0) {
            logger.warn(&quot;Advertencia: La lista de usuarios ya existe: &quot; + usuarios.toString());
        }else {
            usuarios.add(usuario);
        }

        return usuario;
    }

    /**
     * Retorna el primer usuario de la lista que fue ingresado.
     * Es útil solamente cuando sabemos que hay un solo elemento
     */
    public Usuario getFirst() {
        if(usuarios.size() &gt; 1)
            logger.warn(&quot;Advertencia: El arreglo posee más de un elemento&quot;);

        return usuarios.get(0);
    }

}

</code></pre>

<p><code>/m4u3l2001/src/test/java/cl/lherrera/m5u3l2001/services/UsuarioServiceImplTest.java</code></p>
<p>Se agregan los test necesarios para realizar las pruebas restantes para el CRUD.</p>
<pre><code class="java">package cl.lherrera.m5u3l2001.services;

import static org.junit.jupiter.api.Assertions.assertTrue;


import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.m5u3l2001.entity.Usuario;
import cl.lherrera.m5u3l2001.services.UsuarioServiceImpl;
import cl.lherrera.m5u3l2001.vos.UsuarioVO;

@SpringBootTest
@DisplayName(&quot;Prueba de servicios&quot;)
public class UsuarioServiceImplTest {
    private Logger logger = LoggerFactory.getLogger(UsuarioServiceImplTest.class.getName());

    @Autowired
    UsuarioServiceImpl servicio;

    @Test
    @DisplayName(&quot;Traer todos los usuarios&quot;)
    public void prueba001() {
        // guadamos en una lista los usuarios
        UsuarioVO usuarioVO = servicio.ObtenerTodosLosUsuarios();
        // deben existir 2 usuarios en la base de datos
        assertTrue(usuarioVO.getUsuarios().size() &gt;= 2);
    }

    @Test
    @DisplayName(&quot;Probar ingresar usuario&quot;)
    public void prueba002() {
        // creamos un usuario
        Usuario usuario = new Usuario();
        usuario.setNombre(&quot;test1&quot;);
        usuario.setClave(&quot;clave1&quot;);
        // cargamos el usuario en el VO
        UsuarioVO usuarioVO = new UsuarioVO();
        usuarioVO.setUsuario(usuario);
        // ingresamos el usuario con el servicio
        UsuarioVO respuesta = servicio.ingresarUsuario(usuarioVO);

        assertTrue(respuesta.getMensaje().contains(&quot;Se ha creado el usuario correctamente&quot;));

    }

    @Test
    @DisplayName(&quot;Prueba servicio update&quot;)
    public void prueba003() {
        // llamamos al usuario
        UsuarioVO usuarioVO = servicio.ObtenerUsuarioPorNombreYClave(&quot;test1&quot;, &quot;clave1&quot;);
        // cambiamos un valor
        usuarioVO.getFirst().setNombre(&quot;test2&quot;);
        usuarioVO = servicio.actualizarUsuario(usuarioVO);
        // comprobamos con mensaje retornado del servicio
        assertTrue(usuarioVO.getMensaje().contains(&quot;actualizado correctamente&quot;));
    }

    @Test
    @DisplayName(&quot;Prueba de eliminado&quot;)
    public void prueba004() {
        // se busca el usuario
        UsuarioVO usuarioVO = servicio.ObtenerUsuarioPorNombreYClave(&quot;test2&quot;, &quot;clave1&quot;);

        usuarioVO = servicio.eliminarUsuario(usuarioVO);
        logger.info(usuarioVO.getMensaje());
        assertTrue(usuarioVO.getMensaje().contains(&quot;eliminado correctamente&quot;));
    }

}

</code></pre>

<hr />
<h2 id="hito-3-la-web">Hito 3 - La web</h2>
<hr />
<p>Se creará un mantenedor con los servicios que tenemos La web no será compleja, estará enfocada a la utilización de servicios.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
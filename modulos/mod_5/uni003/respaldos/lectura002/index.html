


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Lectura002 - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unidad-32-modelo" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Lectura002
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../ejercicios/repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#321-aplicacion-jpa" class="md-nav__link">
    3.2.1 Aplicación - JPA
  </a>
  
    <nav class="md-nav" aria-label="3.2.1 Aplicación - JPA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hito-1-configuracion-de-la-base-de-datos" class="md-nav__link">
    Hito 1 - Configuración de la base de datos
  </a>
  
    <nav class="md-nav" aria-label="Hito 1 - Configuración de la base de datos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructura-final-del-hito" class="md-nav__link">
    Estructura final del hito.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archivos-modificados" class="md-nav__link">
    Archivos modificados
  </a>
  
    <nav class="md-nav" aria-label="Archivos modificados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pomxml" class="md-nav__link">
    /pom.xml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherrerajpaspring" class="md-nav__link">
    cl.lherrera.jpaspring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainresources" class="md-nav__link">
    /src/main/resources/
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basedatosdb" class="md-nav__link">
    /basedatos.db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hito-2-creando-los-servicios-necesarios-para-la-aplicacion" class="md-nav__link">
    Hito 2 - Creando los servicios necesarios para la aplicación.
  </a>
  
    <nav class="md-nav" aria-label="Hito 2 - Creando los servicios necesarios para la aplicación.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archivos-modificados_1" class="md-nav__link">
    Archivos modificados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srctestjavacllherrerajpaspringservices" class="md-nav__link">
    /src/test/java/cl/lherrera/jpaspring/services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringentities" class="md-nav__link">
    /src/main/java/cl/lherrera/jpaspring/entities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jpaspringsrcmainjavacllherrerajpaspringrepositories" class="md-nav__link">
    /jpaspring/src/main/java/cl/lherrera/jpaspring/repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservices" class="md-nav__link">
    /src/main/java/cl/lherrera/jpaspring/services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hito-3-crud-con-web" class="md-nav__link">
    Hito 3 - CRUD con web.
  </a>
  
    <nav class="md-nav" aria-label="Hito 3 - CRUD con web.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archivos-modificados_2" class="md-nav__link">
    Archivos modificados:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringcontrollers" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/controllers/
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringrepositories" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservices_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-inf" class="md-nav__link">
    src/main/webapp/WEB-INF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srctestjavacllherrerajpaspringservices_1" class="md-nav__link">
    src/test/java/cl/lherrera/jpaspring/services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hito-4-creando-resultados-paginados" class="md-nav__link">
    Hito 4 - Creando resultados paginados.
  </a>
  
    <nav class="md-nav" aria-label="Hito 4 - Creando resultados paginados.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archivos-modificados_3" class="md-nav__link">
    Archivos modificados:
  </a>
  
    <nav class="md-nav" aria-label="Archivos modificados:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pomxml_1" class="md-nav__link">
    pom.xml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringjpaspringapplicationjava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringsqlitedialectjava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringcontrollerspersonacontrollerjava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringdtospersonadtojava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/dtos/PersonaDTO.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringentitiespersonajava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/entities/Persona.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringrepositoriespersonarepojava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicespersonaservicejava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/PersonaService.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicespersonaserviceimpljava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainresourcesapplicationproperties" class="md-nav__link">
    src/main/resources/application.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-infpagespersonaspersonasjsp" class="md-nav__link">
    src/main/webapp/WEB-INF/pages/personas/personas.jsp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hito-5-control-de-acceso" class="md-nav__link">
    Hito 5 - Control de acceso.
  </a>
  
    <nav class="md-nav" aria-label="Hito 5 - Control de acceso.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archivos-modificados_4" class="md-nav__link">
    Archivos modificados:
  </a>
  
    <nav class="md-nav" aria-label="Archivos modificados:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pomxml_2" class="md-nav__link">
    pom.xml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringjpaspringapplicationjava_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringsqlitedialectjava_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringauthlogincontrollerjava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/auth/LoginController.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringcontrollersaplicationcontrollerjava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/controllers/AplicationController.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringcontrollerspersonacontrollerjava_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringentitiesusuariojava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/entities/Usuario.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringrepositoriespersonarepojava_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringrepositoriesusuariorepojava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/repositories/UsuarioRepo.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicesautentificacionserviciojava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicio.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicesautentificacionservicioimpljava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicioImpl.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicespersonaserviceimpljava_1" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicesusuarioservicejava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/UsuarioService.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherrerajpaspringservicesusuarioserviceimpljava" class="md-nav__link">
    src/main/java/cl/lherrera/jpaspring/services/UsuarioServiceImpl.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainresourcesapplicationproperties_1" class="md-nav__link">
    src/main/resources/application.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-infpagesauthloginjsp" class="md-nav__link">
    src/main/webapp/WEB-INF/pages/auth/login.jsp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-infpageshtmltemplatesfootertemplatejsp" class="md-nav__link">
    src/main/webapp/WEB-INF/pages/htmlTemplates/footerTemplate.jsp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-infpageshtmltemplatesheadtemplatejsp" class="md-nav__link">
    src/main/webapp/WEB-INF/pages/htmlTemplates/headTemplate.jsp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainwebappweb-infpageshtmltemplatesnavtemplatejsp" class="md-nav__link">
    src/main/webapp/WEB-INF/pages/htmlTemplates/navTemplate.jsp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ddl-de-prueba" class="md-nav__link">
    DDL DE PRUEBA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    TODO
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <blockquote>
<h1 id="unidad-32-modelo"><strong>Unidad 3.2 - Modelo</strong></h1>
<blockquote>
<ul>
<li>La siguiente aplicación será finalmente un mantenedor de personas, con un control de acceso de usuarios.</li>
<li>Hito 1: Solamente crear el proyecto y modificarlo para que la base de datos <code>SQLITE</code> funcione.</li>
<li>Hito 2: Se crean los servicios necesarios, para que funcionen los test (Uso real de Mockito).</li>
<li>Hito 3: Creando la web del proyecto.</li>
</ul>
</blockquote>
</blockquote>
<hr />
<p><br /></p>
<blockquote>
<h2 id="321-aplicacion-jpa"><strong>3.2.1 Aplicación - JPA</strong></h2>
</blockquote>
<h3 id="hito-1-configuracion-de-la-base-de-datos"><strong>Hito 1 - Configuración de la base de datos</strong></h3>
<p>Se crea un proyecto <code>spring-boot: 2.2.6</code> con las siguientes dependencias:</p>
<ul>
<li><code>Spring-data JPA</code></li>
<li><code>Lombok</code></li>
<li><code>Spring Web</code></li>
<li><code>Spring boot DevToools</code></li>
<li><code>Tipo de deploy -&gt; war</code>, con esto se crea el <code>ServletInitializer</code></li>
</ul>
<h4 id="estructura-final-del-hito">Estructura final del hito.</h4>
<pre><code>./
├── HELP.md
├── basedatos.db
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── jpaspring
│   │   │               ├── AppConfig.java
│   │   │               ├── JpaspringApplication.java
│   │   │               ├── SQLiteDialect.java
│   │   │               └── ServletInitializer.java
│   │   ├── resources
│   │   │   ├── application.properties
│   │   │   ├── database.properties
│   │   │   ├── static
│   │   │   └── templates
│   │   └── webapp
│   │       └── WEB-INF
│   └── test
│       └── java
│           └── cl
│               └── lherrera
│                   └── jpaspring
│                       └── JpaspringApplicationTests.java
└── target
    ├── classes
    │   ├── application.properties
    │   └── database.properties
    ├── m2e-wtp
    │   └── web-resources
    │       └── META-INF
    │           ├── MANIFEST.MF
    │           └── maven
    │               └── cl.lherrera.jpaspring
    │                   └── jpaspring
    │                       ├── pom.properties
    │                       └── pom.xml
    └── test-classes

25 directories, 18 files

</code></pre>

<h4 id="archivos-modificados">Archivos modificados</h4>
<h5 id="pomxml"><strong><code>/pom.xml</code></strong></h5>
<p>Archivo de dependencias del proyecto.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.jpaspring&lt;/groupId&gt;
    &lt;artifactId&gt;jpaspring&lt;/artifactId&gt;
    &lt;version&gt;20.0.0&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;jpaspring&lt;/name&gt;
    &lt;description&gt;proyecto JPA SQLITE&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP # --&gt;

        &lt;!-- JSTL --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- JSTL # --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<h5 id="cllherrerajpaspring"><strong><code>cl.lherrera.jpaspring</code></strong></h5>
<p><code>/jpaspring/src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java</code></p>
<p>Archivo necesario para la configuración de SQLITE para <code>Spring</code>, es un archivo estándar.</p>
<pre><code class="java">package cl.lherrera.jpaspring;

import java.sql.Types;

import org.hibernate.dialect.Dialect;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.VarArgsSQLFunction;
import org.hibernate.type.StandardBasicTypes;

public class SQLiteDialect extends Dialect {
  public SQLiteDialect() {
    super();
    registerColumnType(Types.BIT, &quot;integer&quot;);
    registerColumnType(Types.TINYINT, &quot;tinyint&quot;);
    registerColumnType(Types.SMALLINT, &quot;smallint&quot;);
    registerColumnType(Types.INTEGER, &quot;integer&quot;);
    registerColumnType(Types.BIGINT, &quot;bigint&quot;);
    registerColumnType(Types.FLOAT, &quot;float&quot;);
    registerColumnType(Types.REAL, &quot;real&quot;);
    registerColumnType(Types.DOUBLE, &quot;double&quot;);
    registerColumnType(Types.NUMERIC, &quot;numeric&quot;);
    registerColumnType(Types.DECIMAL, &quot;decimal&quot;);
    registerColumnType(Types.CHAR, &quot;char&quot;);
    registerColumnType(Types.VARCHAR, &quot;varchar&quot;);
    registerColumnType(Types.LONGVARCHAR, &quot;longvarchar&quot;);
    registerColumnType(Types.DATE, &quot;date&quot;);
    registerColumnType(Types.TIME, &quot;time&quot;);
    registerColumnType(Types.TIMESTAMP, &quot;timestamp&quot;);
    registerColumnType(Types.BINARY, &quot;blob&quot;);
    registerColumnType(Types.VARBINARY, &quot;blob&quot;);
    registerColumnType(Types.LONGVARBINARY, &quot;blob&quot;);
    // registerColumnType(Types.NULL, &quot;null&quot;);
    registerColumnType(Types.BLOB, &quot;blob&quot;);
    registerColumnType(Types.CLOB, &quot;clob&quot;);
    registerColumnType(Types.BOOLEAN, &quot;integer&quot;);

    registerFunction(&quot;concat&quot;, new VarArgsSQLFunction(StandardBasicTypes.STRING, &quot;&quot;,
        &quot;||&quot;, &quot;&quot;));
    registerFunction(&quot;mod&quot;, new SQLFunctionTemplate(StandardBasicTypes.INTEGER,
        &quot;?1 % ?2&quot;));
    registerFunction(&quot;substr&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
    registerFunction(&quot;substring&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
  }

  public boolean supportsIdentityColumns() {
    return true;
  }

  public boolean hasDataTypeInIdentityColumn() {
    return false; // As specify in NHibernate dialect
  }

  public String getIdentityColumnString() {
    // return &quot;integer primary key autoincrement&quot;;
    return &quot;integer&quot;;
  }

  public String getIdentitySelectString() {
    return &quot;select last_insert_rowid()&quot;;
  }

  public boolean supportsLimit() {
    return true;
  }

  public String getLimitString(String query, boolean hasOffset) {
    return new StringBuffer(query.length() + 20).append(query).append(
        hasOffset ? &quot; limit ? offset ?&quot; : &quot; limit ?&quot;).toString();
  }

  public boolean bindLimitParametersInReverseOrder() {
    return true;
  }

  public boolean supportsTemporaryTables() {
    return true;
  }

  public String getCreateTemporaryTableString() {
    return &quot;create temporary table if not exists&quot;;
  }

  public boolean dropTemporaryTableAfterUse() {
    return false;
  }

  public boolean supportsCurrentTimestampSelection() {
    return true;
  }

  public boolean isCurrentTimestampSelectStringCallable() {
    return false;
  }

  public String getCurrentTimestampSelectString() {
    return &quot;select current_timestamp&quot;;
  }

  public boolean supportsUnionAll() {
    return true;
  }

  public boolean hasAlterTable() {
    return false; // As specify in NHibernate dialect
  }

  public boolean dropConstraints() {
    return false;
  }

  public String getAddColumnString() {
    return &quot;add column&quot;;
  }

  public String getForUpdateString() {
    return &quot;&quot;;
  }

  public boolean supportsOuterJoinForUpdate() {
    return false;
  }

  public String getDropForeignKeyString() {
    throw new UnsupportedOperationException(
        &quot;No drop foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddForeignKeyConstraintString(String constraintName,
      String[] foreignKey, String referencedTable, String[] primaryKey,
      boolean referencesPrimaryKey) {
    throw new UnsupportedOperationException(
        &quot;No add foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddPrimaryKeyConstraintString(String constraintName) {
    throw new UnsupportedOperationException(
        &quot;No add primary key syntax supported by SQLiteDialect&quot;);
  }

  public boolean supportsIfExistsBeforeTableName() {
    return true;
  }

  public boolean supportsCascadeDelete() {
    return false;
  }
}

</code></pre>

<p><code>/jpaspring/src/main/java/cl/lherrera/jpaspring/AppConfig.java</code></p>
<p>Es donde agregamos la personalización de la base de datos, donde la información se trae desde un archivo. Esto es debido a que cuando se sube a producción, este ambiente, posee su propio archivo y las credenciales no quedan expuestas.</p>
<pre><code class="java">package cl.lherrera.jpaspring;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

@Configuration
@ComponentScan(&quot;cl.lherrera.jpaspring&quot;)
@PropertySource(&quot;classpath:database.properties&quot;)
public class AppConfig {

    @Autowired
    Environment environment;

    @Bean
    DataSource dataSource() {
        DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();
        driverManagerDataSource.setUrl(environment.getProperty(&quot;url&quot;));
        driverManagerDataSource.setUsername(environment.getProperty(&quot;username&quot;));
        driverManagerDataSource.setPassword(environment.getProperty(&quot;dbpassword&quot;));
        driverManagerDataSource.setDriverClassName(environment.getProperty(&quot;driverClassName&quot;));
        return driverManagerDataSource;
    }

}
</code></pre>

<h5 id="srcmainresources"><strong><code>/src/main/resources/</code></strong></h5>
<p><code>/application.properties</code></p>
<p>Se listan las configuraciones de la aplicación, como por ejemplo el lugar donde irán los archivos JSP, además de configuraciones para la base de datos.</p>
<pre><code># Configuración para la vista. (http://localhost:8080/) no es (http://localhost:8080/jpaspring/)
# Eso es para un servlet
spring.mvc.view.prefix=/WEB-INF/pages/
spring.mvc.view.suffix=.jsp
# Permiso para clear el ddl de las entidades
spring.jpa.generate-ddl=true
# Ejecuta la configuración de la clase que mapea los tipos de datos.
spring.jpa.database-platform=cl.lherrera.jpaspring.SQLiteDialect
# Crea la base si no está y cuando finaliza la ejecución la borra.
spring.jpa.hibernate.ddl-auto=create-drop
# Muestra las consultas realizadas por el framework y las imprime en el log
spring.jpa.show-sql=true
# Le da un formáto legible por un humano para una mejor depuración en el log.
spring.jpa.properties.hibernate.format_sql=true

#Pruebas
#logging.level.org.hibernate.SQL=debug
#logging.level.org.hibernate.type.descriptor.sql=trace
</code></pre>

<p><code>/database.properties</code></p>
<p>Este archivo contendrá la configuración de la conexión a la base de datos. Para el ejemplo se utilizará SQLITE.</p>
<pre><code>driverClassName=org.sqlite.JDBC
url=jdbc:sqlite:basedatos.db
username=jpaspring
password=sa

</code></pre>

<h4 id="basedatosdb"><strong><code>/basedatos.db</code></strong></h4>
<p>Este archivo no contiene información, lo creamos con la extensión , lo abrimos con el cliente <code>DBEAVER</code>, usando las credenciales.</p>
<p><strong>Hasta ahora, solamente podemos ejecutar la aplicación, sin errores, no comprobamos el funcionamiento.</strong></p>
<h3 id="hito-2-creando-los-servicios-necesarios-para-la-aplicacion"><strong>Hito 2 - Creando los servicios necesarios para la aplicación.</strong></h3>
<p>En esta sección usaremos TDD para poder realizar los servicios con la utilización de <code>mockito</code>, simulamos la interacción con la base de datos. Esto no prueba realmente la base, si no que la simula, así que el correcto funcionamiento de la capa de acceso a datos no se prueba con esta técnica.</p>
<h4 id="archivos-modificados_1"><strong>Archivos modificados</strong></h4>
<pre><code>basedatos.db // no importa siempre se modifica.
src/main/java/cl/lherrera/jpaspring/entities/Persona.java
src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
src/main/java/cl/lherrera/jpaspring/services/PersonaService.java
src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
src/main/resources/application.properties // ya está el mejor puesto desde el principio
src/test/java/cl/lherrera/jpaspring/services/PersonaServiceTest.java
</code></pre>

<h4 id="srctestjavacllherrerajpaspringservices"><code>/src/test/java/cl/lherrera/jpaspring/services</code></h4>
<p><code>/PersonaServiceTest.java</code></p>
<p>Primero lo primero, partimos especulando mediante el uso de los test. El <code>mock</code> del <code>DAO</code> permite que el el servicio no use nuestro <code>DAO</code>, si no que el del <code>mock</code>, donde le decimos exactamente que debe traer, con ello verificamos todo el funcionamiento que requiera una simulación del comportamiento de la base de datos. Si se quiere probar la persistencia, este tipo de test, no son útiles. Para eso hay que diseñar alguno que use realmente la base, con una base de datos de prueba.</p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;

@SpringBootTest
public class PersonaServiceTest {

    @Autowired
    PersonaService servicio;

    @MockBean
    PersonaRepo mockRepo;

    @Test
    @DisplayName(&quot;Buscar personas por nombre&quot;)
    public void prueba005() {
        // crear la persona en la base mockdatos
        List&lt;Persona&gt; personas = new ArrayList&lt;&gt;();
        personas.add(new Persona(1, &quot;luis&quot;));
        personas.add(new Persona(2, &quot;luis&quot;));

        when(mockRepo.findAllByNombre(&quot;luis&quot;)).thenReturn(personas);


        // comprobamos la persona
        assertThat(personas).isEqualTo(servicio.obtenerPersonasPorNombre(&quot;luis&quot;));
    }

    @Test
    @DisplayName(&quot;obtener una lista de las personas&quot;)
    public void prueba004() {
        // una lista de personas
        List&lt;Persona&gt; personas = new ArrayList&lt;&gt;();
        personas.add(new Persona(1, &quot;luis&quot;));
        personas.add(new Persona(2, &quot;ana&quot;));
        // simular petición en la base de datos
        when((List&lt;Persona&gt;)mockRepo.findAll()).thenReturn(personas);

        assertThat(personas).isEqualTo(servicio.obtenerPersonas());

    }

    @Test
    @DisplayName(&quot;almacenar persona&quot;)
    public void prueba001() {
        // creamos el dato en memoria
        Persona persona = new Persona(1, &quot;luis&quot;);
        // simulación de dato en la base de datos
        when(mockRepo.save(persona)).thenReturn(persona);
        // funcionamiento del servicio. (se ejecuta el mockRepo y no
        // el repo que está en su clase, el que llama a 
        // la base datos así esta petición
        // se simula sin escribir
        // realmente en la BD
        assertThat(servicio.IngresarPersona(persona)).isEqualTo(persona);
    }

    @Test
    @DisplayName(&quot;actualizar una persona&quot;)
    public void prueba002() {
        // creamos la persona
        Persona persona = new Persona(1, &quot;Luis&quot;);
        // se simula persona encontrada
        when(mockRepo.findById(1)).thenReturn(Optional.of(persona));
        Persona personaUdt = servicio.encontrarPersona(1);
        // se actualiza el valor. se puede ver que la primera simulación
        // tuvo efecto, el mockRepo actuó como el repositorio
        // oficial ya que usamos el servicio para traer
        // la persona usando el servicio.
        personaUdt.setNombre(&quot;Ana&quot;);

        // simulación de actualización (es el repo el que simulamos y 
        // save(cuando existe actualiza o crea)
        when(mockRepo.save(personaUdt)).thenReturn(personaUdt);

        assertThat(servicio.actualizarPersona(personaUdt).getNombre()).isEqualTo(&quot;Ana&quot;);

    }


    @Test
    @DisplayName(&quot;eliminar persona&quot;)
    public void prueba003() {
        // encontrar la perosona para eliminarla ya que esta 
        // debe existir en la base de datos.
        when(mockRepo.findById(1))
        .thenReturn(Optional.of(new Persona(1, &quot;luis&quot;)));
        // con la base de datos simulada, utlizamos el servicio.
        Persona persona = servicio.encontrarPersona(1);
        // simulamos la interacción de la base de datos 
        when(mockRepo.myDeleteById(1)).thenReturn(Optional.of(persona));
        // ocupamos el servicio
        Persona personaEliminada = servicio.eliminarPersona(persona); 

        assertThat(personaEliminada.getId()).isEqualTo(persona.getId());

    }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringentities"><code>/src/main/java/cl/lherrera/jpaspring/entities</code></h4>
<p><code>/Persona.java</code></p>
<p>Entidad encargada de llevar el registro de la base, además es la guía para la creación del <code>DDL</code>. </p>
<pre><code class="java">package cl.lherrera.jpaspring.entities;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Persona {

    @Id
    @GeneratedValue(strategy=GenerationType.AUTO) // https://www.objectdb.com/java/jpa/entity/generated
    private Integer id;
    private String nombre;

    public Persona() {}

    public Persona(Integer id, String nombre) {
        this.id = id;
        this.nombre = nombre;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }
}

</code></pre>

<h4 id="jpaspringsrcmainjavacllherrerajpaspringrepositories"><code>/jpaspring/src/main/java/cl/lherrera/jpaspring/repositories</code></h4>
<p>Like a DAO.</p>
<p><code>/PersonaRepo.java</code></p>
<p>Esta es la magia de JPA. con solamente extender la interfaz <code>JpaRepository</code>, tenemos un <code>crud</code> armado, <code>PagingAndSortingRepository</code>, posibilita la paginación que veremos más adelante.</p>
<p>No se necesita implementar, Spring se encarga de esto. Si necesitamos personalizar una consulta lo podemos hacer con una anotación en la misma interfaz. Esta interfaz es lo más parecido al <code>dao</code> que estábamos acostumbrados, de hecho, a veces lo veremos en los paquetes <code>dao</code>, lo cual no está incorrecto, por que esta es precisamente la capa de acceso a los datos.</p>
<pre><code class="java">package cl.lherrera.jpaspring.repositories;

import java.util.List;
import java.util.Optional;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import cl.lherrera.jpaspring.entities.Persona;

public interface PersonaRepo extends CrudRepository&lt;Persona, Integer&gt; {

    /**
     * Se puede parecer mucho a una consulta en la base de datos pero es una
     * consulta al modelo, la respuesta es un @Entity. por eso la &quot;tabla&quot; está en
     * mayúsculas.
     * 
     * Eso es debido a que no renemos un PersonaRepoImpl que maneje la
     * personalización de esta consulta y como la original delete, retorna void no
     * es muy buena para hacer test ya que no tenemos contra qué validar si
     * simulamos la base de datos
     * 
     */
    @Query(&quot;DELETE FROM Persona WHERE id = ?1&quot;)
    Optional&lt;Persona&gt; myDeleteById(Integer id);

    // no posee un nombre personalizado, cumple con la nomenclatura find
    // debe ir aunque siga la nomenclatura
    List&lt;Persona&gt; findAllByNombre(String nombre);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservices"><code>/src/main/java/cl/lherrera/jpaspring/services</code></h4>
<p><code>/PersonaService.java</code></p>
<p>Interfaz de los servicios que se desarrollarán.</p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.List;

import cl.lherrera.jpaspring.entities.Persona;


public interface PersonaService {

    List&lt;Persona&gt; obtenerPersonas();
    List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre);
    Persona IngresarPersona(Persona persona);
    Persona encontrarPersona(Integer id);
    Persona eliminarPersona(Persona persona);
    Persona actualizarPersona(Persona persona);
}
</code></pre>

<p><code>/PersonaServiceImpl.java</code></p>
<p>Implementación de los servicios.</p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;

@Service
public class PersonaServiceImpl implements PersonaService{

    @Autowired
    PersonaRepo repo;

    @Override
    public List&lt;Persona&gt; obtenerPersonas() {
        return (List&lt;Persona&gt;) repo.findAll();
    }

    @Override
    public List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre) {

        return repo.findAllByNombre(nombre);
    }

    @Override
    public Persona encontrarPersona(Integer id) {
        // así nos evitamos un null pointer exception
        return repo.findById(id).orElse(new Persona());
    }

    @Override
    public Persona eliminarPersona(Persona persona) {
        return repo.myDeleteById(persona.getId()).orElse(new Persona());
    }

    @Override
    public Persona actualizarPersona(Persona persona) {
        return repo.save(persona);
    }

    @Override
    public Persona IngresarPersona(Persona persona) {       
        return repo.save(persona);
    }
}

</code></pre>

<h3 id="hito-3-crud-con-web"><strong>Hito 3 - CRUD con web.</strong></h3>
<p>Los servicios que se implementaron, ahora tendrán forma en la web. Veremos como trabaja <code>Spring</code> la parte visual utilizando <code>jsp</code>.</p>
<h4 id="archivos-modificados_2">Archivos modificados:</h4>
<pre><code>src/main/java/cl/lherrera/jpaspring/controllers/AplicationController.java
src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java
src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
src/main/resources/application.properties
src/main/webapp/WEB-INF/index.jsp
src/main/webapp/WEB-INF/pages/index.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/footerTemplate.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/headTemplate.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/navTemplate.jsp
src/main/webapp/WEB-INF/pages/personas/actualizar.jsp
src/main/webapp/WEB-INF/pages/personas/eliminar.jsp
src/main/webapp/WEB-INF/pages/personas/personas.jsp
src/test/java/cl/lherrera/jpaspring/services/PersonaServiceTest.java
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringcontrollers"><strong><code>src/main/java/cl/lherrera/jpaspring/controllers/</code></strong></h4>
<p><code>/AplicationController.java</code></p>
<pre><code class="java">package cl.lherrera.jpaspring.controllers;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;


@Controller
public class AplicationController {
    private static final Logger logger = LoggerFactory.getLogger(AplicationController.class);

    @GetMapping(&quot;/&quot;)
    public String home() {
        logger.info(&quot;llamada a : '/'&quot;);
        return &quot;index&quot;;
    }

}

</code></pre>

<p><code>/PersonaController.java</code></p>
<pre><code class="java">package cl.lherrera.jpaspring.controllers;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.services.PersonaService;

@Controller
@RequestMapping(&quot;/personas&quot;)
public class PersonaController {
    private static final Logger logger = LoggerFactory.getLogger(PersonaController.class);

    @Autowired
    PersonaService servicio;

    @GetMapping(&quot;/ingresar&quot;)
    @ResponseStatus(code = HttpStatus.OK)
    public String inicio(Model modelo) {
        logger.info(&quot;Petición: /personas/&quot;);
        List&lt;Persona&gt; personas = servicio.obtenerPersonas();

        modelo.addAttribute(&quot;personas&quot;, personas);
        return &quot;personas/personas&quot;;
    }

//  @ResponseStatus(code = HttpStatus.CREATED) // con esto no funciona el redirect
    @PostMapping(&quot;/ingresar&quot;)
    public String ingresar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String nombre, 
            RedirectAttributes attributes) {
        logger.info(&quot;Petición post /ingresar&quot;);

        Persona respuesta = servicio.IngresarPersona(persona);

        if(persona == null) 
            logger.error(&quot;error en ingreso de persona&quot;);


        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/actualizar&quot;)
    public String actualizar(
            Model modelo, 
            @RequestParam String id) {
        logger.info(&quot;Petición-GET: /actualizar&quot;);

        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/actualizar&quot;;
    }

    // el formulario debe estar completo con los names, para que lo
    // reconozca como la misma entidad y no una nueva
    @PostMapping(&quot;/actualizar&quot;)
    public String doActualizar(@ModelAttribute(&quot;foo&quot;) Persona persona) {
        logger.info(&quot;Petición-POST: /actualizar&quot;);
        servicio.actualizarPersona(persona);
        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/eliminar&quot;)
    public String eliminar(
            Model modelo, 
            @RequestParam String id) {
        logger.info(&quot;Petición-GET: /eliminar&quot;);
        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/eliminar&quot;;
    }

    @PostMapping(&quot;/eliminar&quot;)
    public String doEliminar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String id) {
        logger.info(&quot;Petición-POST: /eliminar&quot;);
        Persona respuesta = servicio.eliminarPersona(persona);
        if(respuesta == null)
            logger.info(&quot;Petición-POST: /eliminar&quot;);    

        return &quot;redirect:ingresar&quot;;
    }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringrepositories"><strong><code>src/main/java/cl/lherrera/jpaspring/repositories</code></strong></h4>
<p><code>/PersonaRepo.java</code></p>
<pre><code class="java">package cl.lherrera.jpaspring.repositories;

import java.util.List;
import java.util.Optional;

import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import cl.lherrera.jpaspring.entities.Persona;

public interface PersonaRepo extends CrudRepository&lt;Persona, Integer&gt; {

    /**
     * Se puede parecer mucho a una consulta en la base de datos pero es una
     * consulta al modelo, la respuesta es un @Entity. por eso la &quot;tabla&quot; está en
     * mayúsculas.
     * 
     * Eso es debido a que no renemos un PersonaRepoImpl que maneje la
     * personalización de esta consulta y como la original delete, retorna void no
     * es muy buena para hacer test ya que no tenemos contra qué validar si
     * simulamos la base de datos. 
     * 
     * En el fondo es solamente un deleteById(), pero se expone para su ejemplo
     * Que podemos aplicar queries a las entidades.
     * 
     */
    @Modifying
    @Query(&quot;DELETE FROM Persona WHERE id = ?1&quot;)
    Integer myDeleteById(Integer id);

    // no posee un nombre personalizado, cumple con la nomenclatura find
    // debe ir aunque siga la nomenclatura
    List&lt;Persona&gt; findAllByNombre(String nombre);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservices_1"><code>src/main/java/cl/lherrera/jpaspring/services</code></h4>
<p><code>/PersonaServiceImpl.java</code></p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;

@Service
public class PersonaServiceImpl implements PersonaService{

    @Autowired
    PersonaRepo repo;

    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonas() {
        return (List&lt;Persona&gt;) repo.findAll();
    }

    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre) {

        return repo.findAllByNombre(nombre);
    }

    @Override
    @Transactional(readOnly = true)
    public Persona encontrarPersona(Integer id) {
        // así nos evitamos un null pointer exception
        return repo.findById(id).orElse(new Persona());
    }

    @Override
    @Transactional
    public Persona eliminarPersona(Persona persona) {
        int numeroQueAunNoSeOcupa = repo.myDeleteById(persona.getId());
        return persona;
    }

    @Override
    @Transactional
    public Persona actualizarPersona(Persona persona) {
        return repo.save(persona);
    }

    @Override
    @Transactional
    public Persona IngresarPersona(Persona persona) {       
        return repo.save(persona);
    }


}

</code></pre>

<h4 id="srcmainwebappweb-inf"><code>src/main/webapp/WEB-INF</code></h4>
<p><code>/index.jsp</code></p>
<pre><code class="html">Eliminado
</code></pre>

<p><code>/pages/index.jsp</code></p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;jsp:include page=&quot;htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;

&lt;body&gt;
&lt;jsp:include page=&quot;htmlTemplates/navTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;

&lt;h1&gt;Inicio de la web&lt;/h1&gt;

&lt;jsp:include page=&quot;htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><code>/pages/htmlTemplates/footerTemplate.jsp</code></p>
<pre><code class="html">&lt;footer&gt;
    &lt;!-- bootstrap 4 --&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.4.1.slim.min.js&quot;
        integrity=&quot;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&quot;
        integrity=&quot;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&quot;
        integrity=&quot;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;!-- bootstrap #--&gt;
&lt;/footer&gt;
</code></pre>

<p><code>/pages/htmlTemplates/headTemplate.jsp</code></p>
<pre><code class="html">&lt;!-- Este template, está diseñado para mantener la cabecera del sitio --&gt;
&lt;!-- unificada en una sola, ya que la comparten. --&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;FPA-EJEMPLO&lt;/title&gt;
    &lt;!-- cdn bootstrap 4 --&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot;
        integrity=&quot;sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh&quot; crossorigin=&quot;anonymous&quot;&gt;
    &lt;!-- cdn bootstrap 4 #--&gt;
&lt;/head&gt;

</code></pre>

<p><code>/pages/htmlTemplates/navTemplate.jsp</code></p>
<pre><code class="html">&lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-light&quot;&gt;
    &lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;JPA-EJEMPLO&lt;/a&gt;
    &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbarSupportedContent&quot;
        aria-controls=&quot;navbarSupportedContent&quot; aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;
        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
    &lt;/button&gt;

    &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarSupportedContent&quot;&gt;
        &lt;ul class=&quot;navbar-nav mr-auto&quot;&gt;
            &lt;!-- Home --&gt;
            &lt;li class=&quot;nav-item active&quot;&gt;&lt;a class=&quot;nav-link&quot; href=&quot;/&quot;&gt;Home
                    &lt;span class=&quot;sr-only&quot;&gt;(current)&lt;/span&gt;
                &lt;/a&gt;&lt;/li&gt;
            &lt;!-- Home #--&gt;
            &lt;li class=&quot;nav-item dropdown&quot;&gt;
                &lt;a class=&quot;nav-link dropdown-toggle&quot; href=&quot;#&quot; id=&quot;navbarDropdown&quot; role=&quot;button&quot; data-toggle=&quot;dropdown&quot;
                    aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt; Mantenedor de personas &lt;/a&gt;
                &lt;div class=&quot;dropdown-menu&quot; aria-labelledby=&quot;navbarDropdown&quot;&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;/personas/ingresar&quot;&gt;Ingresar&lt;/a&gt;
                &lt;/div&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/nav&gt;
</code></pre>

<p><code>/pages/personas/actualizar.jsp</code></p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

&lt;html&gt;
&lt;jsp:include page=&quot;../htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;body&gt;
    &lt;jsp:include page=&quot;../htmlTemplates/navTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col&quot;&gt;

                &lt;form:form class=&quot;form-horizontal&quot; method=&quot;post&quot;
                    action=&quot;/personas/actualizar&quot; modelAttribute=&quot;Persona&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;nombre&quot;&gt;Nombre&lt;/label&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot;
                            value=&quot;${persona.getId()}&quot;&gt; &lt;input type=&quot;text&quot;
                            class=&quot;form-control&quot; id=&quot;nombre&quot; name=&quot;nombre&quot;
                            value=&quot;${persona.getNombre()}&quot;&gt;
                    &lt;/div&gt;

                    &lt;a href=&quot;/personas/ingresar&quot; class=&quot;btn btn-primary mb-2&quot;
                        role=&quot;button&quot; aria-pressed=&quot;true&quot;&gt;Cancelar&lt;/a&gt;
                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-warning mb-2&quot;&gt;Actualizar&lt;/button&gt;
                &lt;/form:form&gt;

            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;
    &lt;jsp:include page=&quot;../htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><code>/pages/personas/eliminar.jsp</code></p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

&lt;html&gt;
&lt;jsp:include page=&quot;../htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;body&gt;
    &lt;jsp:include page=&quot;../htmlTemplates/navTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col&quot;&gt;

                &lt;form:form class=&quot;form-horizontal&quot; method=&quot;post&quot;
                    action=&quot;/personas/eliminar&quot; modelAttribute=&quot;Persona&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;nombre&quot;&gt;Nombre&lt;/label&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot;
                            value=&quot;${persona.getId()}&quot;&gt; &lt;input type=&quot;text&quot;
                            class=&quot;form-control&quot; id=&quot;nombre&quot; name=&quot;nombre&quot; disabled disabled
                            value=&quot;${persona.getNombre()}&quot;&gt;

                    &lt;/div&gt;

                    &lt;a href=&quot;/personas/ingresar&quot; class=&quot;btn btn-primary mb-2&quot;
                        role=&quot;button&quot; aria-pressed=&quot;true&quot;&gt;Cancelar&lt;/a&gt;

                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-danger mb-2&quot;&gt;Confirmar&lt;/button&gt;
                &lt;/form:form&gt;

            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;

    &lt;jsp:include page=&quot;../htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><code>/pages/personas/personas.jsp</code></p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;jsp:include page=&quot;../htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;body&gt;
&lt;jsp:include page=&quot;../htmlTemplates/navTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col&quot;&gt;

        &lt;form:form 
            class=&quot;form-horizontal&quot; 
            method=&quot;post&quot; 
            action=&quot;/personas/ingresar&quot; 
            modelAttribute=&quot;Persona&quot;&gt;

            &lt;div class=&quot;form-group&quot;&gt;
                &lt;label for=&quot;nombre&quot;&gt;Nombre&lt;/label&gt; 
                &lt;input 
                    type=&quot;text&quot; 
                    class=&quot;form-control&quot; 
                    id=&quot;nombre&quot; 
                    name=&quot;nombre&quot;
                    placeholder=&quot;Ingrese el nombre&quot;&gt;

            &lt;/div&gt;

            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary mb-2&quot;&gt;Ingresar&lt;/button&gt;    

        &lt;/form:form&gt;

            &lt;div class=&quot;table-responsive&quot;&gt;
                &lt;table class=&quot;table table-hover table-striped table-bordered&quot;&gt;
                    &lt;tr&gt;
                        &lt;th&gt;Id&lt;/th&gt;
                        &lt;th&gt;Nombre&lt;/th&gt;
                        &lt;th&gt;Acción&lt;/th&gt;
                    &lt;/tr&gt;

                    &lt;c:forEach items=&quot;${personas}&quot; var=&quot;persona&quot;&gt;
                        &lt;tr&gt;
                            &lt;td&gt;${persona.getId()}&lt;/td&gt;
                            &lt;td&gt;${persona.getNombre()}&lt;/td&gt;
                            &lt;td&gt;
                            &lt;a href=&quot;/personas/actualizar?id=${persona.getId()}&quot;&gt;Actualizar&lt;/a&gt;
                                | 
                            &lt;a href=&quot;/personas/eliminar?id=${persona.getId()}&quot; &gt;Elimininar&lt;/a&gt;
                            &lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/c:forEach&gt;

                &lt;/table&gt;
            &lt;/div&gt;

        &lt;/div&gt;
    &lt;/div&gt;

&lt;/div&gt;

    &lt;jsp:include page=&quot;../htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h4 id="srctestjavacllherrerajpaspringservices_1"><code>src/test/java/cl/lherrera/jpaspring/services</code></h4>
<p><code>/PersonaServiceTest.java</code></p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;

@SpringBootTest
public class PersonaServiceTest {

    @Autowired
    PersonaService servicio;

    @MockBean
    PersonaRepo mockRepo;

    @Test
    @DisplayName(&quot;Buscar personas por nombre&quot;)
    public void prueba005() {
        // crear la persona en la base mockdatos
        List&lt;Persona&gt; personas = new ArrayList&lt;&gt;();
        personas.add(new Persona(1, &quot;luis&quot;));
        personas.add(new Persona(2, &quot;luis&quot;));

        when(mockRepo.findAllByNombre(&quot;luis&quot;)).thenReturn(personas);


        // comprobamos la persona
        assertThat(personas).isEqualTo(servicio.obtenerPersonasPorNombre(&quot;luis&quot;));
    }

    @Test
    @DisplayName(&quot;obtener una lista de las personas&quot;)
    public void prueba004() {
        // una lista de personas
        List&lt;Persona&gt; personas = new ArrayList&lt;&gt;();
        personas.add(new Persona(1, &quot;luis&quot;));
        personas.add(new Persona(2, &quot;ana&quot;));
        // simular petición en la base de datos
        when((List&lt;Persona&gt;)mockRepo.findAll()).thenReturn(personas);

        assertThat(personas).isEqualTo(servicio.obtenerPersonas());

    }

    @Test
    @DisplayName(&quot;almacenar persona&quot;)
    public void prueba001() {
        // creamos el dato en memoria
        Persona persona = new Persona(1, &quot;luis&quot;);
        // simulación de dato en la base de datos
        when(mockRepo.save(persona)).thenReturn(persona);
        // funcionamiento del servicio. (se ejecuta el mockRepo y no
        // el repo que está en su clase, el que llama a 
        // la base datos así esta petición
        // se simula sin escribir
        // realmente en la BD
        assertThat(servicio.IngresarPersona(persona)).isEqualTo(persona);
    }

    @Test
    @DisplayName(&quot;actualizar una persona&quot;)
    public void prueba002() {
        // creamos la persona
        Persona persona = new Persona(1, &quot;Luis&quot;);
        // se simula persona encontrada
        when(mockRepo.findById(1)).thenReturn(Optional.of(persona));
        Persona personaUdt = servicio.encontrarPersona(1);
        // se actualiza el valor. se puede ver que la primera simulación
        // tuvo efecto, el mockRepo actuó como el repositorio
        // oficial ya que usamos el servicio para traer
        // la persona usando el servicio.
        personaUdt.setNombre(&quot;Ana&quot;);

        // simulación de actualización (es el repo el que simulamos y 
        // save(cuando existe actualiza o crea)
        when(mockRepo.save(personaUdt)).thenReturn(personaUdt);

        assertThat(servicio.actualizarPersona(personaUdt).getNombre()).isEqualTo(&quot;Ana&quot;);

    }


    @Test
    @DisplayName(&quot;eliminar persona&quot;)
    public void prueba003() {
        // encontrar la perosona para eliminarla ya que esta 
        // debe existir en la base de datos.
        when(mockRepo.findById(1))
        .thenReturn(Optional.of(new Persona(1, &quot;luis&quot;)));
        // con la base de datos simulada, utlizamos el servicio.
        Persona persona = servicio.encontrarPersona(1);
        // simulamos la interacción de la base de datos 
        when(mockRepo.myDeleteById(1)).thenReturn(1);
        // ocupamos el servicio
        Persona personaEliminada = servicio.eliminarPersona(persona); 

        assertThat(personaEliminada.getId()).isEqualTo(persona.getId());

    }

}

</code></pre>

<h2 id="hito-4-creando-resultados-paginados">Hito 4 - Creando resultados paginados.</h2>
<p>En diferentes ocaciones, podremos usar algún componente como <code>datatable</code> de <code>javascript</code> para poder crear tablas de resultados, pero vamos a aprender a diseñarla personalizada mente con <code>Java y Spring</code>.</p>
<h3 id="archivos-modificados_3">Archivos modificados:</h3>
<pre><code>basedatos.db
pom.xml
src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java
src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java
src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java
src/main/java/cl/lherrera/jpaspring/dtos/PersonaDTO.java
src/main/java/cl/lherrera/jpaspring/entities/Persona.java
src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
src/main/java/cl/lherrera/jpaspring/services/PersonaService.java
src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
src/main/resources/application.properties
src/main/webapp/WEB-INF/pages/personas/personas.jsp
</code></pre>

<h4 id="pomxml_1"><code>pom.xml</code></h4>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.jpaspring&lt;/groupId&gt;
    &lt;artifactId&gt;jpaspring&lt;/artifactId&gt;
    &lt;version&gt;20.0.0&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;jpaspring&lt;/name&gt;
    &lt;description&gt;proyecto JPA SQLITE&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP # --&gt;

        &lt;!-- JSTL --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- JSTL # --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringjpaspringapplicationjava"><code>src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.boot.CommandLineRunner;



@SpringBootApplication
public class JpaspringApplication {

    public static void main(String[] args) {
        SpringApplication.run(JpaspringApplication.class, args);
    }

//  @Bean
//  public CommandLineRunner demo(PersonaServiceImpl servicio) {
//      return (args) -&gt; {
//           servicio.obtenerPersonasPaginadas(0, 3);
//      };
//  }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringsqlitedialectjava"><code>src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java</code></h4>
<p>Esto ya estaba solucionado, pero <code>prosaicos</code> lo pongo.</p>
<pre><code class="java">package cl.lherrera.jpaspring;

import java.sql.Types;

import org.hibernate.dialect.Dialect;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.VarArgsSQLFunction;
import org.hibernate.type.StandardBasicTypes;
import org.hibernate.Hibernate;

public class SQLiteDialect extends Dialect {
  public SQLiteDialect() {
    super();
    registerColumnType(Types.BIT, &quot;integer&quot;);
    registerColumnType(Types.TINYINT, &quot;tinyint&quot;);
    registerColumnType(Types.SMALLINT, &quot;smallint&quot;);
    registerColumnType(Types.INTEGER, &quot;integer&quot;);
    registerColumnType(Types.BIGINT, &quot;bigint&quot;);
    registerColumnType(Types.FLOAT, &quot;float&quot;);
    registerColumnType(Types.REAL, &quot;real&quot;);
    registerColumnType(Types.DOUBLE, &quot;double&quot;);
    registerColumnType(Types.NUMERIC, &quot;numeric&quot;);
    registerColumnType(Types.DECIMAL, &quot;decimal&quot;);
    registerColumnType(Types.CHAR, &quot;char&quot;);
    registerColumnType(Types.VARCHAR, &quot;varchar&quot;);
    registerColumnType(Types.LONGVARCHAR, &quot;longvarchar&quot;);
    registerColumnType(Types.DATE, &quot;date&quot;);
    registerColumnType(Types.TIME, &quot;time&quot;);
    registerColumnType(Types.TIMESTAMP, &quot;timestamp&quot;);
    registerColumnType(Types.BINARY, &quot;blob&quot;);
    registerColumnType(Types.VARBINARY, &quot;blob&quot;);
    registerColumnType(Types.LONGVARBINARY, &quot;blob&quot;);
    // registerColumnType(Types.NULL, &quot;null&quot;);
    registerColumnType(Types.BLOB, &quot;blob&quot;);
    registerColumnType(Types.CLOB, &quot;clob&quot;);
    registerColumnType(Types.BOOLEAN, &quot;integer&quot;);

    registerFunction(&quot;concat&quot;, new VarArgsSQLFunction(StandardBasicTypes.STRING, &quot;&quot;,
        &quot;||&quot;, &quot;&quot;));
    registerFunction(&quot;mod&quot;, new SQLFunctionTemplate(StandardBasicTypes.INTEGER,
        &quot;?1 % ?2&quot;));
    registerFunction(&quot;substr&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
    registerFunction(&quot;substring&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
  }

  public boolean supportsIdentityColumns() {
    return true;
  }

  public boolean hasDataTypeInIdentityColumn() {
    return false; // As specify in NHibernate dialect
  }

  public String getIdentityColumnString() {
    // return &quot;integer primary key autoincrement&quot;;
    return &quot;integer&quot;;
  }

  public String getIdentitySelectString() {
    return &quot;select last_insert_rowid()&quot;;
  }

  public boolean supportsLimit() {
    return true;
  }

  public String getLimitString(String query, boolean hasOffset) {
    return new StringBuffer(query.length() + 20).append(query).append(
        hasOffset ? &quot; limit ? offset ?&quot; : &quot; limit ?&quot;).toString();
  }

  public boolean bindLimitParametersInReverseOrder() {
    return true;
  }

  public boolean supportsTemporaryTables() {
    return true;
  }

  public String getCreateTemporaryTableString() {
    return &quot;create temporary table if not exists&quot;;
  }

  public boolean dropTemporaryTableAfterUse() {
    return false;
  }

  public boolean supportsCurrentTimestampSelection() {
    return true;
  }

  public boolean isCurrentTimestampSelectStringCallable() {
    return false;
  }

  public String getCurrentTimestampSelectString() {
    return &quot;select current_timestamp&quot;;
  }

  public boolean supportsUnionAll() {
    return true;
  }

  public boolean hasAlterTable() {
    return false; // As specify in NHibernate dialect
  }

  public boolean dropConstraints() {
    return false;
  }

  public String getAddColumnString() {
    return &quot;add column&quot;;
  }

  public String getForUpdateString() {
    return &quot;&quot;;
  }

  public boolean supportsOuterJoinForUpdate() {
    return false;
  }

  public String getDropForeignKeyString() {
    throw new UnsupportedOperationException(
        &quot;No drop foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddForeignKeyConstraintString(String constraintName,
      String[] foreignKey, String referencedTable, String[] primaryKey,
      boolean referencesPrimaryKey) {
    throw new UnsupportedOperationException(
        &quot;No add foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddPrimaryKeyConstraintString(String constraintName) {
    throw new UnsupportedOperationException(
        &quot;No add primary key syntax supported by SQLiteDialect&quot;);
  }

  public boolean supportsIfExistsBeforeTableName() {
    return true;
  }

  public boolean supportsCascadeDelete() {
    return false;
  }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringcontrollerspersonacontrollerjava"><code>src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.controllers;


import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import cl.lherrera.jpaspring.dtos.PersonaDTO;
import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.services.PersonaService;

@Controller
@RequestMapping(&quot;/personas&quot;)
public class PersonaController {
    private static final Logger logger = LoggerFactory.getLogger(PersonaController.class);
    private static final Integer FILAS_POR_PAGINA = 3;

    @Autowired
    PersonaService servicio;

    @GetMapping(&quot;/ingresar&quot;)
    @ResponseStatus(code = HttpStatus.OK)
    public String inicio(
            Model modelo, 
            @RequestParam(required = false) Integer pagina) {

        logger.info(&quot;Petición: /personas/ingresar&quot;);
        // si no viene la página, se simula la primera, el método PageRequest.of(pagina
        // pide que la primera sea cero; pero esto es manejado por el servicio
        // en el controlador sabemos que la primera página es la 1, si esto no es
        // así, el servicio lo debe manejar
        if(pagina == null)
            pagina = 1;

        PersonaDTO dtoPersona = servicio.obtenerPersonasPaginadas(pagina, FILAS_POR_PAGINA);

        modelo.addAttribute(&quot;dtoPersona&quot;, dtoPersona);
        // si no hay más de una página, no es necesario paginar
        modelo.addAttribute(&quot;paginar&quot;, dtoPersona.getPaginas().size() &gt; 1);
        return &quot;personas/personas&quot;;
    }

//  @ResponseStatus(code = HttpStatus.CREATED) // con esto no funciona el redirect
    @PostMapping(&quot;/ingresar&quot;)
    public String ingresar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String nombre, 
            RedirectAttributes attributes) {
        logger.info(&quot;Petición post /ingresar&quot;);

        // sin usar el retorno aún
        Persona respuesta = servicio.IngresarPersona(persona);

        if(persona == null) 
            logger.error(&quot;error en ingreso de persona&quot;);


        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/actualizar&quot;)
    public String actualizar(
            Model modelo, 
            @RequestParam String id) {
        logger.info(&quot;Petición-GET: /actualizar&quot;);

        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/actualizar&quot;;
    }

    // el formulario debe estar completo con los names, para que lo
    // reconozca como la misma entidad y no una nueva
    @PostMapping(&quot;/actualizar&quot;)
    public String doActualizar(@ModelAttribute(&quot;foo&quot;) Persona persona) {
        logger.info(&quot;Petición-POST: /actualizar&quot;);
        servicio.actualizarPersona(persona);
        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/eliminar&quot;)
    public String eliminar(
            Model modelo, 
            @RequestParam String id) {
        logger.info(&quot;Petición-GET: /eliminar&quot;);
        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/eliminar&quot;;
    }

    @PostMapping(&quot;/eliminar&quot;)
    public String doEliminar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String id) {
        logger.info(&quot;Petición-POST: /eliminar&quot;);
        Persona respuesta = servicio.eliminarPersona(persona);
        if(respuesta == null)
            logger.info(&quot;Petición-POST: /eliminar&quot;);    

        return &quot;redirect:ingresar&quot;;
    }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringdtospersonadtojava"><code>src/main/java/cl/lherrera/jpaspring/dtos/PersonaDTO.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.dtos;

import java.util.List;

import cl.lherrera.jpaspring.entities.Persona;

public class PersonaDTO {

    private List&lt;Persona&gt; personas;
    private List&lt;Integer&gt; paginas;
    private Integer paginaActual;

    public List&lt;Persona&gt; getPersonas() {
        return personas;
    }

    public void setPersonas(List&lt;Persona&gt; personas) {
        this.personas = personas;
    }

    public List&lt;Integer&gt; getPaginas() {
        return paginas;
    }

    public void setPaginas(List&lt;Integer&gt; paginas) {
        this.paginas = paginas;
    }

    public Integer getPaginaActual() {
        return paginaActual;
    }

    public void setPaginaActual(Integer paginaActual) {
        this.paginaActual = paginaActual;
    }

    @Override
    public String toString() {
        return &quot;PersonaDTO [personas=&quot; + personas + &quot;, paginas=&quot; + paginas + &quot;, paginaActual=&quot; + paginaActual + &quot;]&quot;;
    }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringentitiespersonajava"><code>src/main/java/cl/lherrera/jpaspring/entities/Persona.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.entities;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Persona {

    @Id
    @GeneratedValue(strategy=GenerationType.AUTO) // https://www.objectdb.com/java/jpa/entity/generated
    private Integer id;
    private String nombre;

    public Persona() {}

    public Persona(Integer id, String nombre) {
        this.id = id;
        this.nombre = nombre;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    @Override
    public String toString() {
        return &quot;Persona [id=&quot; + id + &quot;, nombre=&quot; + nombre + &quot;]&quot;;
    }

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringrepositoriespersonarepojava"><code>src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.repositories;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.PagingAndSortingRepository;

import cl.lherrera.jpaspring.entities.Persona;

public interface PersonaRepo 
    extends JpaRepository&lt;Persona, Integer&gt;,
        PagingAndSortingRepository&lt;Persona, Integer&gt; {

    /**
     * Se puede parecer mucho a una consulta en la base de datos pero es una
     * consulta al modelo, la respuesta es un @Entity. por eso la &quot;tabla&quot; está en
     * mayúsculas.
     * 
     * Eso es debido a que no renemos un PersonaRepoImpl que maneje la
     * personalización de esta consulta y como la original delete, retorna void no
     * es muy buena para hacer test ya que no tenemos contra qué validar si
     * simulamos la base de datos. 
     * 
     * En el fondo es solamente un deleteById(), pero se expone para su ejemplo
     * Que podemos aplicar queries a las entidades.
     * 
     */
    @Modifying
    @Query(&quot;DELETE FROM Persona WHERE id = ?1&quot;)
    Integer myDeleteById(Integer id);

    // no posee un nombre personalizado, cumple con la nomenclatura find
    // debe ir aunque siga la nomenclatura
    List&lt;Persona&gt; findAllByNombre(String nombre);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicespersonaservicejava"><code>src/main/java/cl/lherrera/jpaspring/services/PersonaService.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.List;

import cl.lherrera.jpaspring.dtos.PersonaDTO;
import cl.lherrera.jpaspring.entities.Persona;


public interface PersonaService {

    PersonaDTO obtenerPersonasPaginadas(Integer pagina, Integer cantidad);
    List&lt;Persona&gt; obtenerPersonas();
    List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre);
    Persona IngresarPersona(Persona persona);
    Persona encontrarPersona(Integer id);
    Persona eliminarPersona(Persona persona);
    Persona actualizarPersona(Persona persona);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicespersonaserviceimpljava"><code>src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.criteria.Order;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import cl.lherrera.jpaspring.dtos.PersonaDTO;
import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;

@Service
public class PersonaServiceImpl implements PersonaService{
    private static final Logger logger = LoggerFactory.getLogger(PersonaServiceImpl.class.getName());

    @Autowired
    PersonaRepo repo;


    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonas() {
        return (List&lt;Persona&gt;) repo.findAll();
    }

    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre) {

        return repo.findAllByNombre(nombre);
    }

    @Override
    @Transactional(readOnly = true)
    public Persona encontrarPersona(Integer id) {
        // así nos evitamos un null pointer exception
        return repo.findById(id).orElse(new Persona());
    }

    @Override
    @Transactional
    public Persona eliminarPersona(Persona persona) {
        int numeroQueAunNoSeOcupa = repo.myDeleteById(persona.getId());
        return persona;
    }

    @Override
    @Transactional
    public Persona actualizarPersona(Persona persona) {
        return repo.save(persona);
    }

    @Override
    @Transactional
    public Persona IngresarPersona(Persona persona) {       
        return repo.save(persona);
    }

    @Override
    public PersonaDTO obtenerPersonasPaginadas(Integer pagina, Integer cantidad) {
        logger.info(&quot;Num Pagina: &quot; + pagina);
        PersonaDTO personaDTO = new PersonaDTO();
        // comienza en cero, para que con la página 1
        // busque en la página 0 y lo retorne como página 1.


        Pageable paginado = PageRequest.of(pagina - 1, 2, Sort.by(&quot;id&quot;).ascending());
        // consulta a la base
        Page&lt;Persona&gt; personaPaginas = repo.findAll(paginado);

        logger.info(personaPaginas.getContent().toString());

        // ingreso de personas al DTO
        personaDTO.setPersonas(personaPaginas.getContent());
        // ingresamos el número de página actual
        // el getNumber nos entrega un cero en caso de ser la primera página
        // el argumento pagina, viene desde el front con el click
        // que se hace y llegará fielmente el verdadero número a buscar
        // el único aproblemado con esto es el PageRequest.of(pagina... ya que
        // él busca por el número consultado menos uno.
        personaDTO.setPaginaActual(pagina);
        // llenamos la lista de números del paginador
        List&lt;Integer&gt; paginas = new ArrayList&lt;&gt;();
        for(int i = 0; i &lt; personaPaginas.getTotalPages(); i ++)
            paginas.add(i + 1);

        personaDTO.setPaginas(paginas);
        logger.info(&quot;personaDTO: &quot; + personaDTO.toString());
        return personaDTO;
    }


}

</code></pre>

<h4 id="srcmainresourcesapplicationproperties"><code>src/main/resources/application.properties</code></h4>
<p>Solucionado pero igual... </p>
<pre><code class="conf"># Configuración para la vista. (http://localhost:8080/) no es (http://localhost:8080/jpaspring/)
# Eso es para un servlet
spring.mvc.view.prefix=/WEB-INF/pages/
spring.mvc.view.suffix=.jsp
# Permiso para clear el ddl de las entidades
spring.jpa.generate-ddl=true
# Ejecuta la configuración de la clase que mapea los tipos de datos.
spring.jpa.database-platform=cl.lherrera.jpaspring.SQLiteDialect
# Crea la base si no está y cuando finaliza la ejecución la borra.
spring.jpa.hibernate.ddl-auto=create-drop
# Muestra las consultas realizadas por el framework y las imprime en el log
spring.jpa.show-sql=true
# Le da un formáto legible por un humano para una mejor depuración en el log.
spring.jpa.properties.hibernate.format_sql=true

#Pruebas
#logging.level.org.hibernate.SQL=debug
#logging.level.org.hibernate.type.descriptor.sql=trace


</code></pre>

<h4 id="srcmainwebappweb-infpagespersonaspersonasjsp"><code>src/main/webapp/WEB-INF/pages/personas/personas.jsp</code></h4>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;jsp:include page=&quot;../htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;body&gt;
    &lt;jsp:include page=&quot;../htmlTemplates/navTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col&quot;&gt;

                &lt;form:form class=&quot;form-horizontal&quot; method=&quot;post&quot;
                    action=&quot;/personas/ingresar&quot; modelAttribute=&quot;Persona&quot;&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;nombre&quot;&gt;Nombre&lt;/label&gt; &lt;input type=&quot;text&quot;
                            class=&quot;form-control&quot; id=&quot;nombre&quot; name=&quot;nombre&quot;
                            placeholder=&quot;Ingrese el nombre&quot;&gt;

                    &lt;/div&gt;

                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary mb-2&quot;&gt;Ingresar&lt;/button&gt;

                &lt;/form:form&gt;

                &lt;div class=&quot;table-responsive&quot;&gt;
                    &lt;table class=&quot;table table-hover table-striped table-bordered&quot;&gt;
                        &lt;tr&gt;
                            &lt;th&gt;Id&lt;/th&gt;
                            &lt;th&gt;Nombre&lt;/th&gt;
                            &lt;th&gt;Acción&lt;/th&gt;
                        &lt;/tr&gt;
                        &lt;c:choose&gt;
                            &lt;c:when test=&quot;${dtoPersona.getPersonas().size() &gt; 0}&quot;&gt;  
                                &lt;c:forEach items=&quot;${dtoPersona.getPersonas()}&quot; var=&quot;persona&quot;&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;${persona.getId()}&lt;/td&gt;
                                        &lt;td&gt;${persona.getNombre()}&lt;/td&gt;
                                        &lt;td&gt;&lt;a href=&quot;/personas/actualizar?id=${persona.getId()}&quot;&gt;Actualizar&lt;/a&gt;
                                            | &lt;a href=&quot;/personas/eliminar?id=${persona.getId()}&quot;&gt;Elimininar&lt;/a&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/c:forEach&gt;
                            &lt;/c:when&gt;
                            &lt;c:otherwise&gt;
                                &lt;tr&gt;
                                    &lt;td colspan=&quot;3&quot;&gt;${&quot;Sin registros...&quot;}&lt;/td&gt;

                                &lt;/tr&gt;
                            &lt;/c:otherwise&gt;
                        &lt;/c:choose&gt;
                    &lt;/table&gt;

                    &lt;!-- PAGINACIÖN --&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test=&quot;${paginar}&quot;&gt;

                            &lt;nav aria-label=&quot;Ejemplo de paginación&quot;&gt;
                                &lt;ul class=&quot;pagination&quot;&gt;
                                    &lt;c:choose&gt;
                                        &lt;c:when test=&quot;${dtoPersona.getPersonas().size() &gt; 0}&quot;&gt;
                                            &lt;!-- lógica para mostrar el anterior --&gt;
                                            &lt;c:choose&gt;
                                                &lt;c:when test=&quot;${dtoPersona.getPaginaActual() &gt; 1}&quot;&gt;
                                                    &lt;li class=&quot;page-item&quot;&gt;&lt;a class=&quot;page-link&quot;
                                                        href=&quot;/personas/ingresar?pagina=${dtoPersona.getPaginaActual() - 1}&quot;&gt;Anterior&lt;/a&gt;&lt;/li&gt;
                                                &lt;/c:when&gt;
                                                &lt;c:otherwise&gt;
                                                    &lt;li class=&quot;page-item disabled&quot;&gt;&lt;a class=&quot;page-link&quot;
                                                        href=&quot;#&quot;&gt;Anterior&lt;/a&gt;&lt;/li&gt;
                                                &lt;/c:otherwise&gt;
                                            &lt;/c:choose&gt;
                                            &lt;!-- lógica para mostrar el anterior #--&gt;

                                            &lt;!-- Lógica de llenado de números --&gt;
                                            &lt;c:forEach items=&quot;${dtoPersona.getPaginas()}&quot; var=&quot;pagina&quot;&gt;

                                                &lt;!-- Lógica para seleccionar el número de página --&gt;
                                                &lt;c:choose&gt;
                                                    &lt;c:when test=&quot;${dtoPersona.getPaginaActual() == pagina}&quot;&gt;
                                                        &lt;li class=&quot;page-item active&quot;&gt;&lt;a class=&quot;page-link&quot;
                                                            href=&quot;/personas/ingresar?pagina=${pagina}&quot;&gt;${pagina}&lt;/a&gt;&lt;/li&gt;
                                                    &lt;/c:when&gt;
                                                    &lt;c:otherwise&gt;
                                                        &lt;li class=&quot;page-item &quot;&gt;&lt;a class=&quot;page-link&quot;
                                                            href=&quot;/personas/ingresar?pagina=${pagina}&quot;&gt;${pagina}&lt;/a&gt;&lt;/li&gt;
                                                    &lt;/c:otherwise&gt;
                                                &lt;/c:choose&gt;
                                                &lt;!-- Lógica para seleccionar el número de página #--&gt;

                                            &lt;/c:forEach&gt;
                                            &lt;!-- Lógica de llenado de números #--&gt;

                                            &lt;!-- lógica para habilitar el siguiente --&gt;
                                            &lt;c:choose&gt;
                                                &lt;c:when
                                                    test=&quot;${dtoPersona.getPaginas().size() &gt; dtoPersona.getPaginaActual() }&quot;&gt;
                                                    &lt;li class=&quot;page-item&quot;&gt;&lt;a class=&quot;page-link&quot;
                                                        href=&quot;/personas/ingresar?pagina=${dtoPersona.getPaginaActual() + 1}&quot;&gt;Siguiente&lt;/a&gt;&lt;/li&gt;
                                                &lt;/c:when&gt;
                                                &lt;c:otherwise&gt;
                                                    &lt;li class=&quot;page-item disabled&quot;&gt;&lt;a class=&quot;page-link&quot;
                                                        href=&quot;#&quot;&gt;Siguiente&lt;/a&gt;&lt;/li&gt;
                                                &lt;/c:otherwise&gt;
                                            &lt;/c:choose&gt;
                                            &lt;!-- lógica para habilitar el siguiente ##--&gt;

                                        &lt;/c:when&gt;
                                    &lt;/c:choose&gt;
                                &lt;/ul&gt;
                            &lt;/nav&gt;
                        &lt;/c:when&gt;
                    &lt;/c:choose&gt;
                    &lt;!-- PAGINACIÖN #--&gt;
                &lt;/div&gt;

            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;

    &lt;jsp:include page=&quot;../htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h2 id="hito-5-control-de-acceso">Hito 5 - Control de acceso.</h2>
<p>Se implementa un login programático, donde podemos ver como Spring trabaja las sesiones.</p>
<h3 id="archivos-modificados_4">Archivos modificados:</h3>
<pre><code>basedatos.db
pom.xml
src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java
src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java
src/main/java/cl/lherrera/jpaspring/auth/LoginController.java
src/main/java/cl/lherrera/jpaspring/controllers/AplicationController.java
src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java
src/main/java/cl/lherrera/jpaspring/entities/Usuario.java
src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java
src/main/java/cl/lherrera/jpaspring/repositories/UsuarioRepo.java
src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicio.java
src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicioImpl.java
src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java
src/main/java/cl/lherrera/jpaspring/services/UsuarioService.java
src/main/java/cl/lherrera/jpaspring/services/UsuarioServiceImpl.java
src/main/resources/application.properties
src/main/webapp/WEB-INF/pages/auth/login.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/footerTemplate.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/headTemplate.jsp
src/main/webapp/WEB-INF/pages/htmlTemplates/navTemplate.jsp
</code></pre>

<p><code>basedatos.db</code></p>
<p>Este archivo cambia por que los datos cambian así que no se tomará en cuenta el cambio</p>
<h4 id="pomxml_2"><code>pom.xml</code></h4>
<p>Tenemos finalmente la siguiente lista de dependencias:</p>
<ul>
<li>Soporte de archivos <code>jsp</code>: <code>tomcat-embed-jasper</code>, <code>javax.servlet-api</code>.</li>
<li>Soporte a JSTL: <code>jstl</code>.</li>
<li>Soporte SQLITE: <code>sqlite-jdbc</code>.</li>
<li>Soporte herramientas de desarrollo para eclipse: <code>spring-boot-devtools</code>.</li>
<li>Soporte Bootstrap <code>webjars</code>: <code>bootstrap</code>.</li>
<li>Soporte <code>JQuery webjars</code>:  <code>jquery</code>.</li>
<li>Soporte <code>webjars</code> Ubicación de recursos: <code>webjars-locator</code>.</li>
</ul>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.jpaspring&lt;/groupId&gt;
    &lt;artifactId&gt;jpaspring&lt;/artifactId&gt;
    &lt;version&gt;20.0.0&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;jpaspring&lt;/name&gt;
    &lt;description&gt;proyecto JPA SQLITE&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- SOPORTE ARCHIVOS JSP # --&gt;

        &lt;!-- JSTL --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- JSTL # --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- DevsTools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;!-- DevsTools # --&gt;

        &lt;!-- webjars --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;webjars-locator&lt;/artifactId&gt;
            &lt;version&gt;0.30&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;4.3.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;jquery&lt;/artifactId&gt;
            &lt;version&gt;3.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- webjars --&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringjpaspringapplicationjava_1"><code>src/main/java/cl/lherrera/jpaspring/JpaspringApplication.java</code></h4>
<p>Se agrega un método para poder ingresar un usuario de prueba.</p>
<pre><code class="java">package cl.lherrera.jpaspring;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.stereotype.Component;

import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.services.UsuarioServiceImpl;

@SpringBootApplication
public class JpaspringApplication {

    public static void main(String[] args) {
        SpringApplication.run(JpaspringApplication.class, args);
    }

}

/**
 * Este método, realiza acciones antes que la aplicación está en ejecución así,
 * el usuario está ingresado antes de iniciar sesión.
 *
 */
@Component
class SeEjecutaAntes implements CommandLineRunner {

    @Autowired
    UsuarioServiceImpl servicioUsuario;

    @Override
    public void run(String... args) throws Exception {
        // para probar con este usuario al menos
        Usuario usuarioPueba = new Usuario();
        usuarioPueba.setNombre(&quot;Luis herrera&quot;);
        usuarioPueba.setEmail(&quot;l.herrera.garnica@gmail.com&quot;);
        usuarioPueba.setContrasenia(&quot;1234&quot;);

        servicioUsuario.ingresarUsuario(usuarioPueba);
        // para probar con este usuario al menos ##
    }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringsqlitedialectjava_1"><code>src/main/java/cl/lherrera/jpaspring/SQLiteDialect.java</code></h4>
<p>Se repara el final, aunque el que estaba es este mismo que se copia ya que el que estaba antes de este, no permitía ingresar el usuario al principio de la ejecución de la aplicación. Es decir que esta versión probablemente sea la que ya está por que la he puesta esta versión desde el hito 1.</p>
<pre><code class="java">package cl.lherrera.jpaspring;

import java.sql.Types;

import org.hibernate.dialect.Dialect;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.VarArgsSQLFunction;
import org.hibernate.type.StandardBasicTypes;

public class SQLiteDialect extends Dialect {
  public SQLiteDialect() {
    super();
    registerColumnType(Types.BIT, &quot;integer&quot;);
    registerColumnType(Types.TINYINT, &quot;tinyint&quot;);
    registerColumnType(Types.SMALLINT, &quot;smallint&quot;);
    registerColumnType(Types.INTEGER, &quot;integer&quot;);
    registerColumnType(Types.BIGINT, &quot;bigint&quot;);
    registerColumnType(Types.FLOAT, &quot;float&quot;);
    registerColumnType(Types.REAL, &quot;real&quot;);
    registerColumnType(Types.DOUBLE, &quot;double&quot;);
    registerColumnType(Types.NUMERIC, &quot;numeric&quot;);
    registerColumnType(Types.DECIMAL, &quot;decimal&quot;);
    registerColumnType(Types.CHAR, &quot;char&quot;);
    registerColumnType(Types.VARCHAR, &quot;varchar&quot;);
    registerColumnType(Types.LONGVARCHAR, &quot;longvarchar&quot;);
    registerColumnType(Types.DATE, &quot;date&quot;);
    registerColumnType(Types.TIME, &quot;time&quot;);
    registerColumnType(Types.TIMESTAMP, &quot;timestamp&quot;);
    registerColumnType(Types.BINARY, &quot;blob&quot;);
    registerColumnType(Types.VARBINARY, &quot;blob&quot;);
    registerColumnType(Types.LONGVARBINARY, &quot;blob&quot;);
    // registerColumnType(Types.NULL, &quot;null&quot;);
    registerColumnType(Types.BLOB, &quot;blob&quot;);
    registerColumnType(Types.CLOB, &quot;clob&quot;);
    registerColumnType(Types.BOOLEAN, &quot;integer&quot;);

    registerFunction(&quot;concat&quot;, new VarArgsSQLFunction(StandardBasicTypes.STRING, &quot;&quot;,
        &quot;||&quot;, &quot;&quot;));
    registerFunction(&quot;mod&quot;, new SQLFunctionTemplate(StandardBasicTypes.INTEGER,
        &quot;?1 % ?2&quot;));
    registerFunction(&quot;substr&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
    registerFunction(&quot;substring&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
  }

  public boolean supportsIdentityColumns() {
    return true;
  }

  public boolean hasDataTypeInIdentityColumn() {
    return false; // As specify in NHibernate dialect
  }

  public String getIdentityColumnString() {
    // return &quot;integer primary key autoincrement&quot;;
    return &quot;integer&quot;;
  }

  public String getIdentitySelectString() {
    return &quot;select last_insert_rowid()&quot;;
  }

  public boolean supportsLimit() {
    return true;
  }

  public String getLimitString(String query, boolean hasOffset) {
    return new StringBuffer(query.length() + 20).append(query).append(
        hasOffset ? &quot; limit ? offset ?&quot; : &quot; limit ?&quot;).toString();
  }

  public boolean bindLimitParametersInReverseOrder() {
    return true;
  }

  public boolean supportsTemporaryTables() {
    return true;
  }

  public String getCreateTemporaryTableString() {
    return &quot;create temporary table if not exists&quot;;
  }

  public boolean dropTemporaryTableAfterUse() {
    return false;
  }

  public boolean supportsCurrentTimestampSelection() {
    return true;
  }

  public boolean isCurrentTimestampSelectStringCallable() {
    return false;
  }

  public String getCurrentTimestampSelectString() {
    return &quot;select current_timestamp&quot;;
  }

  public boolean supportsUnionAll() {
    return true;
  }

  public boolean hasAlterTable() {
    return false; // As specify in NHibernate dialect
  }

  public boolean dropConstraints() {
    return false;
  }

  public String getAddColumnString() {
    return &quot;add column&quot;;
  }

  public String getForUpdateString() {
    return &quot;&quot;;
  }

  public boolean supportsOuterJoinForUpdate() {
    return false;
  }

  public String getDropForeignKeyString() {
    throw new UnsupportedOperationException(
        &quot;No drop foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddForeignKeyConstraintString(String constraintName,
      String[] foreignKey, String referencedTable, String[] primaryKey,
      boolean referencesPrimaryKey) {
    throw new UnsupportedOperationException(
        &quot;No add foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddPrimaryKeyConstraintString(String constraintName) {
    throw new UnsupportedOperationException(
        &quot;No add primary key syntax supported by SQLiteDialect&quot;);
  }

  public boolean supportsIfExistsBeforeTableName() {
    return true;
  }

  public boolean supportsCascadeDelete() {
    return false;
  }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringauthlogincontrollerjava"><code>src/main/java/cl/lherrera/jpaspring/auth/LoginController.java</code></h4>
<p>Este controlador, será el encargado de organizar las solicitudes referentes al control de acceso.</p>
<pre><code class="java">package cl.lherrera.jpaspring.auth;


import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.services.AutentificacionServicio;

@Controller
@RequestMapping(path = &quot;/auth&quot;)
public class LoginController {
    private static Logger logger = LoggerFactory.getLogger(LoginController.class.getName());

    @Autowired
    AutentificacionServicio servicio;

    @GetMapping(path = &quot;/login&quot;)
    public String login() {

        logger.info(&quot;Llamado a: /auth/login&quot;);
        return &quot;auth/login&quot;;
    }

    @GetMapping(path = &quot;/doLogout&quot;)
    public String doLogout() {
        servicio.sairDelSistema();

        return &quot;auth/login&quot;;
    }

    @PostMapping(path = &quot;/doLogin&quot;)
    public String doLogin(@ModelAttribute Usuario usuario, RedirectAttributes ra) {
        String irHacia = &quot;redirect:/auth/login&quot;;
        if (servicio.estaLogueado()) {
            irHacia = &quot;redirect:/&quot;;
        } else {
            Usuario logueado = servicio.ingresarAlSistema(usuario);

            boolean seRealizaLogueo = logueado != null;

            if (seRealizaLogueo) {
                irHacia = &quot;redirect:/&quot;;
            } else {
                ra.addFlashAttribute(&quot;loginErrorFlash&quot;, &quot;Credenciales inválidas&quot;);
            }
        }
        return irHacia;
    }
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringcontrollersaplicationcontrollerjava"><code>src/main/java/cl/lherrera/jpaspring/controllers/AplicationController.java</code></h4>
<p>Todas las peticiones referentes a la administración de la aplicación, como por ejemplo, ir al <code>index</code> del sitio y no a las funcionalidades que tienen que ver con la manutención de los datos de la persona o usuarios.</p>
<pre><code class="java">package cl.lherrera.jpaspring.controllers;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.services.AutentificacionServicio;
import cl.lherrera.jpaspring.services.PersonaServiceImpl;
import cl.lherrera.jpaspring.services.UsuarioServiceImpl;


@Controller
public class AplicationController {
    private static final Logger logger = LoggerFactory.getLogger(AplicationController.class);

    @Autowired
    AutentificacionServicio authService;

    @Autowired
    PersonaServiceImpl servicioPersona;

    @Autowired
    UsuarioServiceImpl servicioUsuario;

    @GetMapping(&quot;/&quot;)
    public String home(Model modelo) {
        logger.info(&quot;llamada a : '/'&quot;);


        if(!authService.estaLogueado()) {
            return &quot;auth/login&quot;;
        }else {
            Usuario authUsuario = authService.obtenerUsuarioLogeado();
            modelo.addAttribute(&quot;authUsuario&quot;, authUsuario);
        }

        return &quot;index&quot;;
    }

}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringcontrollerspersonacontrollerjava_1"><code>src/main/java/cl/lherrera/jpaspring/controllers/PersonaController.java</code></h4>
<p>Se encarga de controlar todas las interacciones que tengan que ver con la manutención de los datos de las personas como por ejemplo el <code>CRUD</code>.</p>
<pre><code class="java">package cl.lherrera.jpaspring.controllers;


import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import cl.lherrera.jpaspring.dtos.PersonaDTO;
import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.services.AutentificacionServicio;
import cl.lherrera.jpaspring.services.PersonaService;

@Controller
@RequestMapping(&quot;/personas&quot;)
public class PersonaController {
    private static final Logger logger = LoggerFactory.getLogger(PersonaController.class);
    private static final Integer FILAS_POR_PAGINA = 3;

    @Autowired
    PersonaService servicio;

    @Autowired
    AutentificacionServicio authService;

    @GetMapping(&quot;/ingresar&quot;)
    @ResponseStatus(code = HttpStatus.OK)
    public String inicio(
            Model modelo, 
            @RequestParam(required = false) Integer pagina) {
        logger.info(&quot;Petición: /personas/ingresar&quot;);

        // controlando el acceso 
        if(!authService.estaLogueado()) {
            return &quot;auth/login&quot;;
        }else {
            Usuario authUsuario = authService.obtenerUsuarioLogeado();
            modelo.addAttribute(&quot;authUsuario&quot;, authUsuario);
        }
        // controlando el acceso ##

        // si no viene la página, se simula la primera, el método PageRequest.of(pagina
        // pide que la primera sea cero; pero esto es manejado por el servicio
        // en el controlador sabemos que la primera página es la 1, si esto no es
        // así, el servicio lo debe manejar
        if(pagina == null)
            pagina = 1;

        PersonaDTO dtoPersona = servicio.obtenerPersonasPaginadas(pagina, FILAS_POR_PAGINA);

        modelo.addAttribute(&quot;dtoPersona&quot;, dtoPersona);
        // si no hay más de una página, no es necesario paginar
        modelo.addAttribute(&quot;paginar&quot;, dtoPersona.getPaginas().size() &gt; 1);
        return &quot;personas/personas&quot;;
    }

//  @ResponseStatus(code = HttpStatus.CREATED) // con esto no funciona el redirect
    @PostMapping(&quot;/ingresar&quot;)
    public String ingresar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String nombre, 
            RedirectAttributes attributes) {
        logger.info(&quot;Petición post /ingresar&quot;);

        // sin usar el retorno aún
        Persona respuesta = servicio.IngresarPersona(persona);

        if(respuesta == null) 
            logger.error(&quot;error en ingreso de persona&quot;);


        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/actualizar&quot;)
    public String actualizar(
            Model modelo, 
            @RequestParam String id) {
        logger.info(&quot;Petición-GET: /actualizar&quot;);

        // controlando el acceso 
        if(!authService.estaLogueado()) {
            return &quot;auth/login&quot;;
        }else {
            Usuario authUsuario = authService.obtenerUsuarioLogeado();
            modelo.addAttribute(&quot;authUsuario&quot;, authUsuario);
        }
        // controlando el acceso ##

        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/actualizar&quot;;
    }

    // el formulario debe estar completo con los names, para que lo
    // reconozca como la misma entidad y no una nueva
    @PostMapping(&quot;/actualizar&quot;)
    public String doActualizar(@ModelAttribute(&quot;foo&quot;) Persona persona) {
        logger.info(&quot;Petición-POST: /actualizar&quot;);
        servicio.actualizarPersona(persona);
        return &quot;redirect:ingresar&quot;;
    }

    @GetMapping(&quot;/eliminar&quot;)
    public String eliminar(
            Model modelo, 
            @RequestParam String id) {
        // controlando el acceso 
        if(!authService.estaLogueado()) {
            return &quot;auth/login&quot;;
        }else {
            Usuario authUsuario = authService.obtenerUsuarioLogeado();
            modelo.addAttribute(&quot;authUsuario&quot;, authUsuario);
        }
        // controlando el acceso ##
        logger.info(&quot;Petición-GET: /eliminar&quot;);
        Persona persona = servicio.encontrarPersona(Integer.parseInt(id));
        modelo.addAttribute(&quot;persona&quot;, persona);

        return &quot;personas/eliminar&quot;;
    }

    @PostMapping(&quot;/eliminar&quot;)
    public String doEliminar(
            @ModelAttribute(&quot;foo&quot;) Persona persona,
            @RequestParam String id) {
        logger.info(&quot;Petición-POST: /eliminar&quot;);
        Persona respuesta = servicio.eliminarPersona(persona);
        if(respuesta == null)
            logger.info(&quot;Petición-POST: /eliminar&quot;);    

        return &quot;redirect:ingresar&quot;;
    }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringentitiesusuariojava"><code>src/main/java/cl/lherrera/jpaspring/entities/Usuario.java</code></h4>
<p>Podemos utilizar la potencia del paradigma OO, para poder modelar los datos de la aplicación, podemos tratar a una persona como un usuario y que sea administrado en la misma tabla. El usuario está orientado a la administración del sitio como el inicio de sesión. Las personas son una funcionalidad independiente a pesar de diferir en la base de datos, en la aplicación esto puede variar.</p>
<pre><code class="java">package cl.lherrera.jpaspring.entities;

import javax.persistence.Entity;
import javax.persistence.Table;

@Entity
@Table(name=&quot;persona&quot;)
public class Usuario extends Persona {
    private String email;
    private String contrasenia;

    public Usuario() {}

    public Usuario(Integer id, String nombre, String email, String contrasenia) {
        super(id, nombre);
        this.email = email;
        this.contrasenia = contrasenia;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getContrasenia() {
        return contrasenia;
    }

    public void setContrasenia(String contrasenia) {
        this.contrasenia = contrasenia;
    }

    @Override
    public String toString() {
        return &quot;Usuario [email=&quot; + email + &quot;, contrasenia=&quot; + contrasenia + &quot;]&quot;;
    }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringrepositoriespersonarepojava_1"><code>src/main/java/cl/lherrera/jpaspring/repositories/PersonaRepo.java</code></h4>
<p>Solo quitamos la dependencia de <code>CrudRepository</code>.</p>
<pre><code class="java">package cl.lherrera.jpaspring.repositories;

import java.util.List;

import org.springframework.context.annotation.Primary;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.PagingAndSortingRepository;

import cl.lherrera.jpaspring.entities.Persona;

// la herencia de beans con hilos seguros
@Primary
public interface PersonaRepo 
    extends JpaRepository&lt;Persona, Integer&gt;,
        PagingAndSortingRepository&lt;Persona, Integer&gt; {

    /**
     * Se puede parecer mucho a una consulta en la base de datos pero es una
     * consulta al modelo, la respuesta es un @Entity. por eso la &quot;tabla&quot; está en
     * mayúsculas.
     * 
     * Eso es debido a que no renemos un PersonaRepoImpl que maneje la
     * personalización de esta consulta y como la original delete, retorna void no
     * es muy buena para hacer test ya que no tenemos contra qué validar si
     * simulamos la base de datos. 
     * 
     * En el fondo es solamente un deleteById(), pero se expone para su ejemplo
     * Que podemos aplicar queries a las entidades.
     * 
     */
    @Modifying
    @Query(&quot;DELETE FROM Persona WHERE id = ?1&quot;)
    Integer myDeleteById(Integer id);

    // no posee un nombre personalizado, cumple con la nomenclatura find
    // debe ir aunque siga la nomenclatura
    List&lt;Persona&gt; findAllByNombre(String nombre);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringrepositoriesusuariorepojava"><code>src/main/java/cl/lherrera/jpaspring/repositories/UsuarioRepo.java</code></h4>
<p>Vemos la ventaja del uso de la orientación de objetos, ya que esta interfaz es implementada por <code>spring</code>, entonces ya que los nombres como <code>findAll()</code> son genéricos, no como <code>encontrarPersna</code>, podemos extender la funcionalidad.</p>
<p>No hay que olvidar la anotación <code>@Primary</code> en el <code>bean</code> principal. <a href="https://www.baeldung.com/spring-primary">https://www.baeldung.com/spring-primary</a>.</p>
<pre><code class="java">package cl.lherrera.jpaspring.repositories;

import java.util.Optional;

import cl.lherrera.jpaspring.entities.Usuario;

public interface UsuarioRepo extends PersonaRepo{

    Optional&lt;Usuario&gt; findOneByEmailAndContrasenia(String email, String contrasenia);

}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicesautentificacionserviciojava"><code>src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicio.java</code></h4>
<p>Servicios encargados de la autenticación. </p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import cl.lherrera.jpaspring.entities.Usuario;

public interface AutentificacionServicio {

    Boolean estaLogueado();

    Usuario obtenerUsuarioLogeado();

    Usuario ingresarAlSistema(Usuario usuario);

    void sairDelSistema();
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicesautentificacionservicioimpljava"><code>src/main/java/cl/lherrera/jpaspring/services/AutentificacionServicioImpl.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.context.annotation.SessionScope;

import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.repositories.UsuarioRepo;


@Service
@SessionScope
public class AutentificacionServicioImpl implements AutentificacionServicio {

    @Autowired
    private UsuarioRepo usuarioRepo;

    private Usuario usuarioAutent;

    @Override
    public Boolean estaLogueado() {
        return usuarioAutent != null;
    }

    @Override
    public Usuario obtenerUsuarioLogeado() {
        return usuarioAutent;
    }

    @Override
    public Usuario ingresarAlSistema(Usuario usuario) {
        usuarioAutent = usuarioRepo.findOneByEmailAndContrasenia(
            usuario.getEmail(), 
            usuario.getContrasenia())
        .orElse(null);

        return usuarioAutent;
    }

    @Override
    public void sairDelSistema() {
        usuarioAutent = null;
    }
}
</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicespersonaserviceimpljava_1"><code>src/main/java/cl/lherrera/jpaspring/services/PersonaServiceImpl.java</code></h4>
<p>Simple reparación.</p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import cl.lherrera.jpaspring.dtos.PersonaDTO;
import cl.lherrera.jpaspring.entities.Persona;
import cl.lherrera.jpaspring.repositories.PersonaRepo;


@Service
//@Primary // util solamente si tenemos más servicios que implementan PersonaService.
public class PersonaServiceImpl implements PersonaService{
    private static final Logger logger = LoggerFactory.getLogger(PersonaServiceImpl.class.getName());

    @Autowired
    PersonaRepo repo;


    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonas() {
        return (List&lt;Persona&gt;) repo.findAll();
    }

    @Override
    @Transactional(readOnly = true)
    public List&lt;Persona&gt; obtenerPersonasPorNombre(String nombre) {

        return repo.findAllByNombre(nombre);
    }

    @Override
    @Transactional(readOnly = true)
    public Persona encontrarPersona(Integer id) {
        // así nos evitamos un null pointer exception
        return repo.findById(id).orElse(new Persona());
    }

    @Override
    @Transactional
    public Persona eliminarPersona(Persona persona) {
        int filasAfectadas = repo.myDeleteById(persona.getId());
        if(!(filasAfectadas &gt; 0)) {
            logger.info(&quot;Error al eliminal persona: &quot; + persona.toString());
        }
        return persona;
    }

    @Override
    @Transactional
    public Persona actualizarPersona(Persona persona) {
        return repo.save(persona);
    }

    @Override
    @Transactional
    public Persona IngresarPersona(Persona persona) {       
        return repo.save(persona);
    }

    @Override
    public PersonaDTO obtenerPersonasPaginadas(Integer pagina, Integer cantidad) {
        logger.info(&quot;Num Pagina: &quot; + pagina);
        PersonaDTO personaDTO = new PersonaDTO();
        // comienza en cero, para que con la página 1
        // busque en la página 0 y lo retorne como página 1.


        Pageable paginado = PageRequest.of(pagina - 1, 2, Sort.by(&quot;id&quot;).ascending());
        // consulta a la base
        Page&lt;Persona&gt; personaPaginas = repo.findAll(paginado);

        logger.info(personaPaginas.getContent().toString());

        // ingreso de personas al DTO
        personaDTO.setPersonas(personaPaginas.getContent());
        // ingresamos el número de página actual
        // el getNumber nos entrega un cero en caso de ser la primera página
        // el argumento pagina, viene desde el front con el click
        // que se hace y llegará fielmente el verdadero número a buscar
        // el único aproblemado con esto es el PageRequest.of(pagina... ya que
        // él busca por el número consultado menos uno.
        personaDTO.setPaginaActual(pagina);
        // llenamos la lista de números del paginador
        List&lt;Integer&gt; paginas = new ArrayList&lt;&gt;();
        for(int i = 0; i &lt; personaPaginas.getTotalPages(); i ++)
            paginas.add(i + 1);

        personaDTO.setPaginas(paginas);
        logger.info(&quot;personaDTO: &quot; + personaDTO.toString());
        return personaDTO;
    }


}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicesusuarioservicejava"><code>src/main/java/cl/lherrera/jpaspring/services/UsuarioService.java</code></h4>
<p>El servicio es personalizado, por que son con nomenclaturas específicas del propio servicio.</p>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import cl.lherrera.jpaspring.entities.Usuario;

public interface UsuarioService {
    void ingresarUsuario(Usuario usuario);
}

</code></pre>

<h4 id="srcmainjavacllherrerajpaspringservicesusuarioserviceimpljava"><code>src/main/java/cl/lherrera/jpaspring/services/UsuarioServiceImpl.java</code></h4>
<pre><code class="java">package cl.lherrera.jpaspring.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import cl.lherrera.jpaspring.entities.Usuario;
import cl.lherrera.jpaspring.repositories.UsuarioRepo;

@Service
public class UsuarioServiceImpl implements UsuarioService {
    @Autowired
    UsuarioRepo repo;

    @Override
    public void ingresarUsuario(Usuario usuario) {
        repo.save(usuario);
    }
}

</code></pre>

<h4 id="srcmainresourcesapplicationproperties_1"><code>src/main/resources/application.properties</code></h4>
<pre><code class="conf"># Configuración para la vista. (http://localhost:8080/) no es (http://localhost:8080/jpaspring/)
# Eso es para un servlet
spring.mvc.view.prefix=/WEB-INF/pages/
spring.mvc.view.suffix=.jsp
# Permiso para clear el ddl de las entidades
spring.jpa.generate-ddl=true
# Ejecuta la configuración de la clase que mapea los tipos de datos.
spring.jpa.database-platform=cl.lherrera.jpaspring.SQLiteDialect
# Crea la base si no está y cuando finaliza la ejecución la borra.
spring.jpa.hibernate.ddl-auto=create-drop
# Muestra las consultas realizadas por el framework y las imprime en el log
spring.jpa.show-sql=true
# Le da un formáto legible por un humano para una mejor depuración en el log.
spring.jpa.properties.hibernate.format_sql=true

#Pruebas
#logging.level.org.hibernate.SQL=debug
#logging.level.org.hibernate.type.descriptor.sql=trace

</code></pre>

<h4 id="srcmainwebappweb-infpagesauthloginjsp"><code>src/main/webapp/WEB-INF/pages/auth/login.jsp</code></h4>
<p>Podemos ver como interactúan los mensajes del tipo <code>flash</code> y que una vez enviado desde un método <code>redireccionado</code>, no hay necesidad de <code>reemitirlo</code> a la vista, por que ya viene con <code>RedirectAttributes</code>.</p>
<pre><code class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; prefix=&quot;fn&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;jsp:include page=&quot;../htmlTemplates/headTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;body&gt;
    &lt;div class=&quot;container my-5&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;
            &lt;div class=&quot;col&quot;&gt;

                &lt;!-- Mensaje flash de control de acceso --&gt;
                &lt;div class=&quot;card&quot; style=&quot;width: 18rem;&quot;&gt;


                    &lt;!-- Mensaje flash de control de acceso --&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test=&quot;${loginErrorFlash != null}&quot;&gt;

                            &lt;div class=&quot;alert alert-danger alert-dismissible fade show&quot;
                                role=&quot;alert&quot;&gt;
                                &lt;strong&gt;Error de acceso: &lt;/strong&gt; ${loginErrorFlash}
                                &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot;
                                    aria-label=&quot;Close&quot;&gt;
                                    &lt;span aria-hidden=&quot;true&quot;&gt;&amp;times;&lt;/span&gt;
                                &lt;/button&gt;
                            &lt;/div&gt;

                        &lt;/c:when&gt;
                    &lt;/c:choose&gt;


                    &lt;!-- Mensaje flash de control de acceso ##--&gt;

                    &lt;div class=&quot;card-body&quot;&gt;
                        &lt;h5 class=&quot;card-title&quot;&gt;Ingreso al sistema&lt;/h5&gt;

                        &lt;!-- Formunarioi de login --&gt;
                        &lt;form:form class=&quot;form-horizontal&quot; method=&quot;post&quot; action=&quot;/auth/doLogin&quot; modelAttribute=&quot;Usuario&quot;&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label for=&quot;email&quot;&gt;Correo electrónicos&lt;/label&gt; &lt;input
                                    type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;email&quot; name=&quot;email&quot;
                                    aria-describedby=&quot;emailHelp&quot;&gt; &lt;small id=&quot;emailHelp&quot;
                                    class=&quot;form-text text-muted&quot;&gt;No compartimos tú información
                                    con nadie.&lt;/small&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label for=&quot;contrasenia&quot;&gt;Contraseña&lt;/label&gt; &lt;input
                                    type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;contrasenia&quot; name=&quot;contrasenia&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;form-group form-check&quot;&gt;
                                &lt;input type=&quot;checkbox&quot; class=&quot;form-check-input&quot;
                                    id=&quot;exampleCheck1&quot;&gt; &lt;label class=&quot;form-check-label&quot;
                                    for=&quot;exampleCheck1&quot;&gt;Recordar usuario&lt;/label&gt;
                            &lt;/div&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Ingresar&lt;/button&gt;
                        &lt;/form:form&gt;
                        &lt;!-- Formunarioi de login #--&gt;
                    &lt;/div&gt;
                &lt;/div&gt;

            &lt;/div&gt;
            &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;jsp:include page=&quot;../htmlTemplates/footerTemplate.jsp&quot;&gt;&lt;/jsp:include&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h4 id="srcmainwebappweb-infpageshtmltemplatesfootertemplatejsp"><code>src/main/webapp/WEB-INF/pages/htmlTemplates/footerTemplate.jsp</code></h4>
<p>Código comentado, ya que para <code>web-jars</code> debe estar cargado <code>jquery</code> antes. Es por esa razón que los códigos <code>js</code> no irán en el <code>footer</code>.</p>
<pre><code class="html">&lt;footer&gt;




    &lt;!-- bootstrap 4 --&gt;
&lt;!--     &lt;script src=&quot;https://code.jquery.com/jquery-3.4.1.slim.min.js&quot; --&gt;
&lt;!--         integrity=&quot;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&quot; --&gt;
&lt;!--         crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;
&lt;!--     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&quot; --&gt;
&lt;!--         integrity=&quot;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&quot; --&gt;
&lt;!--         crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;
&lt;!--     &lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&quot; --&gt;
&lt;!--         integrity=&quot;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&quot; --&gt;
&lt;!--         crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;
    &lt;!-- bootstrap #--&gt;
&lt;/footer&gt;
</code></pre>

<h4 id="srcmainwebappweb-infpageshtmltemplatesheadtemplatejsp"><code>src/main/webapp/WEB-INF/pages/htmlTemplates/headTemplate.jsp</code></h4>
<p>Integración de la vista con <code>webjars</code>, se comenta el <code>CDN</code>, se pueden ver estas dependencias en <code>maven dependencies</code>, dentro estarán las carpetas con las versiones en caso de no saber cual se ha descargado.</p>
<pre><code class="html">&lt;!-- Este template, está diseñado para mantener la cabecera del sitio --&gt;
&lt;!-- unificada en una sola, ya que la comparten. --&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;FPA-EJEMPLO&lt;/title&gt;
    &lt;!-- cdn bootstrap 4 --&gt;
&lt;!--     &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot; --&gt;
&lt;!--         integrity=&quot;sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh&quot; crossorigin=&quot;anonymous&quot;&gt; --&gt;
        &lt;!-- cdn bootstrap 4 #--&gt;
    &lt;script src=&quot;/webjars/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/webjars/bootstrap/4.3.0/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/webjars/bootstrap/4.3.0/css/bootstrap.min.css&quot; /&gt;
&lt;/head&gt;

</code></pre>

<h4 id="srcmainwebappweb-infpageshtmltemplatesnavtemplatejsp"><code>src/main/webapp/WEB-INF/pages/htmlTemplates/navTemplate.jsp</code></h4>
<p>Se puede ver que podemos disponer de la información del usuario conectado, guardado en la sesión, mediante el mecanismo de <code>scope</code> que el servidor trabajará mediante la conexión de cada usuario. <code>Bienvenido - &lt;strong&gt;${authUsuario.getNombre()}&lt;/strong&gt;</code>.</p>
<pre><code class="html">&lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-light&quot;&gt;
    &lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;JPA-EJEMPLO&lt;/a&gt;
    &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbarSupportedContent&quot;
        aria-controls=&quot;navbarSupportedContent&quot; aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;
        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
    &lt;/button&gt;

    &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarSupportedContent&quot;&gt;
        &lt;ul class=&quot;navbar-nav ml-auto&quot;&gt;
            &lt;!-- Home --&gt;
            &lt;li class=&quot;nav-item active&quot;&gt;&lt;a class=&quot;nav-link&quot; href=&quot;/&quot;&gt;Home
                    &lt;span class=&quot;sr-only&quot;&gt;(current)&lt;/span&gt;
                &lt;/a&gt;&lt;/li&gt;
            &lt;!-- Home #--&gt;
            &lt;li class=&quot;nav-item dropdown&quot;&gt;
                &lt;a class=&quot;nav-link dropdown-toggle&quot; href=&quot;#&quot; id=&quot;navbarDropdown&quot; role=&quot;button&quot; data-toggle=&quot;dropdown&quot;
                    aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt; Mantenedor de personas &lt;/a&gt;
                &lt;div class=&quot;dropdown-menu&quot; aria-labelledby=&quot;navbarDropdown&quot;&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;/personas/ingresar&quot;&gt;Ingresar&lt;/a&gt;
                &lt;/div&gt;
            &lt;/li&gt;
            &lt;!-- Usuario conectado --&gt;
            &lt;li class=&quot;nav-item dropdown ml-5&quot;&gt;&lt;a
                class=&quot;nav-link dropdown-toggle&quot; href=&quot;#&quot; id=&quot;navbarDropdown&quot;
                role=&quot;button&quot; data-toggle=&quot;dropdown&quot; aria-haspopup=&quot;true&quot;
                aria-expanded=&quot;false&quot;&gt; Bienvenido - &lt;strong&gt;${authUsuario.getNombre()}&lt;/strong&gt; &lt;/a&gt;
                &lt;div class=&quot;dropdown-menu&quot; aria-labelledby=&quot;navbarDropdown&quot;&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Personalizar datos - (tarea)&lt;/a&gt;
                    &lt;div class=&quot;dropdown-divider&quot;&gt;&lt;/div&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;/auth/doLogout&quot;&gt;Cerrar sesión&lt;/a&gt;
                &lt;/div&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/nav&gt;
</code></pre>

<h2 id="ddl-de-prueba">DDL DE PRUEBA</h2>
<pre><code class="sql">delete from persona;

select * from persona;

INSERT into persona values (1, &quot;Uno&quot;);
INSERT into persona values (2, &quot;Dos&quot;);
INSERT into persona values (3, &quot;Tres&quot;);
INSERT into persona values (4, &quot;Cuatro&quot;);
INSERT into persona values (5, &quot;Cinco&quot;);
INSERT into persona values (6, &quot;Seis&quot;);
INSERT into persona values (7, &quot;Siete&quot;);
INSERT into persona values (9, &quot;Ocho&quot;);
INSERT into persona values (10, &quot;Nueve&quot;);
INSERT into persona values (11, &quot;Diez&quot;);
INSERT into persona values (12, &quot;Once&quot;);
INSERT into persona values (13, &quot;Doce&quot;);
INSERT into persona values (14, &quot;Trece&quot;);
INSERT into persona values (15, &quot;Catorce&quot;);
INSERT into persona values (16, &quot;Quince&quot;);
INSERT into persona values (17, &quot;Dieciseis&quot;);
INSERT into persona values (18, &quot;Diecisiete&quot;);

-- después de ingresar usuario
INSERT into persona values (&quot;Usuario&quot;, 19, &quot;Luis herrera&quot;, &quot;1234&quot;, &quot;l.herrera.garnica@gmail.com&quot;);

select
        persona0_.id as id1_0_,
        persona0_.nombre as nombre2_0_ 
    from
        persona persona0_ limit 3 offset 9;


select
        persona0_.id as id1_0_,
        persona0_.nombre as nombre2_0_ 
    from
        persona persona0_ limit 3 offset 4;

select
        persona0_.id as id1_0_,
        persona0_.nombre as nombre2_0_ 
    from
        persona persona0_ 
    order by
        persona0_.id asc limit ? offset ?       

</code></pre>

<h2 id="todo">TODO</h2>
<p>Realizar el mantenedor de usuarios. (registro el sistema).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Lectura002 - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unidad-52-seguridad" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Lectura002
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../ejercicios/repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#521-aplicacion-lectura-gs-spring-security" class="md-nav__link">
    5.2.1 Aplicación lectura - gs-spring-security
  </a>
  
    <nav class="md-nav" aria-label="5.2.1 Aplicación lectura - gs-spring-security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cllherreragsss" class="md-nav__link">
    cl.lherrera.gsss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragsssconfig" class="md-nav__link">
    cl.lherrera.gsss.config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragssscontroller" class="md-nav__link">
    cl.lherrera.gsss.controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragssscontrolleradmin" class="md-nav__link">
    cl.lherrera.gsss.controller.admin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragssscontrolleruser" class="md-nav__link">
    cl.lherrera.gsss.controller.user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragsssdto" class="md-nav__link">
    cl.lherrera.gsss.dto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragsssmapper" class="md-nav__link">
    cl.lherrera.gsss.mapper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragsssmodel" class="md-nav__link">
    cl.lherrera.gsss.model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreragsssservice" class="md-nav__link">
    cl.lherrera.gsss.service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcesdbmigrations" class="md-nav__link">
    /gs-spring-security/src/main/resources/db/migrations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcesdbseeds" class="md-nav__link">
    /gs-spring-security/src/main/resources/db/seeds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcestemplatesadmin" class="md-nav__link">
    /gs-spring-security/src/main/resources/templates/admin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcestemplateserror" class="md-nav__link">
    /gs-spring-security/src/main/resources/templates/error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcestemplatesuser" class="md-nav__link">
    /gs-spring-security/src/main/resources/templates/user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitysrcmainresourcestemplates" class="md-nav__link">
    /gs-spring-security/src/main/resources/templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gs-spring-securitypomxml" class="md-nav__link">
    /gs-spring-security/pom.xml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#522-todo-0010" class="md-nav__link">
    5.2.2 TODO - 0010
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <blockquote>
<h1 id="unidad-52-seguridad">Unidad 5.2 - Seguridad.</h1>
<blockquote>
<p>Aplica a lo aprendido en la lectura anterior, el uso de un motor de base de datos, para obtener la información de los usuarios y sus roles a validar.</p>
</blockquote>
</blockquote>
<hr />
<h2 id="521-aplicacion-lectura-gs-spring-security"><strong>5.2.1 Aplicación lectura - <code>gs-spring-security</code></strong></h2>
<ul>
<li>
<p>Ojo con los nombres de los archivos <code>.sql</code>, o cualquiera que se llame en las propiedades, ya que se puede escapar un espacio y el error no es muy claro al mostrarnos el detalle, por lo tanto todos los archivos nombrados en las propiedades, deben estar muy clara y cuidadosamente escritos.</p>
</li>
<li>
<p>El <code>classpath</code>, en las propiedades apunta a la carpeta <code>resources</code>, desde allí partimos.</p>
</li>
<li>
<p>Al momento de usar <code>H2</code>, hay que cambiar <code>USER</code> por <code>ROLE_USER</code> para que sea reconocido por el <code>configurador</code> y por el <code>manejador de acceso correcto</code>, el que <code>redireciona</code>.</p>
</li>
</ul>
<h3 id="cllherreragsss"><strong><code>cl.lherrera.gsss</code></strong></h3>
<p>Este paquete contiene las clases que se generan solas en <code>Spring</code>, este código no posee intervenciones personalizadas para la aplicación.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/GsSpringSecurityApplication.java</code></p>
<p>Clase sin cambios es la que viene por defecto en una generación de aplicación con <code>Spring</code>.</p>
<pre><code class="java">package cl.lherrera.gsss;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class GsSpringSecurityApplication {

    public static void main(String[] args) {
        SpringApplication.run(GsSpringSecurityApplication.class, args);
    }

}

</code></pre>

<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/ServletInitializer.java</code></p>
<p>Apartado que se genera en el caso que queramos que nuestra aplicación empaquete su despliegue en un <code>war</code>.</p>
<pre><code class="java">package cl.lherrera.gsss;

import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;

public class ServletInitializer extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(GsSpringSecurityApplication.class);
    }
}
</code></pre>

<h3 id="cllherreragsssconfig"><strong><code>cl.lherrera.gsss.config</code></strong></h3>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/config/CustomAuthenticationSuccessHandler.java</code></p>
<p>En el momento de realizar un inicio de sesión, es decir cuando el formulario es aceptado, podemos personalizar el comportamiento que se tendrá, por ejemplo que usuarios según su rol sean re-dirigidos a sus respectivas rutas. para evitar un trabajo extra de acceso a sus funcionalidades por perfil. Estos segundos de ahorro de tiempo es una suma por todos los usuarios y por todo el tiempo que dure la aplicación, aumentando la productividad que, es una de las principales justificaciones de las tecnologías de la información.</p>
<p>Hay que tener en consideración que una aplicación <code>mvc</code> no se comporta con un <code>bffe</code>, en esta arquitectura, no necesitamos enviar a un usuario a una ventana informativa en caso de error, solamente nos limitamos a responder un <code>json</code> indicando el código de error y la re dirección corre por parte de los desarrolladores del <code>frontEnd</code>. En la arquitectura <code>MVC</code> debemos nosotros controlar estas situaciones configurando clases como las que se muestra a continuación.</p>
<pre><code class="java">package cl.lherrera.gsss.config;

import java.io.IOException;
import java.util.Set;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.authority.AuthorityUtils;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;

@Configuration
public class CustomAuthenticationSuccessHandler implements AuthenticationSuccessHandler {
    private static Logger logger = LoggerFactory.getLogger(CustomAuthenticationSuccessHandler.class);


    @Override
    public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse,
            Authentication authentication) throws IOException, ServletException {
        Set&lt;String&gt; roles = AuthorityUtils.authorityListToSet(authentication.getAuthorities());

        logger.info(&quot;manejador redirección personal roles: &quot; + roles.toString());
        if (roles.contains(&quot;ROLE_ADMIN&quot;)) {
            httpServletResponse.sendRedirect(&quot;/admin&quot;);
        } else {
            httpServletResponse.sendRedirect(&quot;/user&quot;);
        }
    }
}

</code></pre>

<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/config/WebSecurityConfig.java</code></p>
<p>Java, y en realidad el servidor, en nuestro caso <code>Apache Tomcat</code>, posee formas de administrar el ingreso al sistema de una forma muy segura, con implementaciones que se rigen a fuertes protocolos de seguridad en cuanto al cifrado y transporte de la información de las credenciales y cuidado de las demás peticiones que se realicen al sitio en el que estamos trabajando. Estos métodos de inicio de sesión van más allá de crear un formulario que busque si el usuario existe puede entrar como lo que haríamos rápidamente si queremos un control de acceso.</p>
<p>Para facilitar esta tarea, existen ya estrategias de seguridad que poseen sus propias implementaciones integradas a los servidores, ya que son ellos quienes trabajan las peticiones y respuestas usando nuestras implementaciones, pero usando sus propias formas de control. Estas formas son: </p>
<ul>
<li><code>Declarative Security</code></li>
<li><code>Programmatic Security</code></li>
</ul>
<p>En la primera se declaran usuarios, contraseñas y roles en algún lugar (a priori en la configuración del servidor), puede ser alguna plataforma que posea contraseñas como el inicio de sesión en el propio computador o un grupo de usuarios en un <code>active directory</code> por ejemplo donde nosotros sabemos y controlamos las credenciales para luego utilizarlas. </p>
<p>La segunda opción es poder hacer que nuestro propio sistema administre esta tarea. Ya que el control de los accesos y las ventanas de inicio o registro de usuarios sea administrada por nosotros.</p>
<p>Cada una de estas opciones requiere mucha configuración ya sea en el propio servidor (al que usualmente no tenemos acceso), es por este motivo que <code>Spring</code> nos brinda herramientas como <code>Spring security</code>, ya que permite estas configuraciones de forma mucho más sencilla que si la hiciéramos de forma manual, y con un estilo funcional exquisito, que nos permite ahorrarnos muchas horas de configuraciones. Utilizando <code>FORM-BASED AUTHENTICATION</code> tenemos una herramienta que no solamente permite administrar el ingreso al sistema bajo credenciales, si no que además podemos personalizar su comportamiento según sean nuestras necesidades, como por ejemplo una ventana de inicio de sesión personalizada, lo mismo que para en caso de una respuesta más usable, además de personalizar accesos según roles entre otras funcionalidades. </p>
<p>Sin el <code>manejador</code>, podemos ver que ingresamos en memoria sin usar la base de datos. Al momento de ingresar <code>roles("ADMIN");</code>, este a diferencia de cuando lo hacemos en la base de datos lo guarda como <code>ROLE_ADMIN</code>. Hay que tener ojo con esto, pero el proyecto tiene la historia en <code>git</code>.</p>
<pre><code>    /**
     * Sobreescribir este método, permite habilitar 
     * la autenticación en memoria, además de poder definir credenciales.
     */
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        String usuario = &quot;foo&quot;;
        String contrasenia =  passwordEncoder().encode(&quot;bar&quot;);

        auth.inMemoryAuthentication()
            .withUser(usuario)
            .password(contrasenia)
            .roles(&quot;ADMIN&quot;);
    }

</code></pre>

<pre><code class="java">package cl.lherrera.gsss.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired 
    private UserDetailsService userDetailsService;

    private AuthenticationSuccessHandler authenticationSuccessHandler;

    @Autowired
    public WebSecurityConfig(AuthenticationSuccessHandler authenticationSuccessHandler) {
        this.authenticationSuccessHandler = authenticationSuccessHandler;
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder() );
    }

    /*
     * Dejamos la aplicación distribuídos en direcctorios para poder restringir por
     * medio de estos direcctorios y le damos acceso según su rol.
     */
    @Override
    public void configure(HttpSecurity http) throws Exception {
        http.csrf().disable()
            .authorizeRequests()
                .antMatchers(&quot;/admin/**&quot;).hasAuthority(&quot;ROLE_ADMIN&quot;)
                .antMatchers(&quot;/user/**&quot;).hasAuthority(&quot;ROLE_USER&quot;)
                .antMatchers(&quot;/login&quot;).permitAll()
                // incluyendo el main
                .anyRequest().authenticated()

                .and()
                .formLogin()
                .loginPage(&quot;/login&quot;)
                .successHandler(authenticationSuccessHandler)// esto es lo nuevo
                .failureUrl(&quot;/login?error=true&quot;).usernameParameter(&quot;email&quot;).passwordParameter(&quot;password&quot;)
                // página por defecto en caso de éxito en el inicio de sesión.
                // se comenta para que no interfirera con la redirección
//              .defaultSuccessUrl(&quot;/user&quot;)

                .and()

                .exceptionHandling().accessDeniedPage(&quot;/recurso-prohibido&quot;);
    }

    /**
     * Así inicializamos el encoder.
     */
    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}

</code></pre>

<h3 id="cllherreragssscontroller"><strong><code>cl.lherrera.gsss.controller</code></strong></h3>
<p>Estas clases manejan las rutas que ejecutan los servicios de la aplicación, Esta es la interfaz de comunicación.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/controller/ErrorController.java</code></p>
<p>Maneja la petición de la vista cuando no tenemos acceso al recurso, en este caso cuando no sea el rol correcto que quiera cargar un recurso restringido se arroja un error 403, lo que hará será <code>redireccionar</code> a una vista personalizada para atención del usuario, permitiendo agregar lógica en caso que se requiera almacenar estos intentos por ejemplo lo podríamos hacer.</p>
<pre><code class="java">package cl.lherrera.gsss.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class ErrorController {

    @GetMapping(&quot;/recurso-prohibido&quot;)
    public String recurso03() {
        return &quot;error/403&quot;;
    }
}

</code></pre>

<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/controller/HomeController.java</code></p>
<p>Solamente sirve para cargar la página principal.</p>
<pre><code class="java">package cl.lherrera.gsss.controller;

import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HomeController {

    @GetMapping(path = { &quot;&quot;, &quot;/&quot; })
    public String home(HttpSession session) {
        return &quot;home&quot;;
    }
}
</code></pre>

<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/controller/LoginController.java</code></p>
<p>Se encarga de dirigir a la vista de <code>login</code>.</p>
<pre><code class="java">package cl.lherrera.gsss.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class LoginController {

    @GetMapping(&quot;/login&quot;)
    public String login() {
        return &quot;login&quot;;
    }
}

</code></pre>

<h3 id="cllherreragssscontrolleradmin"><strong><code>cl.lherrera.gsss.controller.admin</code></strong></h3>
<p>Contiene el control de las peticiones que deberían se controladas solamente por un administrador.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/controller/admin/AdminController.java</code></p>
<p>Controlador encargado de dirigir las vistas del administrador.</p>
<pre><code class="java">package cl.lherrera.gsss.controller.admin;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class AdminController {
    @GetMapping(&quot;/admin&quot;)
    public String home() {
        return &quot;admin/homeAdmin&quot;;
    }
}

</code></pre>

<h3 id="cllherreragssscontrolleruser"><strong><code>cl.lherrera.gsss.controller.user</code></strong></h3>
<p>Contiene los controles a los servicios que solamente debería poder realizar un usuario.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/controller/user/UserController.java</code></p>
<p>Controlador encargado de manejar la interacción con los servicios que le competen a los usuarios. En nuestro caso es el más implementado.</p>
<pre><code class="java">package cl.lherrera.gsss.controller.user;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.view.RedirectView;

import cl.lherrera.gsss.dto.DetalleDTO;

@Controller
public class UserController {

    @GetMapping(&quot;/user&quot;)
    public ModelAndView home(HttpSession session) {
        ModelAndView modelAndView = new ModelAndView(&quot;user/homeUser&quot;);
        modelAndView.addObject(&quot;detalle&quot;, new DetalleDTO());
        modelAndView.addObject(&quot;valores&quot;, session.getAttribute(&quot;valores&quot;));
        return modelAndView;
    }

    @PostMapping(&quot;/users&quot;)
    public RedirectView home(HttpSession session, @ModelAttribute DetalleDTO detalles) {
        List&lt;DetalleDTO&gt; valores = new ArrayList&lt;&gt;();
        // si los valores no vienen vacios se añaden a los valores.
        if (session.getAttribute(&quot;valores&quot;) != null) {
            List&lt;DetalleDTO&gt; valoresDeSesion = (List&lt;DetalleDTO&gt;) session.getAttribute(&quot;valores&quot;);
            // agrega todos los valores a la lista existente.
            valores.addAll(valoresDeSesion);
        }

        valores.add(detalles);
        // se reemplaza el valor de valores en la sesión,
        // se cambia por el nuevo valor de 
        // valores.
        session.setAttribute(&quot;valores&quot;, valores);
        return new RedirectView(&quot;/user&quot;);
    }
}

</code></pre>

<h3 id="cllherreragsssdto"><strong><code>cl.lherrera.gsss.dto</code></strong></h3>
<p>El transportador de datos a la vista.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/dto/DetalleDTO.java</code></p>
<pre><code class="java">package cl.lherrera.gsss.dto;

public class DetalleDTO {

    private String clave;
    private String valor;

    public DetalleDTO() {
        // TODO Auto-generated constructor stub
    }

    public DetalleDTO(String clave, String valor) {
        super();
        this.clave = clave;
        this.valor = valor;
    }

    public String getClave() {
        return clave;
    }

    public void setClave(String clave) {
        this.clave = clave;
    }

    public String getValor() {
        return valor;
    }

    public void setValor(String valor) {
        this.valor = valor;
    }

    @Override
    public String toString() {
        return &quot;DetalleDTO [clave=&quot; + clave + &quot;, valor=&quot; + valor + &quot;]&quot;;
    }
}

</code></pre>

<h3 id="cllherreragsssmapper"><strong><code>cl.lherrera.gsss.mapper</code></strong></h3>
<p>No estamos usando <code>JPA</code>, si no que <code>mybatis</code>, por eso debemos hacer un <code>Mapper</code>, que haga la función de <code>DAO</code>, implementando las consultas explícitas como implementación de cada servicio que podría facilitar un <code>DAO</code>.</p>
<p>Esto se realiza para mostrar el funcionamiento de otra herramienta diiferente a <code>JPA</code>.</p>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/mapper/UserMapper.java</code></p>
<p>Al no utilizar <code>jpa</code>, debemos <code>mapear</code> el acceso a los datos, para no tener que implementar las interfaces, es que nos apoyamos en una librería <code>ibatis</code>, que se encarga de la implementación de estas interfaces utilizando el texto de sus anotaciones especiales para la consulta de datos.</p>
<pre><code class="java">package cl.lherrera.gsss.mapper;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;

import cl.lherrera.gsss.model.Users;

@Mapper
public interface UserMapper {
    @Select(&quot;select * from users where email = #{email}&quot;)
    Users findByEmail(@Param(&quot;email&quot;) String email);
}

</code></pre>

<h3 id="cllherreragsssmodel"><strong><code>cl.lherrera.gsss.model</code></strong></h3>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/model/Role.java</code></p>
<p>Al no tener una tabla en la base de datos, usamos esta clase para poder administrar la cantidad de roles posibles desde esta clase enumerada. Es como si tuviéramos estos datos en una tabla, pero con la cantidad de registros, donde cada registro es un rol, entonces no debería ser más que esta clase la que administre los roles, aunque esto depende del alcance de la <code>escalabilidad</code> esperada.</p>
<pre><code class="java">package cl.lherrera.gsss.model;

public enum Role {
    ROLE_ADMIN, ROLE_USER
}

</code></pre>

<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/model/Users.java</code></p>
<p>EL no usar <code>JPA</code> también provoca que los modelos cambien sus anotaciones.</p>
<p>Entidad, en este caso no llamado así por que no usamos <code>JPA</code>, este <code>POJO</code> es la forma de utilizarlo con <code>mybatis</code>, aunque en realidad es muy parecida a una entidad de <code>jpa</code> solo que, a simple vista, <strong>difiere en sus anotaciones</strong>.</p>
<p>Su nombre en plural es intencional, ya que la forma en que <code>Spring</code> llama a su usuario registrado es <code>User</code>, entonces esto es para ahorrar los posibles conflictos que esto pueda provocar. Aunque basta con usar español u un estándar de nombres de la aplicación como <code>MYAPP_USER</code></p>
<pre><code class="java">package cl.lherrera.gsss.model;

import java.io.Serializable;

public class Users implements Serializable {

    private static final long serialVersionUID = 539393250097912194L;
    private String email; 
    private String password; 
    private Role role;

    public Users() {
        // TODO Auto-generated constructor stub
    }

    public Users(String email, String password, Role role) {
        super();
        this.email = email;
        this.password = password;
        this.role = role;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Role getRole() {
        return role;
    }

    public void setRole(Role role) {
        this.role = role;
    }

    @Override
    public String toString() {
        return &quot;Users [email=&quot; + email + &quot;, password=&quot; + password + &quot;, role=&quot; + role + &quot;]&quot;;
    }

}

</code></pre>

<h3 id="cllherreragsssservice"><strong><code>cl.lherrera.gsss.service</code></strong></h3>
<p><code>/gs-spring-security/src/main/java/cl/lherrera/gsss/service/AuthServiceImpl.java</code></p>
<p>Este servicio nos permite usar la búsqueda de usuarios en la base de datos, este servicio es inyectado en <code>WebSecurityConfig</code>, así personalizamos la búsqueda de las credenciales del usuario. Como todo servicio la lógica de negocio será la que se requiera para el negocio.</p>
<pre><code class="java">package cl.lherrera.gsss.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import cl.lherrera.gsss.mapper.UserMapper;
import cl.lherrera.gsss.model.Users;

@Service
public class AuthServiceImpl implements UserDetailsService {

    @Autowired
    private UserMapper userMapper; 

    @Override
    public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException {

        Users users = userMapper.findByEmail(email); 

        if (users == null) 
            throw new UsernameNotFoundException(email);

        List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();

        String role = users.getRole().toString();

        authorities.add(new SimpleGrantedAuthority(role) );

        User usuarioSistema = new User(
            users.getEmail(), 
            users.getPassword(), 
            authorities
        );

        return usuarioSistema;
    }

}

</code></pre>

<h3 id="gs-spring-securitysrcmainresourcesdbmigrations"><strong><code>/gs-spring-security/src/main/resources/db/migrations</code></strong></h3>
<p>Si queremos, podemos hacer partir una aplicación con un <code>DDL</code> personalizado y lo podemos ir personalizando mientras dure la vida de la aplicación, de esta forma. podemos ir actualizando este archivo y un nuevo desarrollador, siempre tendrá la estructura actualizada, aunque con <code>JPA</code> esta se arma sola con lo que le digamos en las entidades.</p>
<p><code>schema.sql</code></p>
<p>Como estamos importando una base de datos, el esquema lo indicamos en este archivo. Se crea una tabla la que es eliminada en cada inicio de la aplicación y creada vacía nuevamente.</p>
<pre><code class="sql">DROP TABLE if exists users;
create table users(email varchar, password varchar, role varchar);
</code></pre>

<h3 id="gs-spring-securitysrcmainresourcesdbseeds"><strong><code>/gs-spring-security/src/main/resources/db/seeds</code></strong></h3>
<p>Además de la estructura, podemos cargar datos iniciales, como para por ejemplo para hacer pruebas con datos iniciales falsos. Ejecutamos el <code>seed</code>. En este caso para cargar las credenciales con las que haremos pruebas.</p>
<p><code>data.sql</code></p>
<p>Como la tabla está vacía, ingresaremos los datos desde el siguiente archivo, el cual siempre ingresará datos en una tabla <code>users</code> vacía. La contraseña es <code>1234</code> para ambos casos, se realiza la encriptación usando <a href="https://bcrypt-generator.com/">https://bcrypt-generator.com/</a>, ya que así lo exige la implementación de <code>Spring security</code>.</p>
<pre><code class="sql">insert into users(email, password, role) values ('mail@fake.dev','$2y$12$x2/D0RmnpJFC0ZNbbDr6j.cPYFl9d/8hbNGFf8tQisA8AN47KGfqK','ROLE_USER'); 
insert into users(email, password, role) values ('mail2@fake.dev', '$2y$12$x2/D0RmnpJFC0ZNbbDr6j.cPYFl9d/8hbNGFf8tQisA8AN47KGfqK', 'ROLE_ADMIN');

</code></pre>

<h3 id="gs-spring-securitysrcmainresourcestemplatesadmin"><strong><code>/gs-spring-security/src/main/resources/templates/admin</code></strong></h3>
<p><code>homeAdmin.html</code></p>
<p>Vista para presentar el menú de los administradores.</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
    xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
&lt;title&gt;Inicio Administrador&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot;
    href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css &quot;
    integrity=&quot;sha384- 
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot;
    crossorigin=&quot;anonymous&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;ul class=&quot;nav justify-content-end&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;&lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Administrador&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;&lt;a class=&quot;nav-link&quot; th:href=&quot;@{/logout}&quot;&gt;Cerrar sesion&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;Bienvenido!&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre>

<h3 id="gs-spring-securitysrcmainresourcestemplateserror"><strong><code>/gs-spring-security/src/main/resources/templates/error</code></strong></h3>
<p><code>403.html</code></p>
<p>Vista para mostrar error 403</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
    xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
&lt;title&gt;Inicio Administrador&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot;
    href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css &quot;
    integrity=&quot;sha384- 
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot;
    crossorigin=&quot;anonymous&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;ul class=&quot;nav justify-content-end&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;&lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Administrador&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;&lt;a class=&quot;nav-link&quot; th:href=&quot;@{/logout}&quot;&gt;Cerrar sesion&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;Bienvenido!&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre>

<h3 id="gs-spring-securitysrcmainresourcestemplatesuser"><strong><code>/gs-spring-security/src/main/resources/templates/user</code></strong></h3>
<p><code>homeUser.html</code></p>
<p>Es en esta vista donde tenemos la mayor de las implementaciones de la vista, esto es por que el usuario puede guardar claves y valores para el ejemplo de la sesión, y la interacción está acá. Las otras vistas son solamente de muestras para ejemplificar los accesos, no poseen mayor interacción.</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;

&lt;head&gt;
    &lt;title&gt;Inicio Usuario&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css &quot; integrity=&quot;sha384- 
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;ul class=&quot;nav justify-content-end&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Usuario&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a class=&quot;nav-link&quot; th:href=&quot;@{/logout}&quot;&gt;Cerrar sesión&lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;col-sm-4&quot;&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-sm-4&quot;&gt;
            &lt;form th:action=&quot;@{/users}&quot; method=&quot;post&quot; th:object=&quot;${detalle}&quot;&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;input type=&quot;text&quot; th:field=&quot;*{clave}&quot; class=&quot;form-control&quot; id=&quot;clave&quot; aria-describedby=&quot;claveHelp&quot;
                        placeholder=&quot;Ingresa nombre de la clave&quot;&gt;
                    &lt;small id=&quot;inClave&quot; class=&quot;form-text text-muted&quot;&gt;Nombre de la clave que se almacenará en sesión.&lt;/small&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;input type=&quot;text&quot; th:field=&quot;*{valor}&quot; class=&quot;form-control&quot; id=&quot;valor&quot; aria-describedby=&quot;valorHelp&quot;
                        placeholder=&quot;Ingresa el contenido&quot;&gt;
                    &lt;small id=&quot;inValor&quot; class=&quot;form-text text-muted&quot;&gt;Contenido de la clave que se almacenará en sesión.&lt;/small&gt;
                &lt;/div&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Agregar&lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-sm-4&quot;&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-sm-12&quot;&gt;
            &lt;table class=&quot;table&quot;&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th scope=&quot;col&quot;&gt;clave&lt;/th&gt;
                        &lt;th scope=&quot;col&quot;&gt;valor&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    &lt;tr th:each=&quot;detalle: ${valores}&quot;&gt;
                        &lt;td th:text=&quot;${detalle.clave}&quot; /&gt;
                        &lt;td th:text=&quot;${detalle.valor}&quot; /&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>

<h3 id="gs-spring-securitysrcmainresourcestemplates"><strong><code>/gs-spring-security/src/main/resources/templates</code></strong></h3>
<p><code>home.html</code></p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;

&lt;head&gt;
    &lt;title&gt;Iniciar Sesión&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css
&quot; integrity=&quot;sha384-
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;ul class=&quot;nav justify-content-end&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a class=&quot;nav-link active&quot; href=&quot;/user&quot;&gt;Usuario&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a class=&quot;nav-link active&quot; href=&quot;/admin&quot;&gt;Administrador&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a class=&quot;nav-link&quot; th:href=&quot;@{/logout}&quot;&gt;Cerrar sesión&lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
                &lt;h1&gt;Página principal&lt;/h1&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>

<p><code>login.html</code></p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;

&lt;head&gt;
    &lt;title&gt;Iniciar Sesión&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css
&quot; integrity=&quot;sha384-
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
                &lt;form th:action=&quot;@{/login}&quot; method=&quot;post&quot; class=&quot;form-signin&quot;&gt;
                    &lt;h3 class=&quot;form-signin-heading&quot; th:text=&quot;Credenciales&quot;&gt;&lt;/h3&gt;
                    &lt;br /&gt;
                    &lt;!-- el name debe ser: email --&gt;
                    &lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; th:placeholder=&quot;Email&quot; class=&quot;form-control&quot; /&gt; &lt;br /&gt;
                    &lt;!-- el name debe ser: password --&gt;
                    &lt;input type=&quot;password&quot; th:placeholder=&quot;Password&quot; id=&quot;password&quot; name=&quot;password&quot;
                        class=&quot;form-control&quot; /&gt;
                    &lt;br /&gt;
                    &lt;!-- param.error, se refiere a que no hubo éxito en el inicio de sesión --&gt;
                    &lt;!-- en este caso param.error si falla viene con el valor de true --&gt;
                    &lt;div align=&quot;center&quot; th:if=&quot;${param.error}&quot;&gt;
                        &lt;p style=&quot;font-size: 20; color: #FF1C19;&quot;&gt;Verifica las credenciales.&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;button class=&quot;btn btn-lg btn-primary btn-block&quot; name=&quot;Submit&quot; value=&quot;Login&quot; type=&quot;Submit&quot;
                        th:text=&quot;Login&quot;&gt;
                    &lt;/button&gt;
                &lt;/form&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-sm-4&quot;&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>

<p><code>application.properties</code></p>
<p>Archivo con las propiedades del proyecto. además maneja la configuración de la persistencia. El archivo especificado en la base de datos, se crea al arranque.</p>
<pre><code class="conf">spring.cache.type=NONE

spring.datasource.initialization-mode=always
spring.datasource.platform=h2
# Configuración H2.
# En caso que no queramos un archivo
# spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.url=jdbc:h2:file:/Users/luisherrera/Desktop/TALENTO-PROS/MOD005/gs-spring-security/h2database


spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
# si queremos importar un sql
spring.datasource.schema=classpath:db/migrations/schema.sql
spring.datasource.data=classpath:db/seeds/data.sql

</code></pre>

<h3 id="gs-spring-securitypomxml"><strong><code>/gs-spring-security/pom.xml</code></strong></h3>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.thymeleaftTest&lt;/groupId&gt;
    &lt;artifactId&gt;gs-spring-security&lt;/artifactId&gt;
    &lt;version&gt;20.0.0&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;gs-spring-security&lt;/name&gt;
    &lt;description&gt;Pruebas de thymeleaf&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- thymeleaf --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- thymeleaf ## --&gt;

        &lt;!-- DevsTools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;!-- DevsTools # --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<hr />
<h2 id="522-todo-0010"><strong>5.2.2 TODO - 0010</strong></h2>
<p>Implementar la solución con <code>templates</code>, es decir un <code>index</code> base y <code>jpa-sqlite</code>.</p>
<p><a href="https://www.javatpoint.com/spring-security-remember-me">https://www.javatpoint.com/spring-security-remember-me</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>
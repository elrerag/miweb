


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Lectura001 - Java Full Stack Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unidad-41-asociaciones" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Java Full Stack Docs" class="md-header-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Java Full Stack Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Lectura001
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Java Full Stack Docs" class="md-nav__button md-logo" aria-label="Java Full Stack Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Java Full Stack Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../ejercicios/repaso/teoria/poo/herencia/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#411-implementacion-del-proyecto" class="md-nav__link">
    4.1.1 Implementación del proyecto
  </a>
  
    <nav class="md-nav" aria-label="4.1.1 Implementación del proyecto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructura" class="md-nav__link">
    Estructura
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archivos-modificados" class="md-nav__link">
    Archivos modificados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arriendopelispomxml" class="md-nav__link">
    /arriendopelis/pom.xml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arriendopelissrcmainresources" class="md-nav__link">
    /arriendopelis/src/main/resources
  </a>
  
    <nav class="md-nav" aria-label="/arriendopelis/src/main/resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#databaseproperties" class="md-nav__link">
    /database.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applicationproperties" class="md-nav__link">
    /application.properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreraarriendopelis" class="md-nav__link">
    cl.lherrera.arriendopelis
  </a>
  
    <nav class="md-nav" aria-label="cl.lherrera.arriendopelis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arriendopelissrcmainjavacllherreraarriendopelisappconfigjava" class="md-nav__link">
    /arriendopelis/src/main/java/cl/lherrera/arriendopelis/AppConfig.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arriendopelissrcmainjavacllherreraarriendopelissqlitedialectjava" class="md-nav__link">
    /arriendopelis/src/main/java/cl/lherrera/arriendopelis/SQLiteDialect.java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arriendopelissrcmainwebapp" class="md-nav__link">
    /arriendopelis/src/main/webapp
  </a>
  
    <nav class="md-nav" aria-label="/arriendopelis/src/main/webapp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#indexhtml" class="md-nav__link">
    /index.html
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreraarriendopelismodelo" class="md-nav__link">
    cl.lherrera.arriendopelis.modelo
  </a>
  
    <nav class="md-nav" aria-label="cl.lherrera.arriendopelis.modelo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelismodeloarriendojava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/modelo/Arriendo.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelismodeloclientejava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/modelo/Cliente.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelismodelopeliculajava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/modelo/Pelicula.java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cllherreraarriendopelisdao" class="md-nav__link">
    cl.lherrera.arriendopelis.dao
  </a>
  
    <nav class="md-nav" aria-label="cl.lherrera.arriendopelis.dao">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelisdaoarriendorepositoryjava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/dao/ArriendoRepository.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelisdaoclienterepositoryjava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/dao/ClienteRepository.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmainjavacllherreraarriendopelisdaopelicularepositoryjava" class="md-nav__link">
    src/main/java/cl/lherrera/arriendopelis/dao/PeliculaRepository.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srctestjavacllherreraarriendopelisdaoclienterepositorytestjava" class="md-nav__link">
    src/test/java/cl/lherrera/arriendopelis/dao/ClienteRepositoryTest.java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srctestjavacllherreraarriendopelisdaopelicularepositorytestjava" class="md-nav__link">
    src/test/java/cl/lherrera/arriendopelis/dao/PeliculaRepositoryTest.java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fin-lectura" class="md-nav__link">
    Fin lectura...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <blockquote>
<h1 id="unidad-41-asociaciones"><strong>Unidad 4.1 - Asociaciones</strong></h1>
<blockquote>
<ul>
<li>Considerar mostrar materia y pasar a la lectura 2, ya que allí se crea un proyecto de principio a fin.</li>
<li>Se realiza un proyecto con las siguientes cardinalidades.<ul>
<li>Uno a uno (1:1)</li>
<li>Uno a muchos (1:N)</li>
<li>Muchos a uno (N:1)</li>
</ul>
</li>
<li>En una primera etapa se prueba un test con la relación uno a uno. Con las entidades listas ya se puede ver el resultado en <code>DBVEAER</code>.</li>
<li>Cada <code>commit</code> del proyecto contiene una etapa. En la última etapa falla el primer test por que la estructura de la entidad cambia. Por eso está comentado.</li>
<li>Si se desea, esta es la versión final de la lectura, en la carpeta proyectos, se encuentra la historia comparativa con git, como en la lectura. Así no se parte desde el código final de la lectura.</li>
<li><strong>El proyecto de la lectura dos, es la continuación del actual, se puede partir con esa versión completa. Los puntos de la lectura están con <code>GIT</code></strong>.</li>
</ul>
</blockquote>
</blockquote>
<hr />
<p><br /></p>
<blockquote>
<h2 id="411-implementacion-del-proyecto"><strong>4.1.1 Implementación del proyecto</strong></h2>
</blockquote>
<h3 id="estructura"><strong>Estructura</strong></h3>
<pre><code>./
├── HELP.md
├── basedatos.db
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
│   ├── main
│   │   ├── java
│   │   │   └── cl
│   │   │       └── lherrera
│   │   │           └── arriendopelis
│   │   │               ├── AppConfig.java
│   │   │               ├── ArriendopelisApplication.java
│   │   │               ├── SQLiteDialect.java
│   │   │               ├── ServletInitializer.java
│   │   │               ├── dao
│   │   │               │   ├── ArriendoRepository.java
│   │   │               │   ├── ClienteRepository.java
│   │   │               │   └── PeliculaRepository.java
│   │   │               └── modelo
│   │   │                   ├── Arriendo.java
│   │   │                   ├── Cliente.java
│   │   │                   └── Pelicula.java
│   │   ├── resources
│   │   │   ├── application.properties
│   │   │   ├── database.properties
│   │   │   ├── static
│   │   │   └── templates
│   │   └── webapp
│   │       └── index.html
│   └── test
│       └── java
│           └── cl
│               └── lherrera
│                   └── arriendopelis
│                       ├── ArriendopelisApplicationTests.java
│                       └── dao
│                           ├── ClienteRepositoryTest.java
│                           └── PeliculaRepositoryTest.java
└── target
    ├── classes
    │   ├── application.properties
    │   └── database.properties
    ├── m2e-wtp
    │   └── web-resources
    │       └── META-INF
    │           ├── MANIFEST.MF
    │           └── maven
    │               └── cl.lherrera.arriendopelis
    │                   └── arriendopelis
    │                       ├── pom.properties
    │                       └── pom.xml
    └── test-classes

27 directories, 26 files

</code></pre>

<h3 id="archivos-modificados"><strong>Archivos modificados</strong></h3>
<pre><code>/arriendopelis/pom.xml

/arriendopelis/src/main/resources/database.properties
/arriendopelis/src/main/resources/application.properties

/arriendopelis/src/main/java/cl/lherrera/arriendopelis/AppConfig.java
/arriendopelis/src/main/java/cl/lherrera/arriendopelis/SQLiteDialect.java

/arriendopelis/src/main/webapp/index.html

src/main/java/cl/lherrera/arriendopelis/modelo/Arriendo.java
src/main/java/cl/lherrera/arriendopelis/modelo/Cliente.java
src/main/java/cl/lherrera/arriendopelis/modelo/Pelicula.java

basedatos.db # Se crea solo al indicarlo en las propiedades.
src/main/java/cl/lherrera/arriendopelis/dao/ArriendoRepository.java
src/main/java/cl/lherrera/arriendopelis/dao/ClienteRepository.java
src/main/java/cl/lherrera/arriendopelis/dao/PeliculaRepository.java

src/test/java/cl/lherrera/arriendopelis/dao/ClienteRepositoryTest.java
src/test/java/cl/lherrera/arriendopelis/dao/PeliculaRepositoryTest.java
</code></pre>

<h3 id="arriendopelispomxml"><strong><code>/arriendopelis/pom.xml</code></strong></h3>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;cl.lherrera.arriendopelis&lt;/groupId&gt;
    &lt;artifactId&gt;arriendopelis&lt;/artifactId&gt;
    &lt;version&gt;20.0.0&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;arriendopelis&lt;/name&gt;
    &lt;description&gt;lectura 1 relaciones&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;!-- SQLITE - SUPPORT --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.xerial&lt;/groupId&gt;
            &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- SQLITE - SUPPORT #--&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>

<h3 id="arriendopelissrcmainresources"><strong><code>/arriendopelis/src/main/resources</code></strong></h3>
<h4 id="databaseproperties"><code>/database.properties</code></h4>
<pre><code class="conf">driverClassName=org.sqlite.JDBC
url=jdbc:sqlite:basedatos.db
username=jpaspring
password=sa

</code></pre>

<h4 id="applicationproperties"><code>/application.properties</code></h4>
<pre><code># Configuración de jpa
spring.jpa.generate-ddl=true
spring.jpa.database-platform=cl.lherrera.arriendopelis.SQLiteDialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

</code></pre>

<h3 id="cllherreraarriendopelis"><strong><code>cl.lherrera.arriendopelis</code></strong></h3>
<h4 id="arriendopelissrcmainjavacllherreraarriendopelisappconfigjava"><code>/arriendopelis/src/main/java/cl/lherrera/arriendopelis/AppConfig.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

@Configuration
@ComponentScan(&quot;cl.lherrera.jpaspring&quot;)
@PropertySource(&quot;classpath:database.properties&quot;)
public class AppConfig {

    @Autowired
    Environment environment;

    @Bean
    DataSource dataSource() {
        DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();
        driverManagerDataSource.setUrl(environment.getProperty(&quot;url&quot;));
        driverManagerDataSource.setUsername(environment.getProperty(&quot;username&quot;));
        driverManagerDataSource.setPassword(environment.getProperty(&quot;dbpassword&quot;));
        driverManagerDataSource.setDriverClassName(environment.getProperty(&quot;driverClassName&quot;));
        return driverManagerDataSource;
    }
}
</code></pre>

<h4 id="arriendopelissrcmainjavacllherreraarriendopelissqlitedialectjava"><code>/arriendopelis/src/main/java/cl/lherrera/arriendopelis/SQLiteDialect.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis;

import java.sql.Types;

import org.hibernate.dialect.Dialect;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.VarArgsSQLFunction;
import org.hibernate.type.StandardBasicTypes;

public class SQLiteDialect extends Dialect {
  public SQLiteDialect() {
    super();
    registerColumnType(Types.BIT, &quot;integer&quot;);
    registerColumnType(Types.TINYINT, &quot;tinyint&quot;);
    registerColumnType(Types.SMALLINT, &quot;smallint&quot;);
    registerColumnType(Types.INTEGER, &quot;integer&quot;);
    registerColumnType(Types.BIGINT, &quot;bigint&quot;);
    registerColumnType(Types.FLOAT, &quot;float&quot;);
    registerColumnType(Types.REAL, &quot;real&quot;);
    registerColumnType(Types.DOUBLE, &quot;double&quot;);
    registerColumnType(Types.NUMERIC, &quot;numeric&quot;);
    registerColumnType(Types.DECIMAL, &quot;decimal&quot;);
    registerColumnType(Types.CHAR, &quot;char&quot;);
    registerColumnType(Types.VARCHAR, &quot;varchar&quot;);
    registerColumnType(Types.LONGVARCHAR, &quot;longvarchar&quot;);
    registerColumnType(Types.DATE, &quot;date&quot;);
    registerColumnType(Types.TIME, &quot;time&quot;);
    registerColumnType(Types.TIMESTAMP, &quot;timestamp&quot;);
    registerColumnType(Types.BINARY, &quot;blob&quot;);
    registerColumnType(Types.VARBINARY, &quot;blob&quot;);
    registerColumnType(Types.LONGVARBINARY, &quot;blob&quot;);
    // registerColumnType(Types.NULL, &quot;null&quot;);
    registerColumnType(Types.BLOB, &quot;blob&quot;);
    registerColumnType(Types.CLOB, &quot;clob&quot;);
    registerColumnType(Types.BOOLEAN, &quot;integer&quot;);

    registerFunction(&quot;concat&quot;, new VarArgsSQLFunction(StandardBasicTypes.STRING, &quot;&quot;,
        &quot;||&quot;, &quot;&quot;));
    registerFunction(&quot;mod&quot;, new SQLFunctionTemplate(StandardBasicTypes.INTEGER,
        &quot;?1 % ?2&quot;));
    registerFunction(&quot;substr&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
    registerFunction(&quot;substring&quot;, new StandardSQLFunction(&quot;substr&quot;,
            StandardBasicTypes.STRING));
  }

  public boolean supportsIdentityColumns() {
    return true;
  }

  public boolean hasDataTypeInIdentityColumn() {
    return false; // As specify in NHibernate dialect
  }

  public String getIdentityColumnString() {
    // return &quot;integer primary key autoincrement&quot;;
    return &quot;integer&quot;;
  }

  public String getIdentitySelectString() {
    return &quot;select last_insert_rowid()&quot;;
  }

  public boolean supportsLimit() {
    return true;
  }

  public String getLimitString(String query, boolean hasOffset) {
    return new StringBuffer(query.length() + 20).append(query).append(
        hasOffset ? &quot; limit ? offset ?&quot; : &quot; limit ?&quot;).toString();
  }

  public boolean bindLimitParametersInReverseOrder() {
    return true;
  }

  public boolean supportsTemporaryTables() {
    return true;
  }

  public String getCreateTemporaryTableString() {
    return &quot;create temporary table if not exists&quot;;
  }

  public boolean dropTemporaryTableAfterUse() {
    return false;
  }

  public boolean supportsCurrentTimestampSelection() {
    return true;
  }

  public boolean isCurrentTimestampSelectStringCallable() {
    return false;
  }

  public String getCurrentTimestampSelectString() {
    return &quot;select current_timestamp&quot;;
  }

  public boolean supportsUnionAll() {
    return true;
  }

  public boolean hasAlterTable() {
    return false; // As specify in NHibernate dialect
  }

  public boolean dropConstraints() {
    return false;
  }

  public String getAddColumnString() {
    return &quot;add column&quot;;
  }

  public String getForUpdateString() {
    return &quot;&quot;;
  }

  public boolean supportsOuterJoinForUpdate() {
    return false;
  }

  public String getDropForeignKeyString() {
    throw new UnsupportedOperationException(
        &quot;No drop foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddForeignKeyConstraintString(String constraintName,
      String[] foreignKey, String referencedTable, String[] primaryKey,
      boolean referencesPrimaryKey) {
    throw new UnsupportedOperationException(
        &quot;No add foreign key syntax supported by SQLiteDialect&quot;);
  }

  public String getAddPrimaryKeyConstraintString(String constraintName) {
    throw new UnsupportedOperationException(
        &quot;No add primary key syntax supported by SQLiteDialect&quot;);
  }

  public boolean supportsIfExistsBeforeTableName() {
    return true;
  }

  public boolean supportsCascadeDelete() {
    return false;
  }
}
</code></pre>

<h3 id="arriendopelissrcmainwebapp"><strong><code>/arriendopelis/src/main/webapp</code></strong></h3>
<h4 id="indexhtml"><code>/index.html</code></h4>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Arriendo - Películas&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;Ventana de inicio&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h3 id="cllherreraarriendopelismodelo"><strong><code>cl.lherrera.arriendopelis.modelo</code></strong></h3>
<h4 id="srcmainjavacllherreraarriendopelismodeloarriendojava"><code>src/main/java/cl/lherrera/arriendopelis/modelo/Arriendo.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.modelo;

import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.ManyToOne;
import javax.persistence.OneToOne;

@Entity
public class Arriendo {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Integer id;
    private String inicio;
    private Integer duracion;

    @OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = &quot;pelicula_id&quot;, referencedColumnName = &quot;id&quot;)
    private Pelicula pelicula;

    @ManyToOne
    @JoinColumn(name=&quot;cliente_id&quot;, nullable=false)
    private Cliente cliente;

    public Arriendo() {
        // TODO Auto-generated constructor stub
    }

    public Cliente getCliente() {
        return cliente;
    }

    public void setCliente(Cliente cliente) {
        this.cliente = cliente;
    }

    public Arriendo(Integer id, String inicio, Integer duracion, Pelicula pelicula, Cliente cliente) {
        super();
        this.id = id;
        this.inicio = inicio;
        this.duracion = duracion;
        this.pelicula = pelicula;
        this.cliente = cliente;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getInicio() {
        return inicio;
    }

    public void setInicio(String inicio) {
        this.inicio = inicio;
    }

    public Integer getDuracion() {
        return duracion;
    }

    public void setDuracion(Integer duracion) {
        this.duracion = duracion;
    }

    public Pelicula getPelicula() {
        return pelicula;
    }

    public void setPelicula(Pelicula pelicula) {
        this.pelicula = pelicula;
    }

    @Override
    public String toString() {
        return &quot;Arriendo [id=&quot; + id + &quot;, inicio=&quot; + inicio + &quot;, duracion=&quot; + duracion + &quot;, pelicula=&quot; + pelicula + &quot;]&quot;;
    }
}

</code></pre>

<h4 id="srcmainjavacllherreraarriendopelismodeloclientejava"><code>src/main/java/cl/lherrera/arriendopelis/modelo/Cliente.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.modelo;

import java.util.List;

import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.OneToMany;

@Entity
public class Cliente {
    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    private Integer id; 
    private String nombre;

    @OneToMany(cascade= CascadeType.ALL, mappedBy = &quot;cliente&quot;)
    private List&lt;Arriendo&gt; arriendos;

    public Cliente() {
        // TODO Auto-generated constructor stub
    }

    public Cliente(Integer id, String nombre, List&lt;Arriendo&gt; arriendos) {
        super();
        this.id = id;
        this.nombre = nombre;
        this.arriendos = arriendos;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public List&lt;Arriendo&gt; getArriendos() {
        return arriendos;
    }

    public void setArriendos(List&lt;Arriendo&gt; arriendos) {
        this.arriendos = arriendos;
    }

    @Override
    public String toString() {
        return &quot;Cliente [id=&quot; + id + &quot;, nombre=&quot; + nombre + &quot;, arriendos=&quot; + arriendos + &quot;]&quot;;
    }

}

</code></pre>

<h4 id="srcmainjavacllherreraarriendopelismodelopeliculajava"><code>src/main/java/cl/lherrera/arriendopelis/modelo/Pelicula.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.modelo;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Pelicula {
    @Id
    @GeneratedValue(strategy=GenerationType.AUTO) // https://www.objectdb.com/java/jpa/entity/generated
    private Integer id; 
    private String titulo; 
    private String descripcion; 
    private Integer duracion;

    public Pelicula() {}

    public Pelicula(Integer id, String titulo, String descripcion, Integer duracion) {
        super();
        this.id = id;
        this.titulo = titulo;
        this.descripcion = descripcion;
        this.duracion = duracion;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getTitulo() {
        return titulo;
    }

    public void setTitulo(String titulo) {
        this.titulo = titulo;
    }

    public String getDescripcion() {
        return descripcion;
    }

    public void setDescripcion(String descripcion) {
        this.descripcion = descripcion;
    }

    public Integer getDuracion() {
        return duracion;
    }

    public void setDuracion(Integer duracion) {
        this.duracion = duracion;
    }

    @Override
    public String toString() {
        return &quot;Pelicula [id=&quot; + id + &quot;, titulo=&quot; + titulo + &quot;, descripcion=&quot; + descripcion + &quot;, duracion=&quot; + duracion
                + &quot;]&quot;;
    }

}

</code></pre>

<h3 id="cllherreraarriendopelisdao"><strong><code>cl.lherrera.arriendopelis.dao</code></strong></h3>
<h4 id="srcmainjavacllherreraarriendopelisdaoarriendorepositoryjava"><code>src/main/java/cl/lherrera/arriendopelis/dao/ArriendoRepository.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.dao;

import org.springframework.data.jpa.repository.JpaRepository;

import cl.lherrera.arriendopelis.modelo.Arriendo;

public interface ArriendoRepository extends JpaRepository&lt;Arriendo, Integer&gt; {

}

</code></pre>

<h4 id="srcmainjavacllherreraarriendopelisdaoclienterepositoryjava"><code>src/main/java/cl/lherrera/arriendopelis/dao/ClienteRepository.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.dao;

import org.springframework.data.jpa.repository.JpaRepository;

import cl.lherrera.arriendopelis.modelo.Cliente;

public interface ClienteRepository extends JpaRepository&lt;Cliente, Integer&gt; {

}

</code></pre>

<h4 id="srcmainjavacllherreraarriendopelisdaopelicularepositoryjava"><code>src/main/java/cl/lherrera/arriendopelis/dao/PeliculaRepository.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.dao;

import org.springframework.data.jpa.repository.JpaRepository;

import cl.lherrera.arriendopelis.modelo.Pelicula;

public interface PeliculaRepository extends JpaRepository&lt;Pelicula, Integer&gt; {

}

</code></pre>

<h4 id="srctestjavacllherreraarriendopelisdaoclienterepositorytestjava"><code>src/test/java/cl/lherrera/arriendopelis/dao/ClienteRepositoryTest.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.dao;

import static org.assertj.core.api.Assertions.assertThat;

import java.util.ArrayList;
import java.util.List;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.arriendopelis.modelo.Arriendo;
import cl.lherrera.arriendopelis.modelo.Cliente;
import cl.lherrera.arriendopelis.modelo.Pelicula;

@SpringBootTest
public class ClienteRepositoryTest {

    @Autowired
    private ArriendoRepository arriendoRepository;

    @Autowired
    private ClienteRepository clienteRepository;

    @Test
    public void validandoDatos() {
        // Instanciamos las tres clases.
        Pelicula pelicula = new Pelicula();
        Cliente cliente = new Cliente();
        Arriendo arriendo = new Arriendo();
        // Guardamos al cliente en base de datos para generar su ID.
        // cliente.setNombre(&quot;Juan&quot;);
        cliente = clienteRepository.save(cliente);
        // Asignamos un estado a la pelicula
        pelicula.setDescripcion(&quot;Buena pelicula&quot;);
        pelicula.setDuracion(160);
        pelicula.setTitulo(&quot;El cuadro&quot;);
        // Asignamos un estado al arriendo
        arriendo.setDuracion(10);
        arriendo.setInicio(&quot;11/12/2019&quot;);
        arriendo.setPelicula(pelicula);
        // Le asignamos al cliente previamente creado.
        arriendo.setCliente(cliente);
        // Guardamos la pelicula y el arriendo
        arriendo = arriendoRepository.save(arriendo);
        // Creamos una lista de arriendos y agregamos el que ya creamos a ella.
        List&lt;Arriendo&gt; arriendos = new ArrayList&lt;&gt;();
        arriendos.add(arriendo);
        cliente.setArriendos(arriendos);
        // Guardamos al cliente en base de datos
        cliente = clienteRepository.save(cliente);
        // afirmaciones
        assertThat(arriendoRepository.findAll()).isNotNull();
        assertThat(clienteRepository.findAll()).isNotNull();
    }

}

</code></pre>

<h4 id="srctestjavacllherreraarriendopelisdaopelicularepositorytestjava"><code>src/test/java/cl/lherrera/arriendopelis/dao/PeliculaRepositoryTest.java</code></h4>
<pre><code class="java">package cl.lherrera.arriendopelis.dao;

import static org.assertj.core.api.Assertions.assertThat;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import cl.lherrera.arriendopelis.modelo.Arriendo;
import cl.lherrera.arriendopelis.modelo.Pelicula;

@SpringBootTest
public class PeliculaRepositoryTest {

    @Autowired
    private ArriendoRepository arriendoRepository;
    @Autowired
    PeliculaRepository peliculaRepository;

    // este test fallará con la aplicación de la última relación Se comenta para que 
    // se ejecute sin problemas el siguiente.
    // esto se debe a que se agrega un campo a la relación.
//  @Test
//  public void validaRepositoriosCreandoPeliculaYArriendo() {
//      // nueva pelicula
//      Pelicula spaceOdyssey = new Pelicula(null, &quot;2001: A Space Odyssey&quot;,
//              &quot;After discovering a mysterious artifact buried &quot; + &quot;beneath the Lunar surface, mankind sets off on a &quot;
//                      + &quot;quest to find its origins with help from intelligent &quot; + &quot;supercomputer H.A.L. 9000. &quot;,
//              149);
//
//      // nuevo arriendo
//      Arriendo arriendo = new Arriendo(null, &quot;11/20/2019&quot;, 7, spaceOdyssey);
//      // guardar arriendo
//      arriendoRepository.save(arriendo);
//      // buscar arriendo
//      Arriendo arriendoOd = arriendoRepository.findById(1).get();
//      // valida que exista
//      assertThat(arriendoOd).isNotNull();
//
//  }

}

</code></pre>

<hr />
<h3 id="fin-lectura">Fin lectura...</h3>
<p>El proyecto continúa en la siguiente lectura.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>